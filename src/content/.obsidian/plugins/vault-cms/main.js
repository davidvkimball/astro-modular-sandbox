/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var Xt=Object.create;var Z=Object.defineProperty;var Zt=Object.getOwnPropertyDescriptor;var er=Object.getOwnPropertyNames;var tr=Object.getPrototypeOf,rr=Object.prototype.hasOwnProperty;var ir=(e,r)=>{for(var t in r)Z(e,t,{get:r[t],enumerable:!0})},tt=(e,r,t,n)=>{if(r&&typeof r=="object"||typeof r=="function")for(let i of er(r))!rr.call(e,i)&&i!==t&&Z(e,i,{get:()=>r[i],enumerable:!(n=Zt(r,i))||n.enumerable});return e};var z=(e,r,t)=>(t=e!=null?Xt(tr(e)):{},tt(r||!e||!e.__esModule?Z(t,"default",{value:e,enumerable:!0}):t,e)),nr=e=>tt(Z({},"__esModule",{value:!0}),e);var En={};ir(En,{default:()=>Ne});module.exports=nr(En);var Qt=require("obsidian");var rt={projectRoot:"",configFilePath:"",contentTypes:[],frontmatterProperties:{},preset:"vanilla",enableWYSIWYG:!1,enabledPlugins:[],disabledPlugins:[],theme:"",basesCMSConfig:{views:[]},astroComposerConfig:{customContentTypes:[],defaultTemplate:"",configFilePath:"",terminalProjectRootPath:""},seoConfig:{titleProperty:"title",descriptionProperty:void 0,scanDirectories:"",useFilenameAsTitle:!1,useFilenameAsSlug:!0},commanderConfig:{pageHeaderCommands:[]},propertyOverFileName:{propertyKey:"title"},imageInserter:{valueFormat:"[[attachments/{image-url}]]",insertFormat:"[[attachments/{image-url}]]"},runWizardOnStartup:!0,wizardCompleted:!1};var N=require("obsidian");var Kt=require("obsidian");var x=class{constructor(r,t,n,i,o,a){this.app=r,this.containerEl=t,this.state=n,this.onNext=i,this.onBack=o,this.onCancel=a}};var ee=class extends x{display(){let{containerEl:r}=this;r.empty(),r.createEl("h2",{text:"Welcome to Vault CMS Setup"}),r.createEl("p",{text:"This wizard will help you configure your Vault CMS setup. We'll guide you through:"});let t=r.createEl("ul");t.createEl("li",{text:"Detecting your Astro project structure"}),t.createEl("li",{text:"Identifying your content types"}),t.createEl("li",{text:"Mapping frontmatter properties"}),t.createEl("li",{text:"Configuring plugins and themes"}),t.createEl("li",{text:"Setting up Bases CMS views"}),t.createEl("li",{text:"Configuring Astro Composer and SEO plugins"}),r.createEl("p",{text:'Click "Next" to begin the setup process.'})}validate(){return!0}getTitle(){return"Welcome"}getDescription(){return"Introduction to Vault CMS setup"}};var k=require("obsidian"),V=z(require("path")),B=z(require("fs"));var w=z(require("path")),re=z(require("fs")),te=class{constructor(r){this.app=r}async detectProject(){let t=this.app.vault.adapter,n=t.basePath||t.path;if(!n)return null;let i=await this.searchUpwardForConfig(n);if(!i)return null;let o=this.detectVaultLocation(n,i.projectRoot);return{projectRoot:i.projectRoot,configFilePath:i.configFilePath,vaultLocation:o}}async searchUpwardForConfig(r){let t=["astro.config.ts","astro.config.mjs","astro.config.js","astro.config.mts","astro.config.cjs"],n=w.resolve(r),i=w.parse(n).root;for(;n!==i;){for(let a of t){let s=w.join(n,a);try{if(re.existsSync(s)&&re.statSync(s).isFile())return{projectRoot:n,configFilePath:s}}catch(l){}}let o=w.dirname(n);if(o===n)break;n=o}return null}detectVaultLocation(r,t){let n=w.normalize(r),i=w.normalize(t);if(!n.startsWith(i))return"root";let a=w.relative(i,n).split(w.sep).filter(p=>p.length>0),s=a.findIndex(p=>p.toLowerCase()==="content");if(s>0){let p=s-1;if(p>=0&&a[p].toLowerCase()==="src")return"content"}let l=a.findIndex(p=>p.toLowerCase()==="src");return l>=0&&l<a.length-1&&a[l+1].toLowerCase()==="content"?"nested-content":"root"}};var ie=class extends x{constructor(t,n,i,o,a,s){super(t,n,i,o,a,s);this.detected=!1;this.projectRootDisplay=null;this.configFileDisplay=null;this.projectDetector=new te(t)}async display(){var i,o;let{containerEl:t}=this;t.empty();let n=((i=this.state.projectDetection)==null?void 0:i.projectRoot)&&((o=this.state.projectDetection)==null?void 0:o.configFilePath);if(n)this.detected=!0;else{t.createEl("h2",{text:"Project Detection"}),t.createEl("p",{text:"Detecting your Astro project structure..."});let a=await this.projectDetector.detectProject();a?(this.state.projectDetection=a,this.detected=!0):this.detected=!1}if(this.state.projectDetection&&(this.detected||n)){await new Promise(l=>setTimeout(l,500)),t.empty(),t.createEl("h2",{text:"Project Detected"}),t.createEl("p",{text:'Project structure detected successfully. You can modify the paths below if needed, then click "Next" to continue.'});let a=new k.Setting(t).setName("Project Root").setDesc("Select the folder containing your Astro project root");this.projectRootDisplay=a.descEl.createDiv({text:this.state.projectDetection.projectRoot||"No folder selected",cls:"vault-cms-path-display"}),this.projectRootDisplay.style.color="var(--text-normal)",a.addButton(l=>l.setButtonText("Browse...").setCta().onClick(async()=>{let p=await this.selectFolder();p&&(this.state.projectDetection.projectRoot=p,this.projectRootDisplay&&(this.projectRootDisplay.textContent=p,this.projectRootDisplay.style.color="var(--text-normal)"),this.detected=!1)}));let s=new k.Setting(t).setName("Config File").setDesc("Select your Astro config file (astro.config.ts, astro.config.mjs, src/config.ts, etc.)");this.configFileDisplay=s.descEl.createDiv({text:this.state.projectDetection.configFilePath||"No file selected",cls:"vault-cms-path-display"}),this.configFileDisplay.style.color="var(--text-normal)",s.addButton(l=>l.setButtonText("Browse...").setCta().onClick(async()=>{var c;let p=((c=this.state.projectDetection)==null?void 0:c.projectRoot)||this.getVaultPath(),f=await this.selectConfigFile(p);f&&(this.state.projectDetection.configFilePath=f,this.configFileDisplay&&(this.configFileDisplay.textContent=f,this.configFileDisplay.style.color="var(--text-normal)"),this.detected=!1)}))}else{t.empty(),t.createEl("h2",{text:"Project Detection Failed"}),t.createEl("p",{text:"Could not detect Astro project structure. Please select your Astro project root and config file manually."}),this.state.projectDetection||(this.state.projectDetection={projectRoot:"",configFilePath:"",vaultLocation:"root"});let a=new k.Setting(t).setName("Project Root").setDesc("Select the folder containing your Astro project root");this.projectRootDisplay=a.descEl.createDiv({text:this.state.projectDetection.projectRoot||"No folder selected",cls:"vault-cms-path-display"}),this.state.projectDetection.projectRoot?this.projectRootDisplay.style.color="var(--text-normal)":this.projectRootDisplay.style.color="var(--text-muted)",a.addButton(l=>l.setButtonText("Browse...").setCta().onClick(async()=>{let p=await this.selectFolder();p&&(this.state.projectDetection.projectRoot=p,this.projectRootDisplay&&(this.projectRootDisplay.textContent=p,this.projectRootDisplay.style.color="var(--text-normal)"))}));let s=new k.Setting(t).setName("Config File").setDesc("Select your Astro config file (astro.config.ts, astro.config.mjs, etc.)");this.configFileDisplay=s.descEl.createDiv({text:this.state.projectDetection.configFilePath||"No file selected",cls:"vault-cms-path-display"}),this.state.projectDetection.configFilePath?this.configFileDisplay.style.color="var(--text-normal)":this.configFileDisplay.style.color="var(--text-muted)",s.addButton(l=>l.setButtonText("Browse...").setCta().onClick(async()=>{var c;let p=((c=this.state.projectDetection)==null?void 0:c.projectRoot)||this.getVaultPath(),f=await this.selectConfigFile(p);f&&(this.state.projectDetection.configFilePath=f,this.configFileDisplay&&(this.configFileDisplay.textContent=f,this.configFileDisplay.style.color="var(--text-normal)"))}))}}async selectFolder(){var t,n,i;try{let o=null;try{let p=require("@electron/remote");o=p==null?void 0:p.dialog}catch(p){}if(!o)try{let p=((t=window.require)==null?void 0:t.call(window,"electron"))||require("electron");o=(n=p==null?void 0:p.remote)==null?void 0:n.dialog}catch(p){}if(!o)try{let p=require("electron");o=p==null?void 0:p.dialog}catch(p){}if(!o||typeof o.showOpenDialogSync!="function")throw new Error("Electron dialog API not available");let a=this.getVaultPath(),s=((i=this.state.projectDetection)==null?void 0:i.projectRoot)||a,l=o.showOpenDialogSync({title:"Select Astro Project Root Folder",defaultPath:s,properties:["openDirectory"]});if(l&&l.length>0)return V.normalize(l[0])}catch(o){console.error("Error opening folder picker:",o),new k.Notice("Unable to open folder picker. Please ensure you are using Obsidian on desktop.")}return null}async selectConfigFile(t){var n,i;try{let o=null;try{let l=require("@electron/remote");o=l==null?void 0:l.dialog}catch(l){}if(!o)try{let l=((n=window.require)==null?void 0:n.call(window,"electron"))||require("electron");o=(i=l==null?void 0:l.remote)==null?void 0:i.dialog}catch(l){}if(!o)try{let l=require("electron");o=l==null?void 0:l.dialog}catch(l){}if(!o||typeof o.showOpenDialogSync!="function")throw new Error("Electron dialog API not available");let a=t||this.getVaultPath(),s=o.showOpenDialogSync({title:"Select Astro Config File",defaultPath:a,filters:[{name:"Astro Config Files",extensions:["ts","mjs","js","mts","cjs"]},{name:"All Files",extensions:["*"]}],properties:["openFile"]});if(s&&s.length>0)return V.normalize(s[0])}catch(o){console.error("Error opening file picker:",o),new k.Notice("Unable to open file picker. Please ensure you are using Obsidian on desktop.")}return null}getVaultPath(){let t=this.app.vault.adapter,n=t.basePath||t.path;return n?V.resolve(n):process.cwd()}validate(){var i,o;if(this.detected)return!0;let t=(i=this.state.projectDetection)==null?void 0:i.projectRoot,n=(o=this.state.projectDetection)==null?void 0:o.configFilePath;if(!t||!n)return!1;try{return!(!B.existsSync(t)||!B.statSync(t).isDirectory()||!B.existsSync(n)||!B.statSync(n).isFile())}catch(a){return!1}}getTitle(){return"Project Detection"}getDescription(){return"Detect Astro project structure"}};var D=require("obsidian"),I=z(require("path"));var Ie=require("obsidian"),ne=class{constructor(r){this.app=r}async detectContentTypes(){let t=this.app.vault.getRoot();if(!(t instanceof Ie.TFolder))return[];let n=[],i=this.getTopLevelFolders(t);for(let o of i){let a=this.detectContentType(o);a&&n.push(a)}return n}getTopLevelFolders(r){let t=[];if(!r.children)return t;for(let n of r.children)n instanceof Ie.TFolder&&!n.name.startsWith(".")&&n.name!=="bases"&&n.name!=="_bases"&&n.name!=="node_modules"&&n.name!==".obsidian"&&t.push(n);return t}detectContentType(r){let t=r.name.toLowerCase(),n,i=!1;return t==="posts"||t==="post"||t==="blog"?(n="Posts",i=!0):t==="pages"||t==="page"?(n="Pages",i=!0):(n=this.capitalizeFirst(r.name),i=!1),{id:`content-type-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,name:n,folder:r.name,organizationMode:"file",enabled:i,indexFileName:"index"}}capitalizeFirst(r){return r.charAt(0).toUpperCase()+r.slice(1)}};var oe=class extends x{constructor(t,n,i,o,a,s){super(t,n,i,o,a,s);this.detected=!1;this.contentTypeDetector=new ne(t)}async display(){let{containerEl:t}=this,n=t.querySelector(".content-type-step-content");if(n?n.empty():(t.empty(),n=t.createDiv({cls:"content-type-step-content"})),n.createEl("h2",{text:"Content Types"}),n.createEl("p",{text:"Detecting content types in your vault..."}),!this.detected){let a=await this.contentTypeDetector.detectContentTypes();this.state.contentTypes=a,this.detected=!0}n.empty(),n.createEl("h2",{text:"Content Types"}),n.createEl("p",{text:"Select and configure your content types:"});let i=this.state.contentTypes.filter(a=>a.enabled&&a.organizationMode==="file");if(i.length>0){let a=!!this.state.sharedAttachmentsFolder,s=new D.Setting(n).setName("Use Shared Attachments Folder").setDesc("Enable to use a single attachments folder for all file-based content types. Only affects file-based content types.");if(s.addToggle(l=>l.setValue(a).onChange(p=>{if(!p){this.state.sharedAttachmentsFolder=void 0;for(let f of i)f.attachmentsFolder=void 0}this.display()})),a){let l=s.descEl.createDiv({text:this.state.sharedAttachmentsFolder||"No folder selected",cls:"vault-cms-path-display"});l.style.color=this.state.sharedAttachmentsFolder?"var(--text-normal)":"var(--text-muted)",l.style.marginTop="8px",s.addButton(p=>p.setButtonText("Browse...").setCta().onClick(async()=>{let f=await this.selectAttachmentsFolder("");if(f){this.state.sharedAttachmentsFolder=f;for(let c of i)c.attachmentsFolder=f;this.display()}}))}}for(let a of this.state.contentTypes){let s=new D.Setting(n).setName(a.name).setDesc(`Folder: ${a.folder}`).addToggle(l=>l.setValue(a.enabled).onChange(p=>{a.enabled=p}));if(new D.Setting(n).setName(`${a.name} - Organization Mode`).setDesc("Choose how content is organized").addDropdown(l=>l.addOption("file","File-based").addOption("folder","Folder-based").setValue(a.organizationMode).onChange(p=>{a.organizationMode=p,this.display()})),a.organizationMode==="file"&&!this.state.sharedAttachmentsFolder){let l=new D.Setting(n).setName(`${a.name} - Attachments Folder`).setDesc("Select the folder where images and attachments are stored for this content type"),p=l.descEl.createDiv({text:a.attachmentsFolder||"No folder selected",cls:"vault-cms-path-display"});a.attachmentsFolder?p.style.color="var(--text-normal)":p.style.color="var(--text-muted)",l.addButton(f=>f.setButtonText("Browse...").setCta().onClick(async()=>{let c=await this.selectAttachmentsFolder(a.folder);c&&(a.attachmentsFolder=c,p.textContent=c,p.style.color="var(--text-normal)")}))}else a.organizationMode==="file"&&this.state.sharedAttachmentsFolder&&new D.Setting(n).setName(`${a.name} - Attachments Folder`).setDesc(`Using shared folder: ${this.state.sharedAttachmentsFolder}`);a.organizationMode==="folder"&&new D.Setting(n).setName(`${a.name} - Index File Name`).setDesc("Name of the index file in folder-based organization").addText(l=>l.setValue(a.indexFileName||"index").onChange(p=>{a.indexFileName=p||"index"}))}let o=n.createEl("button",{text:"Add Additional Content Type",cls:"mod-cta"});o.style.marginTop="20px",o.style.marginBottom="30px",o.addEventListener("click",async()=>{let a=await this.selectContentTypeFolder();if(a){let s=I.basename(a),l={id:`content-type-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,name:this.capitalizeFirst(s),folder:s,organizationMode:"file",enabled:!1,indexFileName:"index"};this.state.contentTypes.push(l),this.display()}})}async selectAttachmentsFolder(t){var n,i;try{let o=null;try{let p=require("@electron/remote");o=p==null?void 0:p.dialog}catch(p){}if(!o)try{let p=((n=window.require)==null?void 0:n.call(window,"electron"))||require("electron");o=(i=p==null?void 0:p.remote)==null?void 0:i.dialog}catch(p){}if(!o)try{let p=require("electron");o=p==null?void 0:p.dialog}catch(p){}if(!o||typeof o.showOpenDialogSync!="function")throw new Error("Electron dialog API not available");let a=this.getVaultPath(),s=I.join(a,t),l=o.showOpenDialogSync({title:"Select Attachments Folder",defaultPath:s,properties:["openDirectory"]});if(l&&l.length>0)return I.normalize(l[0])}catch(o){console.error("Error opening folder picker:",o),new D.Notice("Unable to open folder picker. Please ensure you are using Obsidian on desktop.")}return null}async selectContentTypeFolder(){var t,n;try{let i=null;try{let s=require("@electron/remote");i=s==null?void 0:s.dialog}catch(s){}if(!i)try{let s=((t=window.require)==null?void 0:t.call(window,"electron"))||require("electron");i=(n=s==null?void 0:s.remote)==null?void 0:n.dialog}catch(s){}if(!i)try{let s=require("electron");i=s==null?void 0:s.dialog}catch(s){}if(!i||typeof i.showOpenDialogSync!="function")throw new Error("Electron dialog API not available");let o=this.getVaultPath(),a=i.showOpenDialogSync({title:"Select Content Type Folder",defaultPath:o,properties:["openDirectory"]});if(a&&a.length>0)return I.normalize(a[0])}catch(i){console.error("Error opening folder picker:",i),new D.Notice("Unable to open folder picker. Please ensure you are using Obsidian on desktop.")}return null}getVaultPath(){let t=this.app.vault.adapter,n=t.basePath||t.path;return n?I.resolve(n):process.cwd()}capitalizeFirst(t){return t.charAt(0).toUpperCase()+t.slice(1)}validate(){return this.state.contentTypes.some(t=>t.enabled)}getTitle(){return"Content Types"}getDescription(){return"Configure content types"}};var it=require("obsidian");var ae=class extends x{display(){let{containerEl:r}=this;r.empty(),r.createEl("h2",{text:"Default Content Type"}),r.createEl("p",{text:"Select which content type should be used as the default. This will:"});let t=r.createEl("ul");t.createEl("li",{text:"Set as the default Bases CMS view"}),t.createEl("li",{text:`Configure Obsidian's "Default location for new notes" to that folder`});let n=this.state.contentTypes.filter(i=>i.enabled);if(n.length===0){r.createEl("p",{text:"No enabled content types found. Please go back and enable at least one content type."});return}new it.Setting(r).setName("Default Content Type").setDesc("Choose the default content type for new notes").addDropdown(i=>{n.forEach(o=>{i.addOption(o.id,o.name)}),i.setValue(this.state.defaultContentTypeId||n[0].id),i.onChange(o=>{this.state.defaultContentTypeId=o})})}validate(){return!!this.state.defaultContentTypeId}getTitle(){return"Default Content Type"}getDescription(){return"Select default content type"}};var E=require("obsidian");var Ge=require("obsidian");function xt(e){return typeof e=="undefined"||e===null}function or(e){return typeof e=="object"&&e!==null}function ar(e){return Array.isArray(e)?e:xt(e)?[]:[e]}function sr(e,r){var t,n,i,o;if(r)for(o=Object.keys(r),t=0,n=o.length;t<n;t+=1)i=o[t],e[i]=r[i];return e}function lr(e,r){var t="",n;for(n=0;n<r;n+=1)t+=e;return t}function pr(e){return e===0&&Number.NEGATIVE_INFINITY===1/e}var cr=xt,ur=or,fr=ar,dr=lr,hr=pr,mr=sr,P={isNothing:cr,isObject:ur,toArray:fr,repeat:dr,isNegativeZero:hr,extend:mr};function Ct(e,r){var t="",n=e.reason||"(unknown reason)";return e.mark?(e.mark.name&&(t+='in "'+e.mark.name+'" '),t+="("+(e.mark.line+1)+":"+(e.mark.column+1)+")",!r&&e.mark.snippet&&(t+=`

`+e.mark.snippet),n+" "+t):n}function K(e,r){Error.call(this),this.name="YAMLException",this.reason=e,this.mark=r,this.message=Ct(this,!1),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack||""}K.prototype=Object.create(Error.prototype);K.prototype.constructor=K;K.prototype.toString=function(r){return this.name+": "+Ct(this,r)};var T=K;function _e(e,r,t,n,i){var o="",a="",s=Math.floor(i/2)-1;return n-r>s&&(o=" ... ",r=n-s+o.length),t-n>s&&(a=" ...",t=n+s-a.length),{str:o+e.slice(r,t).replace(/\t/g,"\u2192")+a,pos:n-r+o.length}}function ke(e,r){return P.repeat(" ",r-e.length)+e}function gr(e,r){if(r=Object.create(r||null),!e.buffer)return null;r.maxLength||(r.maxLength=79),typeof r.indent!="number"&&(r.indent=1),typeof r.linesBefore!="number"&&(r.linesBefore=3),typeof r.linesAfter!="number"&&(r.linesAfter=2);for(var t=/\r?\n|\r|\0/g,n=[0],i=[],o,a=-1;o=t.exec(e.buffer);)i.push(o.index),n.push(o.index+o[0].length),e.position<=o.index&&a<0&&(a=n.length-2);a<0&&(a=n.length-1);var s="",l,p,f=Math.min(e.line+r.linesAfter,i.length).toString().length,c=r.maxLength-(r.indent+f+3);for(l=1;l<=r.linesBefore&&!(a-l<0);l++)p=_e(e.buffer,n[a-l],i[a-l],e.position-(n[a]-n[a-l]),c),s=P.repeat(" ",r.indent)+ke((e.line-l+1).toString(),f)+" | "+p.str+`
`+s;for(p=_e(e.buffer,n[a],i[a],e.position,c),s+=P.repeat(" ",r.indent)+ke((e.line+1).toString(),f)+" | "+p.str+`
`,s+=P.repeat("-",r.indent+f+3+p.pos)+`^
`,l=1;l<=r.linesAfter&&!(a+l>=i.length);l++)p=_e(e.buffer,n[a+l],i[a+l],e.position-(n[a]-n[a+l]),c),s+=P.repeat(" ",r.indent)+ke((e.line+l+1).toString(),f)+" | "+p.str+`
`;return s.replace(/\n$/,"")}var yr=gr,vr=["kind","multi","resolve","construct","instanceOf","predicate","represent","representName","defaultStyle","styleAliases"],xr=["scalar","sequence","mapping"];function Cr(e){var r={};return e!==null&&Object.keys(e).forEach(function(t){e[t].forEach(function(n){r[String(n)]=t})}),r}function Pr(e,r){if(r=r||{},Object.keys(r).forEach(function(t){if(vr.indexOf(t)===-1)throw new T('Unknown option "'+t+'" is met in definition of "'+e+'" YAML type.')}),this.options=r,this.tag=e,this.kind=r.kind||null,this.resolve=r.resolve||function(){return!0},this.construct=r.construct||function(t){return t},this.instanceOf=r.instanceOf||null,this.predicate=r.predicate||null,this.represent=r.represent||null,this.representName=r.representName||null,this.defaultStyle=r.defaultStyle||null,this.multi=r.multi||!1,this.styleAliases=Cr(r.styleAliases||null),xr.indexOf(this.kind)===-1)throw new T('Unknown kind "'+this.kind+'" is specified for "'+e+'" YAML type.')}var b=Pr;function nt(e,r){var t=[];return e[r].forEach(function(n){var i=t.length;t.forEach(function(o,a){o.tag===n.tag&&o.kind===n.kind&&o.multi===n.multi&&(i=a)}),t[i]=n}),t}function br(){var e={scalar:{},sequence:{},mapping:{},fallback:{},multi:{scalar:[],sequence:[],mapping:[],fallback:[]}},r,t;function n(i){i.multi?(e.multi[i.kind].push(i),e.multi.fallback.push(i)):e[i.kind][i.tag]=e.fallback[i.tag]=i}for(r=0,t=arguments.length;r<t;r+=1)arguments[r].forEach(n);return e}function je(e){return this.extend(e)}je.prototype.extend=function(r){var t=[],n=[];if(r instanceof b)n.push(r);else if(Array.isArray(r))n=n.concat(r);else if(r&&(Array.isArray(r.implicit)||Array.isArray(r.explicit)))r.implicit&&(t=t.concat(r.implicit)),r.explicit&&(n=n.concat(r.explicit));else throw new T("Schema.extend argument should be a Type, [ Type ], or a schema definition ({ implicit: [...], explicit: [...] })");t.forEach(function(o){if(!(o instanceof b))throw new T("Specified list of YAML types (or a single Type object) contains a non-Type object.");if(o.loadKind&&o.loadKind!=="scalar")throw new T("There is a non-scalar type in the implicit list of a schema. Implicit resolving of such types is not supported.");if(o.multi)throw new T("There is a multi type in the implicit list of a schema. Multi tags can only be listed as explicit.")}),n.forEach(function(o){if(!(o instanceof b))throw new T("Specified list of YAML types (or a single Type object) contains a non-Type object.")});var i=Object.create(je.prototype);return i.implicit=(this.implicit||[]).concat(t),i.explicit=(this.explicit||[]).concat(n),i.compiledImplicit=nt(i,"implicit"),i.compiledExplicit=nt(i,"explicit"),i.compiledTypeMap=br(i.compiledImplicit,i.compiledExplicit),i};var Ar=je,wr=new b("tag:yaml.org,2002:str",{kind:"scalar",construct:function(e){return e!==null?e:""}}),Fr=new b("tag:yaml.org,2002:seq",{kind:"sequence",construct:function(e){return e!==null?e:[]}}),Tr=new b("tag:yaml.org,2002:map",{kind:"mapping",construct:function(e){return e!==null?e:{}}}),Sr=new Ar({explicit:[wr,Fr,Tr]});function Er(e){if(e===null)return!0;var r=e.length;return r===1&&e==="~"||r===4&&(e==="null"||e==="Null"||e==="NULL")}function Dr(){return null}function Or(e){return e===null}var Nr=new b("tag:yaml.org,2002:null",{kind:"scalar",resolve:Er,construct:Dr,predicate:Or,represent:{canonical:function(){return"~"},lowercase:function(){return"null"},uppercase:function(){return"NULL"},camelcase:function(){return"Null"},empty:function(){return""}},defaultStyle:"lowercase"});function Ir(e){if(e===null)return!1;var r=e.length;return r===4&&(e==="true"||e==="True"||e==="TRUE")||r===5&&(e==="false"||e==="False"||e==="FALSE")}function _r(e){return e==="true"||e==="True"||e==="TRUE"}function kr(e){return Object.prototype.toString.call(e)==="[object Boolean]"}var Lr=new b("tag:yaml.org,2002:bool",{kind:"scalar",resolve:Ir,construct:_r,predicate:kr,represent:{lowercase:function(e){return e?"true":"false"},uppercase:function(e){return e?"TRUE":"FALSE"},camelcase:function(e){return e?"True":"False"}},defaultStyle:"lowercase"});function jr(e){return 48<=e&&e<=57||65<=e&&e<=70||97<=e&&e<=102}function Mr(e){return 48<=e&&e<=55}function Rr(e){return 48<=e&&e<=57}function Wr(e){if(e===null)return!1;var r=e.length,t=0,n=!1,i;if(!r)return!1;if(i=e[t],(i==="-"||i==="+")&&(i=e[++t]),i==="0"){if(t+1===r)return!0;if(i=e[++t],i==="b"){for(t++;t<r;t++)if(i=e[t],i!=="_"){if(i!=="0"&&i!=="1")return!1;n=!0}return n&&i!=="_"}if(i==="x"){for(t++;t<r;t++)if(i=e[t],i!=="_"){if(!jr(e.charCodeAt(t)))return!1;n=!0}return n&&i!=="_"}if(i==="o"){for(t++;t<r;t++)if(i=e[t],i!=="_"){if(!Mr(e.charCodeAt(t)))return!1;n=!0}return n&&i!=="_"}}if(i==="_")return!1;for(;t<r;t++)if(i=e[t],i!=="_"){if(!Rr(e.charCodeAt(t)))return!1;n=!0}return!(!n||i==="_")}function zr(e){var r=e,t=1,n;if(r.indexOf("_")!==-1&&(r=r.replace(/_/g,"")),n=r[0],(n==="-"||n==="+")&&(n==="-"&&(t=-1),r=r.slice(1),n=r[0]),r==="0")return 0;if(n==="0"){if(r[1]==="b")return t*parseInt(r.slice(2),2);if(r[1]==="x")return t*parseInt(r.slice(2),16);if(r[1]==="o")return t*parseInt(r.slice(2),8)}return t*parseInt(r,10)}function Br(e){return Object.prototype.toString.call(e)==="[object Number]"&&e%1===0&&!P.isNegativeZero(e)}var $r=new b("tag:yaml.org,2002:int",{kind:"scalar",resolve:Wr,construct:zr,predicate:Br,represent:{binary:function(e){return e>=0?"0b"+e.toString(2):"-0b"+e.toString(2).slice(1)},octal:function(e){return e>=0?"0o"+e.toString(8):"-0o"+e.toString(8).slice(1)},decimal:function(e){return e.toString(10)},hexadecimal:function(e){return e>=0?"0x"+e.toString(16).toUpperCase():"-0x"+e.toString(16).toUpperCase().slice(1)}},defaultStyle:"decimal",styleAliases:{binary:[2,"bin"],octal:[8,"oct"],decimal:[10,"dec"],hexadecimal:[16,"hex"]}}),Yr=new RegExp("^(?:[-+]?(?:[0-9][0-9_]*)(?:\\.[0-9_]*)?(?:[eE][-+]?[0-9]+)?|\\.[0-9_]+(?:[eE][-+]?[0-9]+)?|[-+]?\\.(?:inf|Inf|INF)|\\.(?:nan|NaN|NAN))$");function Hr(e){return!(e===null||!Yr.test(e)||e[e.length-1]==="_")}function Ur(e){var r,t;return r=e.replace(/_/g,"").toLowerCase(),t=r[0]==="-"?-1:1,"+-".indexOf(r[0])>=0&&(r=r.slice(1)),r===".inf"?t===1?Number.POSITIVE_INFINITY:Number.NEGATIVE_INFINITY:r===".nan"?NaN:t*parseFloat(r,10)}var Gr=/^[-+]?[0-9]+e/;function Vr(e,r){var t;if(isNaN(e))switch(r){case"lowercase":return".nan";case"uppercase":return".NAN";case"camelcase":return".NaN"}else if(Number.POSITIVE_INFINITY===e)switch(r){case"lowercase":return".inf";case"uppercase":return".INF";case"camelcase":return".Inf"}else if(Number.NEGATIVE_INFINITY===e)switch(r){case"lowercase":return"-.inf";case"uppercase":return"-.INF";case"camelcase":return"-.Inf"}else if(P.isNegativeZero(e))return"-0.0";return t=e.toString(10),Gr.test(t)?t.replace("e",".e"):t}function qr(e){return Object.prototype.toString.call(e)==="[object Number]"&&(e%1!==0||P.isNegativeZero(e))}var Kr=new b("tag:yaml.org,2002:float",{kind:"scalar",resolve:Hr,construct:Ur,predicate:qr,represent:Vr,defaultStyle:"lowercase"}),Jr=Sr.extend({implicit:[Nr,Lr,$r,Kr]}),Qr=Jr,Pt=new RegExp("^([0-9][0-9][0-9][0-9])-([0-9][0-9])-([0-9][0-9])$"),bt=new RegExp("^([0-9][0-9][0-9][0-9])-([0-9][0-9]?)-([0-9][0-9]?)(?:[Tt]|[ \\t]+)([0-9][0-9]?):([0-9][0-9]):([0-9][0-9])(?:\\.([0-9]*))?(?:[ \\t]*(Z|([-+])([0-9][0-9]?)(?::([0-9][0-9]))?))?$");function Xr(e){return e===null?!1:Pt.exec(e)!==null||bt.exec(e)!==null}function Zr(e){var r,t,n,i,o,a,s,l=0,p=null,f,c,u;if(r=Pt.exec(e),r===null&&(r=bt.exec(e)),r===null)throw new Error("Date resolve error");if(t=+r[1],n=+r[2]-1,i=+r[3],!r[4])return new Date(Date.UTC(t,n,i));if(o=+r[4],a=+r[5],s=+r[6],r[7]){for(l=r[7].slice(0,3);l.length<3;)l+="0";l=+l}return r[9]&&(f=+r[10],c=+(r[11]||0),p=(f*60+c)*6e4,r[9]==="-"&&(p=-p)),u=new Date(Date.UTC(t,n,i,o,a,s,l)),p&&u.setTime(u.getTime()-p),u}function ei(e){return e.toISOString()}var ti=new b("tag:yaml.org,2002:timestamp",{kind:"scalar",resolve:Xr,construct:Zr,instanceOf:Date,represent:ei});function ri(e){return e==="<<"||e===null}var ii=new b("tag:yaml.org,2002:merge",{kind:"scalar",resolve:ri}),Be=`ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=
\r`;function ni(e){if(e===null)return!1;var r,t,n=0,i=e.length,o=Be;for(t=0;t<i;t++)if(r=o.indexOf(e.charAt(t)),!(r>64)){if(r<0)return!1;n+=6}return n%8===0}function oi(e){var r,t,n=e.replace(/[\r\n=]/g,""),i=n.length,o=Be,a=0,s=[];for(r=0;r<i;r++)r%4===0&&r&&(s.push(a>>16&255),s.push(a>>8&255),s.push(a&255)),a=a<<6|o.indexOf(n.charAt(r));return t=i%4*6,t===0?(s.push(a>>16&255),s.push(a>>8&255),s.push(a&255)):t===18?(s.push(a>>10&255),s.push(a>>2&255)):t===12&&s.push(a>>4&255),new Uint8Array(s)}function ai(e){var r="",t=0,n,i,o=e.length,a=Be;for(n=0;n<o;n++)n%3===0&&n&&(r+=a[t>>18&63],r+=a[t>>12&63],r+=a[t>>6&63],r+=a[t&63]),t=(t<<8)+e[n];return i=o%3,i===0?(r+=a[t>>18&63],r+=a[t>>12&63],r+=a[t>>6&63],r+=a[t&63]):i===2?(r+=a[t>>10&63],r+=a[t>>4&63],r+=a[t<<2&63],r+=a[64]):i===1&&(r+=a[t>>2&63],r+=a[t<<4&63],r+=a[64],r+=a[64]),r}function si(e){return Object.prototype.toString.call(e)==="[object Uint8Array]"}var li=new b("tag:yaml.org,2002:binary",{kind:"scalar",resolve:ni,construct:oi,predicate:si,represent:ai}),pi=Object.prototype.hasOwnProperty,ci=Object.prototype.toString;function ui(e){if(e===null)return!0;var r=[],t,n,i,o,a,s=e;for(t=0,n=s.length;t<n;t+=1){if(i=s[t],a=!1,ci.call(i)!=="[object Object]")return!1;for(o in i)if(pi.call(i,o))if(!a)a=!0;else return!1;if(!a)return!1;if(r.indexOf(o)===-1)r.push(o);else return!1}return!0}function fi(e){return e!==null?e:[]}var di=new b("tag:yaml.org,2002:omap",{kind:"sequence",resolve:ui,construct:fi}),hi=Object.prototype.toString;function mi(e){if(e===null)return!0;var r,t,n,i,o,a=e;for(o=new Array(a.length),r=0,t=a.length;r<t;r+=1){if(n=a[r],hi.call(n)!=="[object Object]"||(i=Object.keys(n),i.length!==1))return!1;o[r]=[i[0],n[i[0]]]}return!0}function gi(e){if(e===null)return[];var r,t,n,i,o,a=e;for(o=new Array(a.length),r=0,t=a.length;r<t;r+=1)n=a[r],i=Object.keys(n),o[r]=[i[0],n[i[0]]];return o}var yi=new b("tag:yaml.org,2002:pairs",{kind:"sequence",resolve:mi,construct:gi}),vi=Object.prototype.hasOwnProperty;function xi(e){if(e===null)return!0;var r,t=e;for(r in t)if(vi.call(t,r)&&t[r]!==null)return!1;return!0}function Ci(e){return e!==null?e:{}}var Pi=new b("tag:yaml.org,2002:set",{kind:"mapping",resolve:xi,construct:Ci}),At=Qr.extend({implicit:[ti,ii],explicit:[li,di,yi,Pi]}),j=Object.prototype.hasOwnProperty,se=1,wt=2,Ft=3,le=4,Le=1,bi=2,ot=3,Ai=/[\x00-\x08\x0B\x0C\x0E-\x1F\x7F-\x84\x86-\x9F\uFFFE\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]/,wi=/[\x85\u2028\u2029]/,Fi=/[,\[\]\{\}]/,Tt=/^(?:!|!!|![a-z\-]+!)$/i,St=/^(?:!|[^,\[\]\{\}])(?:%[0-9a-f]{2}|[0-9a-z\-#;\/\?:@&=\+\$,_\.!~\*'\(\)\[\]])*$/i;function at(e){return Object.prototype.toString.call(e)}function O(e){return e===10||e===13}function W(e){return e===9||e===32}function S(e){return e===9||e===32||e===10||e===13}function Y(e){return e===44||e===91||e===93||e===123||e===125}function Ti(e){var r;return 48<=e&&e<=57?e-48:(r=e|32,97<=r&&r<=102?r-97+10:-1)}function Si(e){return e===120?2:e===117?4:e===85?8:0}function Ei(e){return 48<=e&&e<=57?e-48:-1}function st(e){return e===48?"\0":e===97?"\x07":e===98?"\b":e===116||e===9?"	":e===110?`
`:e===118?"\v":e===102?"\f":e===114?"\r":e===101?"\x1B":e===32?" ":e===34?'"':e===47?"/":e===92?"\\":e===78?"\x85":e===95?"\xA0":e===76?"\u2028":e===80?"\u2029":""}function Di(e){return e<=65535?String.fromCharCode(e):String.fromCharCode((e-65536>>10)+55296,(e-65536&1023)+56320)}function Et(e,r,t){r==="__proto__"?Object.defineProperty(e,r,{configurable:!0,enumerable:!0,writable:!0,value:t}):e[r]=t}var Dt=new Array(256),Ot=new Array(256);for(R=0;R<256;R++)Dt[R]=st(R)?1:0,Ot[R]=st(R);var R;function Oi(e,r){this.input=e,this.filename=r.filename||null,this.schema=r.schema||At,this.onWarning=r.onWarning||null,this.legacy=r.legacy||!1,this.json=r.json||!1,this.listener=r.listener||null,this.implicitTypes=this.schema.compiledImplicit,this.typeMap=this.schema.compiledTypeMap,this.length=e.length,this.position=0,this.line=0,this.lineStart=0,this.lineIndent=0,this.firstTabInLine=-1,this.documents=[]}function Nt(e,r){var t={name:e.filename,buffer:e.input.slice(0,-1),position:e.position,line:e.line,column:e.position-e.lineStart};return t.snippet=yr(t),new T(r,t)}function h(e,r){throw Nt(e,r)}function pe(e,r){e.onWarning&&e.onWarning.call(null,Nt(e,r))}var lt={YAML:function(r,t,n){var i,o,a;r.version!==null&&h(r,"duplication of %YAML directive"),n.length!==1&&h(r,"YAML directive accepts exactly one argument"),i=/^([0-9]+)\.([0-9]+)$/.exec(n[0]),i===null&&h(r,"ill-formed argument of the YAML directive"),o=parseInt(i[1],10),a=parseInt(i[2],10),o!==1&&h(r,"unacceptable YAML version of the document"),r.version=n[0],r.checkLineBreaks=a<2,a!==1&&a!==2&&pe(r,"unsupported YAML version of the document")},TAG:function(r,t,n){var i,o;n.length!==2&&h(r,"TAG directive accepts exactly two arguments"),i=n[0],o=n[1],Tt.test(i)||h(r,"ill-formed tag handle (first argument) of the TAG directive"),j.call(r.tagMap,i)&&h(r,'there is a previously declared suffix for "'+i+'" tag handle'),St.test(o)||h(r,"ill-formed tag prefix (second argument) of the TAG directive");try{o=decodeURIComponent(o)}catch(a){h(r,"tag prefix is malformed: "+o)}r.tagMap[i]=o}};function L(e,r,t,n){var i,o,a,s;if(r<t){if(s=e.input.slice(r,t),n)for(i=0,o=s.length;i<o;i+=1)a=s.charCodeAt(i),a===9||32<=a&&a<=1114111||h(e,"expected valid JSON character");else Ai.test(s)&&h(e,"the stream contains non-printable characters");e.result+=s}}function pt(e,r,t,n){var i,o,a,s;for(P.isObject(t)||h(e,"cannot merge mappings; the provided source object is unacceptable"),i=Object.keys(t),a=0,s=i.length;a<s;a+=1)o=i[a],j.call(r,o)||(Et(r,o,t[o]),n[o]=!0)}function H(e,r,t,n,i,o,a,s,l){var p,f;if(Array.isArray(i))for(i=Array.prototype.slice.call(i),p=0,f=i.length;p<f;p+=1)Array.isArray(i[p])&&h(e,"nested arrays are not supported inside keys"),typeof i=="object"&&at(i[p])==="[object Object]"&&(i[p]="[object Object]");if(typeof i=="object"&&at(i)==="[object Object]"&&(i="[object Object]"),i=String(i),r===null&&(r={}),n==="tag:yaml.org,2002:merge")if(Array.isArray(o))for(p=0,f=o.length;p<f;p+=1)pt(e,r,o[p],t);else pt(e,r,o,t);else!e.json&&!j.call(t,i)&&j.call(r,i)&&(e.line=a||e.line,e.lineStart=s||e.lineStart,e.position=l||e.position,h(e,"duplicated mapping key")),Et(r,i,o),delete t[i];return r}function $e(e){var r;r=e.input.charCodeAt(e.position),r===10?e.position++:r===13?(e.position++,e.input.charCodeAt(e.position)===10&&e.position++):h(e,"a line break is expected"),e.line+=1,e.lineStart=e.position,e.firstTabInLine=-1}function C(e,r,t){for(var n=0,i=e.input.charCodeAt(e.position);i!==0;){for(;W(i);)i===9&&e.firstTabInLine===-1&&(e.firstTabInLine=e.position),i=e.input.charCodeAt(++e.position);if(r&&i===35)do i=e.input.charCodeAt(++e.position);while(i!==10&&i!==13&&i!==0);if(O(i))for($e(e),i=e.input.charCodeAt(e.position),n++,e.lineIndent=0;i===32;)e.lineIndent++,i=e.input.charCodeAt(++e.position);else break}return t!==-1&&n!==0&&e.lineIndent<t&&pe(e,"deficient indentation"),n}function fe(e){var r=e.position,t;return t=e.input.charCodeAt(r),!!((t===45||t===46)&&t===e.input.charCodeAt(r+1)&&t===e.input.charCodeAt(r+2)&&(r+=3,t=e.input.charCodeAt(r),t===0||S(t)))}function Ye(e,r){r===1?e.result+=" ":r>1&&(e.result+=P.repeat(`
`,r-1))}function Ni(e,r,t){var n,i,o,a,s,l,p,f,c=e.kind,u=e.result,d;if(d=e.input.charCodeAt(e.position),S(d)||Y(d)||d===35||d===38||d===42||d===33||d===124||d===62||d===39||d===34||d===37||d===64||d===96||(d===63||d===45)&&(i=e.input.charCodeAt(e.position+1),S(i)||t&&Y(i)))return!1;for(e.kind="scalar",e.result="",o=a=e.position,s=!1;d!==0;){if(d===58){if(i=e.input.charCodeAt(e.position+1),S(i)||t&&Y(i))break}else if(d===35){if(n=e.input.charCodeAt(e.position-1),S(n))break}else{if(e.position===e.lineStart&&fe(e)||t&&Y(d))break;if(O(d))if(l=e.line,p=e.lineStart,f=e.lineIndent,C(e,!1,-1),e.lineIndent>=r){s=!0,d=e.input.charCodeAt(e.position);continue}else{e.position=a,e.line=l,e.lineStart=p,e.lineIndent=f;break}}s&&(L(e,o,a,!1),Ye(e,e.line-l),o=a=e.position,s=!1),W(d)||(a=e.position+1),d=e.input.charCodeAt(++e.position)}return L(e,o,a,!1),e.result?!0:(e.kind=c,e.result=u,!1)}function Ii(e,r){var t,n,i;if(t=e.input.charCodeAt(e.position),t!==39)return!1;for(e.kind="scalar",e.result="",e.position++,n=i=e.position;(t=e.input.charCodeAt(e.position))!==0;)if(t===39)if(L(e,n,e.position,!0),t=e.input.charCodeAt(++e.position),t===39)n=e.position,e.position++,i=e.position;else return!0;else O(t)?(L(e,n,i,!0),Ye(e,C(e,!1,r)),n=i=e.position):e.position===e.lineStart&&fe(e)?h(e,"unexpected end of the document within a single quoted scalar"):(e.position++,i=e.position);h(e,"unexpected end of the stream within a single quoted scalar")}function _i(e,r){var t,n,i,o,a,s;if(s=e.input.charCodeAt(e.position),s!==34)return!1;for(e.kind="scalar",e.result="",e.position++,t=n=e.position;(s=e.input.charCodeAt(e.position))!==0;){if(s===34)return L(e,t,e.position,!0),e.position++,!0;if(s===92){if(L(e,t,e.position,!0),s=e.input.charCodeAt(++e.position),O(s))C(e,!1,r);else if(s<256&&Dt[s])e.result+=Ot[s],e.position++;else if((a=Si(s))>0){for(i=a,o=0;i>0;i--)s=e.input.charCodeAt(++e.position),(a=Ti(s))>=0?o=(o<<4)+a:h(e,"expected hexadecimal character");e.result+=Di(o),e.position++}else h(e,"unknown escape sequence");t=n=e.position}else O(s)?(L(e,t,n,!0),Ye(e,C(e,!1,r)),t=n=e.position):e.position===e.lineStart&&fe(e)?h(e,"unexpected end of the document within a double quoted scalar"):(e.position++,n=e.position)}h(e,"unexpected end of the stream within a double quoted scalar")}function ki(e,r){var t=!0,n,i,o,a=e.tag,s,l=e.anchor,p,f,c,u,d,m=Object.create(null),g,v,F,y;if(y=e.input.charCodeAt(e.position),y===91)f=93,d=!1,s=[];else if(y===123)f=125,d=!0,s={};else return!1;for(e.anchor!==null&&(e.anchorMap[e.anchor]=s),y=e.input.charCodeAt(++e.position);y!==0;){if(C(e,!0,r),y=e.input.charCodeAt(e.position),y===f)return e.position++,e.tag=a,e.anchor=l,e.kind=d?"mapping":"sequence",e.result=s,!0;t?y===44&&h(e,"expected the node content, but found ','"):h(e,"missed comma between flow collection entries"),v=g=F=null,c=u=!1,y===63&&(p=e.input.charCodeAt(e.position+1),S(p)&&(c=u=!0,e.position++,C(e,!0,r))),n=e.line,i=e.lineStart,o=e.position,U(e,r,se,!1,!0),v=e.tag,g=e.result,C(e,!0,r),y=e.input.charCodeAt(e.position),(u||e.line===n)&&y===58&&(c=!0,y=e.input.charCodeAt(++e.position),C(e,!0,r),U(e,r,se,!1,!0),F=e.result),d?H(e,s,m,v,g,F,n,i,o):c?s.push(H(e,null,m,v,g,F,n,i,o)):s.push(g),C(e,!0,r),y=e.input.charCodeAt(e.position),y===44?(t=!0,y=e.input.charCodeAt(++e.position)):t=!1}h(e,"unexpected end of the stream within a flow collection")}function Li(e,r){var t,n,i=Le,o=!1,a=!1,s=r,l=0,p=!1,f,c;if(c=e.input.charCodeAt(e.position),c===124)n=!1;else if(c===62)n=!0;else return!1;for(e.kind="scalar",e.result="";c!==0;)if(c=e.input.charCodeAt(++e.position),c===43||c===45)Le===i?i=c===43?ot:bi:h(e,"repeat of a chomping mode identifier");else if((f=Ei(c))>=0)f===0?h(e,"bad explicit indentation width of a block scalar; it cannot be less than one"):a?h(e,"repeat of an indentation width identifier"):(s=r+f-1,a=!0);else break;if(W(c)){do c=e.input.charCodeAt(++e.position);while(W(c));if(c===35)do c=e.input.charCodeAt(++e.position);while(!O(c)&&c!==0)}for(;c!==0;){for($e(e),e.lineIndent=0,c=e.input.charCodeAt(e.position);(!a||e.lineIndent<s)&&c===32;)e.lineIndent++,c=e.input.charCodeAt(++e.position);if(!a&&e.lineIndent>s&&(s=e.lineIndent),O(c)){l++;continue}if(e.lineIndent<s){i===ot?e.result+=P.repeat(`
`,o?1+l:l):i===Le&&o&&(e.result+=`
`);break}for(n?W(c)?(p=!0,e.result+=P.repeat(`
`,o?1+l:l)):p?(p=!1,e.result+=P.repeat(`
`,l+1)):l===0?o&&(e.result+=" "):e.result+=P.repeat(`
`,l):e.result+=P.repeat(`
`,o?1+l:l),o=!0,a=!0,l=0,t=e.position;!O(c)&&c!==0;)c=e.input.charCodeAt(++e.position);L(e,t,e.position,!1)}return!0}function ct(e,r){var t,n=e.tag,i=e.anchor,o=[],a,s=!1,l;if(e.firstTabInLine!==-1)return!1;for(e.anchor!==null&&(e.anchorMap[e.anchor]=o),l=e.input.charCodeAt(e.position);l!==0&&(e.firstTabInLine!==-1&&(e.position=e.firstTabInLine,h(e,"tab characters must not be used in indentation")),!(l!==45||(a=e.input.charCodeAt(e.position+1),!S(a))));){if(s=!0,e.position++,C(e,!0,-1)&&e.lineIndent<=r){o.push(null),l=e.input.charCodeAt(e.position);continue}if(t=e.line,U(e,r,Ft,!1,!0),o.push(e.result),C(e,!0,-1),l=e.input.charCodeAt(e.position),(e.line===t||e.lineIndent>r)&&l!==0)h(e,"bad indentation of a sequence entry");else if(e.lineIndent<r)break}return s?(e.tag=n,e.anchor=i,e.kind="sequence",e.result=o,!0):!1}function ji(e,r,t){var n,i,o,a,s,l,p=e.tag,f=e.anchor,c={},u=Object.create(null),d=null,m=null,g=null,v=!1,F=!1,y;if(e.firstTabInLine!==-1)return!1;for(e.anchor!==null&&(e.anchorMap[e.anchor]=c),y=e.input.charCodeAt(e.position);y!==0;){if(!v&&e.firstTabInLine!==-1&&(e.position=e.firstTabInLine,h(e,"tab characters must not be used in indentation")),n=e.input.charCodeAt(e.position+1),o=e.line,(y===63||y===58)&&S(n))y===63?(v&&(H(e,c,u,d,m,null,a,s,l),d=m=g=null),F=!0,v=!0,i=!0):v?(v=!1,i=!0):h(e,"incomplete explicit mapping pair; a key node is missed; or followed by a non-tabulated empty line"),e.position+=1,y=n;else{if(a=e.line,s=e.lineStart,l=e.position,!U(e,t,wt,!1,!0))break;if(e.line===o){for(y=e.input.charCodeAt(e.position);W(y);)y=e.input.charCodeAt(++e.position);if(y===58)y=e.input.charCodeAt(++e.position),S(y)||h(e,"a whitespace character is expected after the key-value separator within a block mapping"),v&&(H(e,c,u,d,m,null,a,s,l),d=m=g=null),F=!0,v=!1,i=!1,d=e.tag,m=e.result;else if(F)h(e,"can not read an implicit mapping pair; a colon is missed");else return e.tag=p,e.anchor=f,!0}else if(F)h(e,"can not read a block mapping entry; a multiline key may not be an implicit key");else return e.tag=p,e.anchor=f,!0}if((e.line===o||e.lineIndent>r)&&(v&&(a=e.line,s=e.lineStart,l=e.position),U(e,r,le,!0,i)&&(v?m=e.result:g=e.result),v||(H(e,c,u,d,m,g,a,s,l),d=m=g=null),C(e,!0,-1),y=e.input.charCodeAt(e.position)),(e.line===o||e.lineIndent>r)&&y!==0)h(e,"bad indentation of a mapping entry");else if(e.lineIndent<r)break}return v&&H(e,c,u,d,m,null,a,s,l),F&&(e.tag=p,e.anchor=f,e.kind="mapping",e.result=c),F}function Mi(e){var r,t=!1,n=!1,i,o,a;if(a=e.input.charCodeAt(e.position),a!==33)return!1;if(e.tag!==null&&h(e,"duplication of a tag property"),a=e.input.charCodeAt(++e.position),a===60?(t=!0,a=e.input.charCodeAt(++e.position)):a===33?(n=!0,i="!!",a=e.input.charCodeAt(++e.position)):i="!",r=e.position,t){do a=e.input.charCodeAt(++e.position);while(a!==0&&a!==62);e.position<e.length?(o=e.input.slice(r,e.position),a=e.input.charCodeAt(++e.position)):h(e,"unexpected end of the stream within a verbatim tag")}else{for(;a!==0&&!S(a);)a===33&&(n?h(e,"tag suffix cannot contain exclamation marks"):(i=e.input.slice(r-1,e.position+1),Tt.test(i)||h(e,"named tag handle cannot contain such characters"),n=!0,r=e.position+1)),a=e.input.charCodeAt(++e.position);o=e.input.slice(r,e.position),Fi.test(o)&&h(e,"tag suffix cannot contain flow indicator characters")}o&&!St.test(o)&&h(e,"tag name cannot contain such characters: "+o);try{o=decodeURIComponent(o)}catch(s){h(e,"tag name is malformed: "+o)}return t?e.tag=o:j.call(e.tagMap,i)?e.tag=e.tagMap[i]+o:i==="!"?e.tag="!"+o:i==="!!"?e.tag="tag:yaml.org,2002:"+o:h(e,'undeclared tag handle "'+i+'"'),!0}function Ri(e){var r,t;if(t=e.input.charCodeAt(e.position),t!==38)return!1;for(e.anchor!==null&&h(e,"duplication of an anchor property"),t=e.input.charCodeAt(++e.position),r=e.position;t!==0&&!S(t)&&!Y(t);)t=e.input.charCodeAt(++e.position);return e.position===r&&h(e,"name of an anchor node must contain at least one character"),e.anchor=e.input.slice(r,e.position),!0}function Wi(e){var r,t,n;if(n=e.input.charCodeAt(e.position),n!==42)return!1;for(n=e.input.charCodeAt(++e.position),r=e.position;n!==0&&!S(n)&&!Y(n);)n=e.input.charCodeAt(++e.position);return e.position===r&&h(e,"name of an alias node must contain at least one character"),t=e.input.slice(r,e.position),j.call(e.anchorMap,t)||h(e,'unidentified alias "'+t+'"'),e.result=e.anchorMap[t],C(e,!0,-1),!0}function U(e,r,t,n,i){var o,a,s,l=1,p=!1,f=!1,c,u,d,m,g,v;if(e.listener!==null&&e.listener("open",e),e.tag=null,e.anchor=null,e.kind=null,e.result=null,o=a=s=le===t||Ft===t,n&&C(e,!0,-1)&&(p=!0,e.lineIndent>r?l=1:e.lineIndent===r?l=0:e.lineIndent<r&&(l=-1)),l===1)for(;Mi(e)||Ri(e);)C(e,!0,-1)?(p=!0,s=o,e.lineIndent>r?l=1:e.lineIndent===r?l=0:e.lineIndent<r&&(l=-1)):s=!1;if(s&&(s=p||i),(l===1||le===t)&&(se===t||wt===t?g=r:g=r+1,v=e.position-e.lineStart,l===1?s&&(ct(e,v)||ji(e,v,g))||ki(e,g)?f=!0:(a&&Li(e,g)||Ii(e,g)||_i(e,g)?f=!0:Wi(e)?(f=!0,(e.tag!==null||e.anchor!==null)&&h(e,"alias node should not have any properties")):Ni(e,g,se===t)&&(f=!0,e.tag===null&&(e.tag="?")),e.anchor!==null&&(e.anchorMap[e.anchor]=e.result)):l===0&&(f=s&&ct(e,v))),e.tag===null)e.anchor!==null&&(e.anchorMap[e.anchor]=e.result);else if(e.tag==="?"){for(e.result!==null&&e.kind!=="scalar"&&h(e,'unacceptable node kind for !<?> tag; it should be "scalar", not "'+e.kind+'"'),c=0,u=e.implicitTypes.length;c<u;c+=1)if(m=e.implicitTypes[c],m.resolve(e.result)){e.result=m.construct(e.result),e.tag=m.tag,e.anchor!==null&&(e.anchorMap[e.anchor]=e.result);break}}else if(e.tag!=="!"){if(j.call(e.typeMap[e.kind||"fallback"],e.tag))m=e.typeMap[e.kind||"fallback"][e.tag];else for(m=null,d=e.typeMap.multi[e.kind||"fallback"],c=0,u=d.length;c<u;c+=1)if(e.tag.slice(0,d[c].tag.length)===d[c].tag){m=d[c];break}m||h(e,"unknown tag !<"+e.tag+">"),e.result!==null&&m.kind!==e.kind&&h(e,"unacceptable node kind for !<"+e.tag+'> tag; it should be "'+m.kind+'", not "'+e.kind+'"'),m.resolve(e.result,e.tag)?(e.result=m.construct(e.result,e.tag),e.anchor!==null&&(e.anchorMap[e.anchor]=e.result)):h(e,"cannot resolve a node with !<"+e.tag+"> explicit tag")}return e.listener!==null&&e.listener("close",e),e.tag!==null||e.anchor!==null||f}function zi(e){var r=e.position,t,n,i,o=!1,a;for(e.version=null,e.checkLineBreaks=e.legacy,e.tagMap=Object.create(null),e.anchorMap=Object.create(null);(a=e.input.charCodeAt(e.position))!==0&&(C(e,!0,-1),a=e.input.charCodeAt(e.position),!(e.lineIndent>0||a!==37));){for(o=!0,a=e.input.charCodeAt(++e.position),t=e.position;a!==0&&!S(a);)a=e.input.charCodeAt(++e.position);for(n=e.input.slice(t,e.position),i=[],n.length<1&&h(e,"directive name must not be less than one character in length");a!==0;){for(;W(a);)a=e.input.charCodeAt(++e.position);if(a===35){do a=e.input.charCodeAt(++e.position);while(a!==0&&!O(a));break}if(O(a))break;for(t=e.position;a!==0&&!S(a);)a=e.input.charCodeAt(++e.position);i.push(e.input.slice(t,e.position))}a!==0&&$e(e),j.call(lt,n)?lt[n](e,n,i):pe(e,'unknown document directive "'+n+'"')}if(C(e,!0,-1),e.lineIndent===0&&e.input.charCodeAt(e.position)===45&&e.input.charCodeAt(e.position+1)===45&&e.input.charCodeAt(e.position+2)===45?(e.position+=3,C(e,!0,-1)):o&&h(e,"directives end mark is expected"),U(e,e.lineIndent-1,le,!1,!0),C(e,!0,-1),e.checkLineBreaks&&wi.test(e.input.slice(r,e.position))&&pe(e,"non-ASCII line breaks are interpreted as content"),e.documents.push(e.result),e.position===e.lineStart&&fe(e)){e.input.charCodeAt(e.position)===46&&(e.position+=3,C(e,!0,-1));return}if(e.position<e.length-1)h(e,"end of the stream or a document separator is expected");else return}function It(e,r){e=String(e),r=r||{},e.length!==0&&(e.charCodeAt(e.length-1)!==10&&e.charCodeAt(e.length-1)!==13&&(e+=`
`),e.charCodeAt(0)===65279&&(e=e.slice(1)));var t=new Oi(e,r),n=e.indexOf("\0");for(n!==-1&&(t.position=n,h(t,"null byte is not allowed in input")),t.input+="\0";t.input.charCodeAt(t.position)===32;)t.lineIndent+=1,t.position+=1;for(;t.position<t.length-1;)zi(t);return t.documents}function Bi(e,r,t){r!==null&&typeof r=="object"&&typeof t=="undefined"&&(t=r,r=null);var n=It(e,t);if(typeof r!="function")return n;for(var i=0,o=n.length;i<o;i+=1)r(n[i])}function $i(e,r){var t=It(e,r);if(t.length!==0){if(t.length===1)return t[0];throw new T("expected a single document in the stream, but found more")}}var Yi=Bi,Hi=$i,_t={loadAll:Yi,load:Hi},kt=Object.prototype.toString,Lt=Object.prototype.hasOwnProperty,He=65279,Ui=9,J=10,Gi=13,Vi=32,qi=33,Ki=34,Me=35,Ji=37,Qi=38,Xi=39,Zi=42,jt=44,en=45,ce=58,tn=61,rn=62,nn=63,on=64,Mt=91,Rt=93,an=96,Wt=123,sn=124,zt=125,A={};A[0]="\\0";A[7]="\\a";A[8]="\\b";A[9]="\\t";A[10]="\\n";A[11]="\\v";A[12]="\\f";A[13]="\\r";A[27]="\\e";A[34]='\\"';A[92]="\\\\";A[133]="\\N";A[160]="\\_";A[8232]="\\L";A[8233]="\\P";var ln=["y","Y","yes","Yes","YES","on","On","ON","n","N","no","No","NO","off","Off","OFF"],pn=/^[-+]?[0-9_]+(?::[0-9_]+)+(?:\.[0-9_]*)?$/;function cn(e,r){var t,n,i,o,a,s,l;if(r===null)return{};for(t={},n=Object.keys(r),i=0,o=n.length;i<o;i+=1)a=n[i],s=String(r[a]),a.slice(0,2)==="!!"&&(a="tag:yaml.org,2002:"+a.slice(2)),l=e.compiledTypeMap.fallback[a],l&&Lt.call(l.styleAliases,s)&&(s=l.styleAliases[s]),t[a]=s;return t}function un(e){var r,t,n;if(r=e.toString(16).toUpperCase(),e<=255)t="x",n=2;else if(e<=65535)t="u",n=4;else if(e<=4294967295)t="U",n=8;else throw new T("code point within a string may not be greater than 0xFFFFFFFF");return"\\"+t+P.repeat("0",n-r.length)+r}var fn=1,Q=2;function dn(e){this.schema=e.schema||At,this.indent=Math.max(1,e.indent||2),this.noArrayIndent=e.noArrayIndent||!1,this.skipInvalid=e.skipInvalid||!1,this.flowLevel=P.isNothing(e.flowLevel)?-1:e.flowLevel,this.styleMap=cn(this.schema,e.styles||null),this.sortKeys=e.sortKeys||!1,this.lineWidth=e.lineWidth||80,this.noRefs=e.noRefs||!1,this.noCompatMode=e.noCompatMode||!1,this.condenseFlow=e.condenseFlow||!1,this.quotingType=e.quotingType==='"'?Q:fn,this.forceQuotes=e.forceQuotes||!1,this.replacer=typeof e.replacer=="function"?e.replacer:null,this.implicitTypes=this.schema.compiledImplicit,this.explicitTypes=this.schema.compiledExplicit,this.tag=null,this.result="",this.duplicates=[],this.usedDuplicates=null}function ut(e,r){for(var t=P.repeat(" ",r),n=0,i=-1,o="",a,s=e.length;n<s;)i=e.indexOf(`
`,n),i===-1?(a=e.slice(n),n=s):(a=e.slice(n,i+1),n=i+1),a.length&&a!==`
`&&(o+=t),o+=a;return o}function Re(e,r){return`
`+P.repeat(" ",e.indent*r)}function hn(e,r){var t,n,i;for(t=0,n=e.implicitTypes.length;t<n;t+=1)if(i=e.implicitTypes[t],i.resolve(r))return!0;return!1}function ue(e){return e===Vi||e===Ui}function X(e){return 32<=e&&e<=126||161<=e&&e<=55295&&e!==8232&&e!==8233||57344<=e&&e<=65533&&e!==He||65536<=e&&e<=1114111}function ft(e){return X(e)&&e!==He&&e!==Gi&&e!==J}function dt(e,r,t){var n=ft(e),i=n&&!ue(e);return(t?n:n&&e!==jt&&e!==Mt&&e!==Rt&&e!==Wt&&e!==zt)&&e!==Me&&!(r===ce&&!i)||ft(r)&&!ue(r)&&e===Me||r===ce&&i}function mn(e){return X(e)&&e!==He&&!ue(e)&&e!==en&&e!==nn&&e!==ce&&e!==jt&&e!==Mt&&e!==Rt&&e!==Wt&&e!==zt&&e!==Me&&e!==Qi&&e!==Zi&&e!==qi&&e!==sn&&e!==tn&&e!==rn&&e!==Xi&&e!==Ki&&e!==Ji&&e!==on&&e!==an}function gn(e){return!ue(e)&&e!==ce}function q(e,r){var t=e.charCodeAt(r),n;return t>=55296&&t<=56319&&r+1<e.length&&(n=e.charCodeAt(r+1),n>=56320&&n<=57343)?(t-55296)*1024+n-56320+65536:t}function Bt(e){var r=/^\n* /;return r.test(e)}var $t=1,We=2,Yt=3,Ht=4,$=5;function yn(e,r,t,n,i,o,a,s){var l,p=0,f=null,c=!1,u=!1,d=n!==-1,m=-1,g=mn(q(e,0))&&gn(q(e,e.length-1));if(r||a)for(l=0;l<e.length;p>=65536?l+=2:l++){if(p=q(e,l),!X(p))return $;g=g&&dt(p,f,s),f=p}else{for(l=0;l<e.length;p>=65536?l+=2:l++){if(p=q(e,l),p===J)c=!0,d&&(u=u||l-m-1>n&&e[m+1]!==" ",m=l);else if(!X(p))return $;g=g&&dt(p,f,s),f=p}u=u||d&&l-m-1>n&&e[m+1]!==" "}return!c&&!u?g&&!a&&!i(e)?$t:o===Q?$:We:t>9&&Bt(e)?$:a?o===Q?$:We:u?Ht:Yt}function vn(e,r,t,n,i){e.dump=function(){if(r.length===0)return e.quotingType===Q?'""':"''";if(!e.noCompatMode&&(ln.indexOf(r)!==-1||pn.test(r)))return e.quotingType===Q?'"'+r+'"':"'"+r+"'";var o=e.indent*Math.max(1,t),a=e.lineWidth===-1?-1:Math.max(Math.min(e.lineWidth,40),e.lineWidth-o),s=n||e.flowLevel>-1&&t>=e.flowLevel;function l(p){return hn(e,p)}switch(yn(r,s,e.indent,a,l,e.quotingType,e.forceQuotes&&!n,i)){case $t:return r;case We:return"'"+r.replace(/'/g,"''")+"'";case Yt:return"|"+ht(r,e.indent)+mt(ut(r,o));case Ht:return">"+ht(r,e.indent)+mt(ut(xn(r,a),o));case $:return'"'+Cn(r)+'"';default:throw new T("impossible error: invalid scalar style")}}()}function ht(e,r){var t=Bt(e)?String(r):"",n=e[e.length-1]===`
`,i=n&&(e[e.length-2]===`
`||e===`
`),o=i?"+":n?"":"-";return t+o+`
`}function mt(e){return e[e.length-1]===`
`?e.slice(0,-1):e}function xn(e,r){for(var t=/(\n+)([^\n]*)/g,n=function(){var p=e.indexOf(`
`);return p=p!==-1?p:e.length,t.lastIndex=p,gt(e.slice(0,p),r)}(),i=e[0]===`
`||e[0]===" ",o,a;a=t.exec(e);){var s=a[1],l=a[2];o=l[0]===" ",n+=s+(!i&&!o&&l!==""?`
`:"")+gt(l,r),i=o}return n}function gt(e,r){if(e===""||e[0]===" ")return e;for(var t=/ [^ ]/g,n,i=0,o,a=0,s=0,l="";n=t.exec(e);)s=n.index,s-i>r&&(o=a>i?a:s,l+=`
`+e.slice(i,o),i=o+1),a=s;return l+=`
`,e.length-i>r&&a>i?l+=e.slice(i,a)+`
`+e.slice(a+1):l+=e.slice(i),l.slice(1)}function Cn(e){for(var r="",t=0,n,i=0;i<e.length;t>=65536?i+=2:i++)t=q(e,i),n=A[t],!n&&X(t)?(r+=e[i],t>=65536&&(r+=e[i+1])):r+=n||un(t);return r}function Pn(e,r,t){var n="",i=e.tag,o,a,s;for(o=0,a=t.length;o<a;o+=1)s=t[o],e.replacer&&(s=e.replacer.call(t,String(o),s)),(_(e,r,s,!1,!1)||typeof s=="undefined"&&_(e,r,null,!1,!1))&&(n!==""&&(n+=","+(e.condenseFlow?"":" ")),n+=e.dump);e.tag=i,e.dump="["+n+"]"}function yt(e,r,t,n){var i="",o=e.tag,a,s,l;for(a=0,s=t.length;a<s;a+=1)l=t[a],e.replacer&&(l=e.replacer.call(t,String(a),l)),(_(e,r+1,l,!0,!0,!1,!0)||typeof l=="undefined"&&_(e,r+1,null,!0,!0,!1,!0))&&((!n||i!=="")&&(i+=Re(e,r)),e.dump&&J===e.dump.charCodeAt(0)?i+="-":i+="- ",i+=e.dump);e.tag=o,e.dump=i||"[]"}function bn(e,r,t){var n="",i=e.tag,o=Object.keys(t),a,s,l,p,f;for(a=0,s=o.length;a<s;a+=1)f="",n!==""&&(f+=", "),e.condenseFlow&&(f+='"'),l=o[a],p=t[l],e.replacer&&(p=e.replacer.call(t,l,p)),_(e,r,l,!1,!1)&&(e.dump.length>1024&&(f+="? "),f+=e.dump+(e.condenseFlow?'"':"")+":"+(e.condenseFlow?"":" "),_(e,r,p,!1,!1)&&(f+=e.dump,n+=f));e.tag=i,e.dump="{"+n+"}"}function An(e,r,t,n){var i="",o=e.tag,a=Object.keys(t),s,l,p,f,c,u;if(e.sortKeys===!0)a.sort();else if(typeof e.sortKeys=="function")a.sort(e.sortKeys);else if(e.sortKeys)throw new T("sortKeys must be a boolean or a function");for(s=0,l=a.length;s<l;s+=1)u="",(!n||i!=="")&&(u+=Re(e,r)),p=a[s],f=t[p],e.replacer&&(f=e.replacer.call(t,p,f)),_(e,r+1,p,!0,!0,!0)&&(c=e.tag!==null&&e.tag!=="?"||e.dump&&e.dump.length>1024,c&&(e.dump&&J===e.dump.charCodeAt(0)?u+="?":u+="? "),u+=e.dump,c&&(u+=Re(e,r)),_(e,r+1,f,!0,c)&&(e.dump&&J===e.dump.charCodeAt(0)?u+=":":u+=": ",u+=e.dump,i+=u));e.tag=o,e.dump=i||"{}"}function vt(e,r,t){var n,i,o,a,s,l;for(i=t?e.explicitTypes:e.implicitTypes,o=0,a=i.length;o<a;o+=1)if(s=i[o],(s.instanceOf||s.predicate)&&(!s.instanceOf||typeof r=="object"&&r instanceof s.instanceOf)&&(!s.predicate||s.predicate(r))){if(t?s.multi&&s.representName?e.tag=s.representName(r):e.tag=s.tag:e.tag="?",s.represent){if(l=e.styleMap[s.tag]||s.defaultStyle,kt.call(s.represent)==="[object Function]")n=s.represent(r,l);else if(Lt.call(s.represent,l))n=s.represent[l](r,l);else throw new T("!<"+s.tag+'> tag resolver accepts not "'+l+'" style');e.dump=n}return!0}return!1}function _(e,r,t,n,i,o,a){e.tag=null,e.dump=t,vt(e,t,!1)||vt(e,t,!0);var s=kt.call(e.dump),l=n,p;n&&(n=e.flowLevel<0||e.flowLevel>r);var f=s==="[object Object]"||s==="[object Array]",c,u;if(f&&(c=e.duplicates.indexOf(t),u=c!==-1),(e.tag!==null&&e.tag!=="?"||u||e.indent!==2&&r>0)&&(i=!1),u&&e.usedDuplicates[c])e.dump="*ref_"+c;else{if(f&&u&&!e.usedDuplicates[c]&&(e.usedDuplicates[c]=!0),s==="[object Object]")n&&Object.keys(e.dump).length!==0?(An(e,r,e.dump,i),u&&(e.dump="&ref_"+c+e.dump)):(bn(e,r,e.dump),u&&(e.dump="&ref_"+c+" "+e.dump));else if(s==="[object Array]")n&&e.dump.length!==0?(e.noArrayIndent&&!a&&r>0?yt(e,r-1,e.dump,i):yt(e,r,e.dump,i),u&&(e.dump="&ref_"+c+e.dump)):(Pn(e,r,e.dump),u&&(e.dump="&ref_"+c+" "+e.dump));else if(s==="[object String]")e.tag!=="?"&&vn(e,e.dump,r,o,l);else{if(s==="[object Undefined]")return!1;if(e.skipInvalid)return!1;throw new T("unacceptable kind of an object to dump "+s)}e.tag!==null&&e.tag!=="?"&&(p=encodeURI(e.tag[0]==="!"?e.tag.slice(1):e.tag).replace(/!/g,"%21"),e.tag[0]==="!"?p="!"+p:p.slice(0,18)==="tag:yaml.org,2002:"?p="!!"+p.slice(18):p="!<"+p+">",e.dump=p+" "+e.dump)}return!0}function wn(e,r){var t=[],n=[],i,o;for(ze(e,t,n),i=0,o=n.length;i<o;i+=1)r.duplicates.push(t[n[i]]);r.usedDuplicates=new Array(o)}function ze(e,r,t){var n,i,o;if(e!==null&&typeof e=="object")if(i=r.indexOf(e),i!==-1)t.indexOf(i)===-1&&t.push(i);else if(r.push(e),Array.isArray(e))for(i=0,o=e.length;i<o;i+=1)ze(e[i],r,t);else for(n=Object.keys(e),i=0,o=n.length;i<o;i+=1)ze(e[n[i]],r,t)}function Fn(e,r){r=r||{};var t=new dn(r);t.noRefs||wn(e,t);var n=e;return t.replacer&&(n=t.replacer.call({"":n},"",n)),_(t,0,n,!0,!0)?t.dump+`
`:""}var Tn=Fn,Sn={dump:Tn};function Ue(e,r){return function(){throw new Error("Function yaml."+e+" is removed in js-yaml 4. Use yaml."+r+" instead, which is now safe by default.")}}var de=_t.load,Kn=_t.loadAll,Jn=Sn.dump;var Qn=Ue("safeLoad","load"),Xn=Ue("safeLoadAll","loadAll"),Zn=Ue("safeDump","dump");var he=class{constructor(r){this.app=r}async findExampleFile(r){let t=this.app.vault.getAbstractFileByPath(r);if(!t)return null;if(t instanceof Ge.TFile&&t.extension==="md")return await this.parseFrontmatter(t);let n=this.getMarkdownFiles(t);for(let i of n){let o=await this.parseFrontmatter(i);if(o)return o}return null}getMarkdownFiles(r){let t=[];if(r.children)for(let n of r.children)n instanceof Ge.TFile&&n.extension==="md"?t.push(n):n.children&&t.push(...this.getMarkdownFiles(n));return t}async parseFrontmatter(r){try{let t=await this.app.vault.read(r),n=/^---\s*\n([\s\S]*?)\n---\s*\n/,i=t.match(n);if(!i)return null;let o=i[1],a=de(o);return!a||typeof a!="object"?null:{file:r.path,frontmatter:a,rawYaml:o}}catch(t){return null}}autoDetectDateProperty(r){let t=["date","pubDate","publishedDate","publishDate"];for(let n of t)if(r.hasOwnProperty(n))return n;return"date"}autoDetectDescriptionProperty(r){let t=["description","summary","excerpt","intro","snippet","blurb"];for(let n of t)if(r.hasOwnProperty(n))return n;return null}autoDetectTagsProperty(r){let t=["tags","tag","categories","category"];for(let n of t)if(r.hasOwnProperty(n))return n;return null}autoDetectDraftProperty(r){if(r.hasOwnProperty("draft")){let t=r.draft;if(typeof t=="boolean")return{property:"draft",logic:t?"true-draft":"false-draft"};if(typeof t=="string"){if(t.toLowerCase()==="draft"||t.toLowerCase()==="true")return{property:"draft",logic:"true-draft"};if(t.toLowerCase()==="published"||t.toLowerCase()==="false")return{property:"draft",logic:"false-draft"}}return{property:"draft",logic:"true-draft"}}return r.hasOwnProperty("published")?{property:"published",logic:"false-draft"}:null}autoDetectImageProperty(r){let t=["image","cover","coverImage","thumbnail","featuredImage"];for(let n of t)if(r.hasOwnProperty(n))return n;return null}};var me=class extends x{constructor(t,n,i,o,a,s){super(t,n,i,o,a,s);this.examples={};this.frontmatterAnalyzer=new he(t)}async display(){let{containerEl:t}=this;t.empty(),t.createEl("h2",{text:"Frontmatter Properties"}),t.createEl("p",{text:"Map frontmatter properties for each content type. We'll find example files to help you."});for(let n of this.state.contentTypes){if(!n.enabled)continue;if(!this.examples[n.id]){let s=await this.frontmatterAnalyzer.findExampleFile(n.folder);s&&(this.examples[n.id]=s)}let i=this.examples[n.id];if(t.createEl("h3",{text:n.name}),i){t.createEl("p",{text:`Example file: ${i.file}`}),t.createEl("pre",{text:i.rawYaml,cls:"frontmatter-example"});let s=this.frontmatterAnalyzer.autoDetectDateProperty(i.frontmatter),l=this.frontmatterAnalyzer.autoDetectDescriptionProperty(i.frontmatter)}if(!this.state.frontmatterProperties[n.id]){let s=i?this.frontmatterAnalyzer.autoDetectDraftProperty(i.frontmatter):null;this.state.frontmatterProperties[n.id]={titleProperty:"title",dateProperty:i?this.frontmatterAnalyzer.autoDetectDateProperty(i.frontmatter):"date",descriptionProperty:i&&this.frontmatterAnalyzer.autoDetectDescriptionProperty(i.frontmatter)||void 0,tagsProperty:i&&this.frontmatterAnalyzer.autoDetectTagsProperty(i.frontmatter)||void 0,draftProperty:s==null?void 0:s.property,draftLogic:(s==null?void 0:s.logic)||"true-draft",imageProperty:i&&this.frontmatterAnalyzer.autoDetectImageProperty(i.frontmatter)||void 0}}let o=this.state.frontmatterProperties[n.id];if(new E.Setting(t).setName("Title Property").setDesc("The frontmatter property that contains the title").addText(s=>s.setValue(o.titleProperty).onChange(l=>{o.titleProperty=l||"title"})),new E.Setting(t).setName("Date Property").setDesc("The frontmatter property that contains the date").addText(s=>s.setValue(o.dateProperty).onChange(l=>{o.dateProperty=l||"date"})),new E.Setting(t).setName("Has Description/Summary?").setDesc("Does this content type have a description or summary field?").addToggle(s=>s.setValue(!!o.descriptionProperty).onChange(l=>{l&&!o.descriptionProperty?o.descriptionProperty=i&&this.frontmatterAnalyzer.autoDetectDescriptionProperty(i.frontmatter)||"description":l||(o.descriptionProperty=void 0)})),o.descriptionProperty&&new E.Setting(t).setName("Description Property").setDesc("The frontmatter property that contains the description (e.g., description, summary, excerpt, intro, snippet, blurb)").addText(s=>s.setValue(o.descriptionProperty||"").onChange(l=>{o.descriptionProperty=l||void 0})),new E.Setting(t).setName("Has Tags?").setDesc("Does this content type have tags?").addToggle(s=>s.setValue(!!o.tagsProperty).onChange(l=>{l&&!o.tagsProperty?o.tagsProperty=i&&this.frontmatterAnalyzer.autoDetectTagsProperty(i.frontmatter)||"tags":l||(o.tagsProperty=void 0)})),o.tagsProperty&&new E.Setting(t).setName("Tags Property").setDesc("The frontmatter property that contains tags (e.g., tags, tag, categories, category)").addText(s=>s.setValue(o.tagsProperty||"").onChange(l=>{o.tagsProperty=l||void 0})),new E.Setting(t).setName("Has Draft Status?").setDesc("Does this content type have draft status?").addToggle(s=>s.setValue(!!o.draftProperty).onChange(l=>{if(l&&!o.draftProperty){let p=i?this.frontmatterAnalyzer.autoDetectDraftProperty(i.frontmatter):null;o.draftProperty=(p==null?void 0:p.property)||"draft",o.draftLogic=(p==null?void 0:p.logic)||"true-draft"}else l||(o.draftProperty=void 0,o.draftLogic=void 0)})),o.draftProperty&&(new E.Setting(t).setName("Draft Property").setDesc("The frontmatter property that contains draft status").addText(s=>s.setValue(o.draftProperty||"").onChange(l=>{o.draftProperty=l||void 0})),new E.Setting(t).setName("Draft Logic").setDesc("How draft status is represented").addDropdown(s=>s.addOption("true-draft","true = draft").addOption("false-draft","false = draft").addOption("underscore","underscore prefix = draft").setValue(o.draftLogic||"true-draft").onChange(l=>{o.draftLogic=l}))),new E.Setting(t).setName("Has Image/Cover Property?").setDesc("Does this content type have an image or cover property? Used for Bases CMS cover images, Simple Banner, and Image Inserter.").addToggle(s=>s.setValue(!!o.imageProperty).onChange(l=>{l&&!o.imageProperty?o.imageProperty=i&&this.frontmatterAnalyzer.autoDetectImageProperty(i.frontmatter)||"image":l||(o.imageProperty=void 0)})),o.imageProperty&&new E.Setting(t).setName("Image Property").setDesc("The frontmatter property that contains the image/cover (e.g., image, cover, coverImage, thumbnail, featuredImage)").addText(s=>s.setValue(o.imageProperty||"").onChange(l=>{o.imageProperty=l||void 0})),t.createEl("h4",{text:"Template"}),t.createEl("p",{text:"Edit the template that will be used when creating new files of this content type. Use {{title}} and {{date}} as placeholders."}),!o.template){let s=n.name==="Posts";o.template=this.generateDefaultTemplate(o,s,i)}let a=t.createEl("textarea",{cls:"template-editor",attr:{rows:"10",style:"width: 100%; font-family: monospace;"}});a.value=o.template||"",a.addEventListener("input",s=>{let l=s.target;o.template=l.value})}}generateDefaultTemplate(t,n,i){let o=`---
`;if(i&&i.rawYaml){let a=i.rawYaml.split(`
`),s=new Set,l=!1;for(let p of a){let f=p.trim();if(!f||f.startsWith("#"))continue;let c=f.indexOf(":");if(c>0){let u=f.substring(0,c).trim();if(u===t.titleProperty){o+=`${t.titleProperty}: "{{title}}"
`,l=!0,s.add(u);continue}}}l||(o+=`${t.titleProperty}: "{{title}}"
`);for(let p of a){let f=p.trim();if(!f||f.startsWith("#"))continue;let c=f.indexOf(":");if(c>0){let u=f.substring(0,c).trim();if(s.has(u)||u===t.titleProperty)continue;if(u===t.dateProperty&&n){o+=`${t.dateProperty}: {{date}}
`,s.add(u);continue}if(u===t.descriptionProperty){o+=`${t.descriptionProperty}: ""
`,s.add(u);continue}let d=i.frontmatter[u];d==null?o+=`${u}:
`:Array.isArray(d)?o+=`${u}: []
`:typeof d=="boolean"?o+=`${u}: ${d}
`:typeof d=="number"?o+=`${u}: ${d}
`:typeof d=="string"?/^\d{4}-\d{2}-\d{2}/.test(d)&&u.toLowerCase().includes("date")?o+=`${u}: {{date}}
`:o+=`${u}: ""
`:typeof d=="object"&&(Array.isArray(d)?o+=`${u}: []
`:o+=`${u}:
`),s.add(u)}}}else o+=`${t.titleProperty}: "{{title}}"
`,n&&t.dateProperty&&(o+=`${t.dateProperty}: {{date}}
`),t.descriptionProperty&&(o+=`${t.descriptionProperty}: ""
`),o+=`tags: []
`,o+=`draft: true
`;return o+=`---
`,o}validate(){for(let t of this.state.contentTypes)if(t.enabled){let n=this.state.frontmatterProperties[t.id];if(!n||!n.titleProperty||!n.dateProperty)return!1}return!0}getTitle(){return"Frontmatter Properties"}getDescription(){return"Map frontmatter properties"}};var Gt=require("obsidian");var ge=class extends x{display(){let{containerEl:r}=this;r.empty(),r.createEl("h2",{text:"WYSIWYG Editing Toolbar"}),r.createEl("p",{text:"Do you want to use the WYSIWYG editing toolbar?"}),r.createEl("p",{text:"This enables a visual editing toolbar for formatting text. The toolbar can be toggled on/off via command."}),new Gt.Setting(r).setName("Enable WYSIWYG Toolbar").setDesc("Show the editing toolbar command in the page header").addToggle(t=>t.setValue(this.state.enableWYSIWYG).onChange(n=>{this.state.enableWYSIWYG=n}))}validate(){return!0}getTitle(){return"WYSIWYG Preference"}getDescription(){return"Configure editing toolbar preference"}};var ye=class extends x{display(){let{containerEl:r}=this;r.empty(),r.createEl("h2",{text:"Bases CMS Configuration"}),r.createEl("p",{text:"Bases CMS views will be automatically created for each enabled content type using your mapped frontmatter properties."});let t=this.state.contentTypes.filter(i=>i.enabled);if(t.length===0){r.createEl("p",{text:"No content types enabled. Please go back and enable at least one content type."});return}r.createEl("h3",{text:"Views to be created:"});let n=r.createEl("ul");for(let i of t){let o=this.state.frontmatterProperties[i.id];o&&n.createEl("li",{text:`${i.name}: ${o.titleProperty}, ${o.dateProperty}${o.descriptionProperty?`, ${o.descriptionProperty}`:""}`})}r.createEl("p",{text:"You can customize these views later in the Bases CMS settings."})}validate(){return this.state.contentTypes.some(r=>r.enabled)}getTitle(){return"Bases CMS Configuration"}getDescription(){return"Configure Bases CMS views"}};var ve=class extends x{display(){var i;let{containerEl:r}=this;r.empty(),r.createEl("h2",{text:"Astro Composer Configuration"}),r.createEl("p",{text:"Astro Composer will be configured with your content types and frontmatter properties."});let t=this.state.contentTypes.filter(o=>o.enabled);if(t.length===0){r.createEl("p",{text:"No content types enabled."});return}r.createEl("h3",{text:"Content types to configure:"});let n=r.createEl("ul");for(let o of t)this.state.frontmatterProperties[o.id]&&n.createEl("li",{text:`${o.name} (${o.folder}): ${o.organizationMode} mode`});(i=this.state.projectDetection)!=null&&i.configFilePath&&r.createEl("p",{text:`Config file: ${this.state.projectDetection.configFilePath}`})}validate(){return!0}getTitle(){return"Astro Composer Configuration"}getDescription(){return"Configure Astro Composer"}};var Vt=require("obsidian");var xe=class extends x{display(){let{containerEl:r}=this;r.empty(),r.createEl("h2",{text:"SEO Plugin Configuration"}),r.createEl("p",{text:"SEO plugin will be configured using your mapped frontmatter properties."});let t=this.state.contentTypes.find(i=>i.enabled),n=t?this.state.frontmatterProperties[t.id]:void 0;if(n){r.createEl("h3",{text:"Configuration:"}),r.createEl("p",{text:`Title property: ${n.titleProperty}`}),n.descriptionProperty&&r.createEl("p",{text:`Description property: ${n.descriptionProperty}`});let i=this.state.contentTypes.filter(o=>o.enabled).map(o=>o.folder).join(", ");r.createEl("p",{text:`Scan directories: ${i}`})}new Vt.Setting(r).setName("Scan Directories").setDesc("Comma-separated list of directories to scan (you can customize this)").addText(i=>i.setValue(this.state.contentTypes.filter(o=>o.enabled).map(o=>o.folder).join(",")).onChange(o=>{this.state.seoConfig&&(this.state.seoConfig.scanDirectories=o)}))}validate(){return!0}getTitle(){return"SEO Configuration"}getDescription(){return"Configure SEO plugin"}};var qt=require("obsidian");var G=class{constructor(r){this.app=r}async enablePlugin(r){let t=this.app.plugins;if(!t)return;let n=t.plugins[r];n&&!n.enabled&&await t.enablePlugin(r)}async disablePlugin(r){let t=this.app.plugins;if(!t)return;let n=t.plugins[r];n&&n.enabled&&await t.disablePlugin(r)}async setPluginStates(r,t){for(let n of t)await this.disablePlugin(n);for(let n of r)await this.enablePlugin(n)}getPresetPlugins(r){let t=["astro-composer","bases-cms","homepage","new-tab-default-page","seo","property-over-file-name","settings-search","statusbar-organizer","zenmode","cmdr","editing-toolbar","simple-focus","tag-wrangler"],n=["insert-unsplash-image","custom-save","title-only-tab","obsidian-paste-image-rename","obsidian42-brat","obsidian-hider","disable-tabs","obsidian-style-settings","mdx-as-md-obsidian"],i=["obsidian-oxygen","obsidian-style-settings"];return r==="vanilla"?{enabled:[...t,...n.filter(o=>!i.includes(o))],disabled:i}:r==="opinionated"?{enabled:[...t,...n],disabled:[]}:{enabled:[],disabled:[]}}};var Ce=class extends x{constructor(t,n,i,o,a,s){super(t,n,i,o,a,s);this.pluginManager=new G(t)}display(){let{containerEl:t}=this;if(t.empty(),this.state.preset!=="custom"){t.createEl("h2",{text:"Plugin Configuration"}),t.createEl("p",{text:`Using ${this.state.preset} preset. Plugins will be configured automatically.`});return}t.createEl("h2",{text:"Optional Plugins"}),t.createEl("p",{text:"Select which plugins to enable:"});let n=[{id:"insert-unsplash-image",name:"Image Inserter"},{id:"title-only-tab",name:"Title Only Tab"},{id:"obsidian-paste-image-rename",name:"Paste Image Rename"},{id:"obsidian42-brat",name:"BRAT"},{id:"obsidian-style-settings",name:"Style Settings"},{id:"simple-banner",name:"Simple Banner"},{id:"alias-file-name-history",name:"Alias File Name History"},{id:"folder-notes",name:"Folder notes"},{id:"iconic",name:"Iconic"}];for(let i of n){let o=this.state.enabledPlugins.includes(i.id);new qt.Setting(t).setName(i.name).setDesc(`Plugin ID: ${i.id}`).addToggle(a=>a.setValue(o).onChange(s=>{s?(this.state.enabledPlugins.includes(i.id)||this.state.enabledPlugins.push(i.id),this.state.disabledPlugins=this.state.disabledPlugins.filter(l=>l!==i.id)):(this.state.enabledPlugins=this.state.enabledPlugins.filter(l=>l!==i.id),this.state.disabledPlugins.includes(i.id)||this.state.disabledPlugins.push(i.id))}))}}validate(){return!0}getTitle(){return"Optional Plugins"}getDescription(){return"Configure optional plugins"}};var qe=require("obsidian");var Pe=class{constructor(r){this.app=r}async createOrUpdateBaseFile(r,t,n){let i="bases/Home.base",o=this.app.vault.getAbstractFileByPath(i),a=null;if(o)try{let l=await this.app.vault.read(o);a=de(l)}catch(l){console.error("Failed to parse existing base file:",l)}let s=this.generateBaseContent(r,t,n,a);o?await this.app.vault.modify(o,s):(this.app.vault.getAbstractFileByPath("bases")||await this.app.vault.createFolder("bases"),await this.app.vault.create(i,s))}generateBaseContent(r,t,n,i){var f,c;let o=[];if(i!=null&&i.formulas){o.push("formulas:");for(let[u,d]of Object.entries(i.formulas))if(typeof d=="string"){o.push(`  ${u}: |-`);let m=d.split(`
`);for(let g of m)o.push(`    ${g}`)}o.push("")}o.push("filters:"),o.push("  and:"),o.push('    - file.ext == "md"'),o.push("");let a=new Set;for(let u of r){let d=t[u.id];d&&(a.add(`note.${d.titleProperty}`),a.add(`note.${d.dateProperty}`),d.descriptionProperty&&a.add(`note.${d.descriptionProperty}`),d.tagsProperty&&a.add(`note.${d.tagsProperty}`),d.draftProperty&&a.add(`note.${d.draftProperty}`),d.imageProperty&&a.add(`note.${d.imageProperty}`))}if(a.add("note.title"),a.add("note.date"),a.add("note.pubDate"),a.add("note.draft"),a.add("file.name"),i!=null&&i.properties)for(let u of Object.keys(i.properties))u.startsWith("formula.")&&a.add(u);if(a.size>0){o.push("properties:");for(let u of Array.from(a).sort()){let d=u.replace("note.","").replace("file.","");o.push(`  ${u}:`),o.push(`    displayName: ${this.capitalizeFirst(d)}`)}o.push("")}o.push("views:");let s=n?r.find(u=>u.id===n&&u.enabled):null,l=(f=i==null?void 0:i.views)==null?void 0:f.find(u=>u.name==="All Content"),p=s?t[s.id]:t[Object.keys(t)[0]];if(p){if(o.push("  - type: bases-cms"),o.push("    name: All Content"),o.push("    filters:"),o.push("      and:"),o.push('        - file.ext == "md"'),l!=null&&l.order){o.push("    order:");for(let u of l.order)o.push(`      - ${u}`)}else o.push("    order:"),o.push("      - file.name");o.push("    sort:"),o.push(`      - property: note.${p.dateProperty}`),o.push("        direction: DESC"),o.push(`    fallbackToEmbeds: ${(l==null?void 0:l.fallbackToEmbeds)||"if-empty"}`),o.push("    propertyDisplay1: file.name"),o.push(`    showTextPreview: ${(l==null?void 0:l.showTextPreview)!==!1?"true":"false"}`),o.push("    imageFormat: cover"),o.push("    showDate: true"),o.push(`    showDraftStatus: ${p.draftProperty||l!=null&&l.showDraftStatus?"true":"false"}`),o.push(`    propertyLabels: ${(l==null?void 0:l.propertyLabels)||"above"}`),o.push(`    titleProperty: note.${p.titleProperty}`),o.push(`    dateProperty: note.${p.dateProperty}`),p.descriptionProperty&&o.push(`    descriptionProperty: note.${p.descriptionProperty}`),p.imageProperty&&o.push(`    imageProperty: note.${p.imageProperty}`),o.push(`    propertyLayout12SideBySide: ${l!=null&&l.propertyLayout12SideBySide?"true":"false"}`),o.push(`    propertyLayout34SideBySide: ${l!=null&&l.propertyLayout34SideBySide?"true":"false"}`),o.push(`    showTags: ${p.tagsProperty?"true":"false"}`),p.tagsProperty&&o.push(`    tagsProperty: note.${p.tagsProperty}`),p.draftProperty&&o.push(`    draftStatusProperty: note.${p.draftProperty}`),o.push("    customizeNewButton: true"),s?o.push(`    newNoteLocation: "${s.folder}"`):o.push('    newNoteLocation: ""'),o.push(`    cardSize: ${(l==null?void 0:l.cardSize)||250}`),o.push(`    imageAspectRatio: ${(l==null?void 0:l.imageAspectRatio)||.55}`),o.push(`    maxTagsToShow: ${(l==null?void 0:l.maxTagsToShow)||2}`),o.push(`    dateIncludeTime: ${l!=null&&l.dateIncludeTime?"true":"false"}`)}for(let u of r){if(!u.enabled)continue;let d=(c=i==null?void 0:i.views)==null?void 0:c.find(g=>g.name===u.name);if(d&&d.name==="All Content")continue;let m=t[u.id];m&&(o.push("  - type: bases-cms"),o.push(`    name: ${u.name}`),o.push("    filters:"),o.push("      and:"),o.push(`        - file.folder.startsWith("${u.folder}")`),o.push("    imageFormat: cover"),o.push(`    titleProperty: note.${m.titleProperty}`),o.push(`    dateProperty: note.${m.dateProperty}`),m.descriptionProperty&&o.push(`    descriptionProperty: note.${m.descriptionProperty}`),m.imageProperty&&o.push(`    imageProperty: note.${m.imageProperty}`),o.push(`    showTags: ${m.tagsProperty?"true":"false"}`),m.tagsProperty&&o.push(`    tagsProperty: note.${m.tagsProperty}`),o.push("    showDate: true"),o.push(`    showDraftStatus: ${m.draftProperty?"true":"false"}`),m.draftProperty&&o.push(`    draftStatusProperty: note.${m.draftProperty}`),o.push("    customizeNewButton: true"),o.push(`    newNoteLocation: "${u.folder}"`),o.push("    fallbackToEmbeds: if-empty"),o.push("    propertyDisplay1: file.name"),o.push("    showTextPreview: true"),o.push("    sort:"),o.push(`      - property: note.${m.dateProperty}`),o.push("        direction: DESC"))}return o.join(`
`)}capitalizeFirst(r){return r.charAt(0).toUpperCase()+r.slice(1)}};var Ve=z(require("path")),be=class{constructor(r){this.app=r}async configureAstroComposer(r,t,n,i){let o={customContentTypes:[],defaultTemplate:"",configFilePath:this.relativePath(i),terminalProjectRootPath:this.relativePath(n)},a=r.find(l=>l.name==="Posts"&&l.enabled),s=r.find(l=>l.name==="Pages"&&l.enabled);if(a){let l=t[a.id];o.postsFolder=a.folder,o.postsCreationMode=a.organizationMode,o.postsIndexFileName=a.indexFileName||"index",o.defaultTemplate=(l==null?void 0:l.template)||this.generateTemplate(l,!0)}if(s){let l=t[s.id];o.enablePages=!0,o.pagesFolder=s.folder,o.pagesCreationMode=s.organizationMode,o.pagesIndexFileName=s.indexFileName||"index",o.pageTemplate=(l==null?void 0:l.template)||this.generateTemplate(l,!1)}for(let l of r)if(l.name!=="Posts"&&l.name!=="Pages"&&l.enabled){let p=t[l.id];o.customContentTypes.push({id:l.id,name:l.name,folder:l.folder,template:(p==null?void 0:p.template)||this.generateTemplate(p,!0),enabled:!0,linkBasePath:`/${l.folder}/`,creationMode:l.organizationMode,indexFileName:l.indexFileName||"index"})}return o}generateTemplate(r,t){if(r!=null&&r.template)return r.template;if(!r)return`---
title: "{{title}}"
---
`;let n=`---
`;return n+=`${r.titleProperty}: "{{title}}"
`,t&&(n+=`${r.dateProperty}: {{date}}
`),r.descriptionProperty&&(n+=`${r.descriptionProperty}: ""
`),n+=`tags: []
`,n+=`draft: true
`,n+=`---
`,n}relativePath(r){let t=this.app.vault.adapter,n=t.basePath||t.path;if(!n)return r;let i=Ve.normalize(n),o=Ve.normalize(r);return o.startsWith(i)?o.slice(i.length+1):r}async saveConfig(r){let n=".obsidian/plugins/astro-composer/data.json";try{let i={},o=this.app.vault.getAbstractFileByPath(n);o&&(i=JSON.parse(await this.app.vault.read(o)));let a={...i,...r,customContentTypes:this.mergeCustomContentTypes(i.customContentTypes||[],r.customContentTypes||[])};o?await this.app.vault.modify(o,JSON.stringify(a,null,2)):await this.app.vault.create(n,JSON.stringify(a,null,2))}catch(i){console.error("Failed to save Astro Composer config:",i)}}mergeCustomContentTypes(r,t){let n=[...r];for(let i of t){let o=n.findIndex(a=>a.id===i.id);o>=0?n[o]={...n[o],...i}:n.push(i)}return n}};var Ae=class{constructor(r){this.app=r}generateSEOConfig(r,t){let n=r.find(a=>a.enabled),i=n?t[n.id]:void 0;return{titleProperty:(i==null?void 0:i.titleProperty)||"title",descriptionProperty:i==null?void 0:i.descriptionProperty,scanDirectories:r.filter(a=>a.enabled).map(a=>a.folder).join(","),keywordProperty:"targetKeyword",useFilenameAsTitle:!1,useFilenameAsSlug:!0}}async saveConfig(r){let n=".obsidian/plugins/seo/data.json";try{let i=this.app.vault.getAbstractFileByPath(n);if(i){let a={...JSON.parse(await this.app.vault.read(i)),...r};await this.app.vault.modify(i,JSON.stringify(a,null,2))}}catch(i){console.error("Failed to save SEO config:",i)}}};var we=class{constructor(r){this.app=r}generateCommanderConfig(r){return{pageHeaderCommands:[]}}async toggleEditingToolbarCommand(r,t){var n;try{let i=r.plugins;if(!i){console.warn("Plugins API not available");return}let o=(n=i.plugins)==null?void 0:n["editing-toolbar"];if(!o){console.warn("Editing Toolbar plugin not found");return}t&&!o.enabled?await i.enablePlugin("editing-toolbar"):!t&&o.enabled&&await i.disablePlugin("editing-toolbar")}catch(i){console.error("Failed to toggle editing toolbar plugin:",i)}}async saveConfig(r){let n=".obsidian/plugins/cmdr/data.json";try{let i=this.app.vault.getAbstractFileByPath(n);if(i){let o=JSON.parse(await this.app.vault.read(i)),a=o.pageHeader||[],s={id:"editing-toolbar:hide-show-menu",icon:"lucide-chevrons-up-down",name:"Toggle editing toolbar",mode:"desktop"},l=a.filter(f=>f.id!=="editing-toolbar:hide-show-menu");r.pageHeaderCommands.length>0&&l.push(s);let p={...o,pageHeader:l};await this.app.vault.modify(i,JSON.stringify(p,null,2))}}catch(i){console.error("Failed to save Commander config:",i)}}};var Fe=class{constructor(r){this.app=r}async saveConfig(r){let n=".obsidian/plugins/property-over-file-name/data.json";try{let i=this.app.vault.getAbstractFileByPath(n);if(i){let a={...JSON.parse(await this.app.vault.read(i)),...r};await this.app.vault.modify(i,JSON.stringify(a,null,2))}}catch(i){console.error("Failed to save Property Over File Name config:",i)}}};var Te=class{constructor(r){this.app=r}async saveConfig(r,t){let i=".obsidian/plugins/insert-unsplash-image/data.json";try{let o={},a=this.app.vault.getAbstractFileByPath(i);a&&(o=JSON.parse(await this.app.vault.read(a)));let s={...o,...r};t&&(s.insertIntoProperty=t),a?await this.app.vault.modify(a,JSON.stringify(s,null,2)):await this.app.vault.create(i,JSON.stringify(s,null,2))}catch(o){console.error("Failed to save Image Inserter config:",o)}}};var Se=class{constructor(r){this.app=r}async saveConfig(r){let n=".obsidian/plugins/simple-banner/data.json";try{let i={},o=this.app.vault.getAbstractFileByPath(n);o&&(i=JSON.parse(await this.app.vault.read(o))),i.properties||(i.properties={}),i.properties.image=r,o?await this.app.vault.modify(o,JSON.stringify(i,null,2)):await this.app.vault.create(n,JSON.stringify(i,null,2))}catch(i){console.error("Failed to save Simple Banner config:",i)}}};var Ee=class{constructor(r){this.app=r}async updateGuideFile(r){let t="_vault-cms-guide.md",n=this.app.vault.getAbstractFileByPath(t);if(n)try{await this.app.fileManager.processFrontMatter(n,i=>{if(r.titleProperty&&r.titleProperty!=="title"&&i.title!==void 0){let o=i.title;delete i.title,i[r.titleProperty]=o}if(r.dateProperty&&r.dateProperty!=="date"&&i.date!==void 0){let o=i.date;delete i.date,i[r.dateProperty]=o}})}catch(i){console.error("Failed to update guide file:",i)}}};var De=class extends x{constructor(t,n,i,o,a,s){super(t,n,i,o,a,s);this.applied=!1;this.pluginManager=new G(t),this.basesCMSConfigurator=new Pe(t),this.astroComposerConfigurator=new be(t),this.seoConfigurator=new Ae(t),this.commanderConfigurator=new we(t),this.propertyOverFileNameConfigurator=new Fe(t),this.imageInserterConfigurator=new Te(t),this.simpleBannerConfigurator=new Se(t),this.guideFileUpdater=new Ee(t)}display(){let{containerEl:t}=this;t.empty(),t.createEl("h2",{text:"Finalize Configuration"}),t.createEl("p",{text:'Review your configuration and click "Apply" to save all settings:'});let n=t.createEl("div",{cls:"finalize-summary"});n.createEl("h3",{text:"Summary"}),n.createEl("p",{text:`Preset: ${this.state.preset}`}),n.createEl("p",{text:`Theme: ${this.state.theme||"Default"}`}),n.createEl("p",{text:`Content Types: ${this.state.contentTypes.filter(o=>o.enabled).length}`}),n.createEl("p",{text:`WYSIWYG Toolbar: ${this.state.enableWYSIWYG?"Enabled":"Disabled"}`}),t.createEl("button",{text:"Apply Configuration",cls:"mod-cta"}).addEventListener("click",async()=>{await this.applyConfiguration()})}async applyConfiguration(){if(!this.applied)try{if(await this.pluginManager.setPluginStates(this.state.enabledPlugins,this.state.disabledPlugins),await this.basesCMSConfigurator.createOrUpdateBaseFile(this.state.contentTypes,this.state.frontmatterProperties,this.state.defaultContentTypeId),this.state.projectDetection){let s=await this.astroComposerConfigurator.configureAstroComposer(this.state.contentTypes,this.state.frontmatterProperties,this.state.projectDetection.projectRoot,this.state.projectDetection.configFilePath);this.state.astroComposerConfig=s,await this.astroComposerConfigurator.saveConfig(s)}let t=this.seoConfigurator.generateSEOConfig(this.state.contentTypes,this.state.frontmatterProperties);this.state.seoConfig=t,await this.seoConfigurator.saveConfig(t),this.state.enableWYSIWYG&&await this.commanderConfigurator.toggleEditingToolbarCommand(this.app,!0);let n=this.commanderConfigurator.generateCommanderConfig(this.state.enableWYSIWYG);this.state.commanderConfig=n,await this.commanderConfigurator.saveConfig(n);let i=this.state.contentTypes.find(s=>s.enabled),o=i?this.state.frontmatterProperties[i.id]:void 0;o&&(this.state.propertyOverFileName.propertyKey=o.titleProperty,await this.propertyOverFileNameConfigurator.saveConfig(this.state.propertyOverFileName)),o&&await this.guideFileUpdater.updateGuideFile(o);let a=o==null?void 0:o.imageProperty;if(a&&this.state.enabledPlugins.includes("simple-banner")&&await this.simpleBannerConfigurator.saveConfig(a),a&&this.state.enabledPlugins.includes("insert-unsplash-image")&&await this.imageInserterConfigurator.saveConfig(this.state.imageInserter,a),this.state.defaultContentTypeId){let s=this.state.contentTypes.find(l=>l.id===this.state.defaultContentTypeId);if(s){let l=this.app.vault.config;l&&(l.newFileLocation="folder",l.newFileFolderPath=s.folder);let p=s.attachmentsFolder||this.state.sharedAttachmentsFolder;if(p){let f=this.app.vault.config;if(f){let c=this.app.vault.adapter.basePath||this.app.vault.adapter.path;if(c&&p.startsWith(c)){let u=p.slice(c.length).replace(/^[\/\\]+/,"");f.attachmentFolderPath=`./${u}`}else f.attachmentFolderPath=p}}}}this.applied=!0,new qe.Notice("Configuration applied successfully!")}catch(t){console.error("Failed to apply configuration:",t),new qe.Notice("Failed to apply configuration. Please check the console for details.")}}validate(){return this.applied}getTitle(){return"Finalize"}getDescription(){return"Review and apply configuration"}};var M=class extends Kt.Modal{constructor(t,n,i){var a,s,l,p,f,c,u,d,m,g,v,F,y,Ke,Je,Qe,Xe,Ze,et;super(t);this.currentStepIndex=0;this.currentStepInstance=null;this.pluginInstance=i;let o=(n==null?void 0:n.projectDetection)||((a=i==null?void 0:i.settings)!=null&&a.projectRoot&&((s=i==null?void 0:i.settings)!=null&&s.configFilePath)?{projectRoot:i.settings.projectRoot,configFilePath:i.settings.configFilePath,vaultLocation:"content"}:void 0);this.state={currentStep:0,contentTypes:(n==null?void 0:n.contentTypes)||((l=i==null?void 0:i.settings)==null?void 0:l.contentTypes)||[],frontmatterProperties:(n==null?void 0:n.frontmatterProperties)||((p=i==null?void 0:i.settings)==null?void 0:p.frontmatterProperties)||{},projectDetection:o,defaultContentTypeId:(n==null?void 0:n.defaultContentTypeId)||((f=i==null?void 0:i.settings)==null?void 0:f.defaultContentTypeId),sharedAttachmentsFolder:(n==null?void 0:n.sharedAttachmentsFolder)||((c=i==null?void 0:i.settings)==null?void 0:c.sharedAttachmentsFolder),preset:(n==null?void 0:n.preset)||((u=i==null?void 0:i.settings)==null?void 0:u.preset)||"vanilla",enableWYSIWYG:(g=(m=n==null?void 0:n.enableWYSIWYG)!=null?m:(d=i==null?void 0:i.settings)==null?void 0:d.enableWYSIWYG)!=null?g:!1,enabledPlugins:(n==null?void 0:n.enabledPlugins)||((v=i==null?void 0:i.settings)==null?void 0:v.enabledPlugins)||[],disabledPlugins:(n==null?void 0:n.disabledPlugins)||((F=i==null?void 0:i.settings)==null?void 0:F.disabledPlugins)||[],theme:(n==null?void 0:n.theme)||((y=i==null?void 0:i.settings)==null?void 0:y.theme)||"",basesCMSConfig:(n==null?void 0:n.basesCMSConfig)||((Ke=i==null?void 0:i.settings)==null?void 0:Ke.basesCMSConfig)||{views:[]},astroComposerConfig:(n==null?void 0:n.astroComposerConfig)||((Je=i==null?void 0:i.settings)==null?void 0:Je.astroComposerConfig)||{customContentTypes:[],defaultTemplate:"",configFilePath:"",terminalProjectRootPath:""},seoConfig:(n==null?void 0:n.seoConfig)||((Qe=i==null?void 0:i.settings)==null?void 0:Qe.seoConfig)||{titleProperty:"title",scanDirectories:"",useFilenameAsTitle:!1,useFilenameAsSlug:!0},commanderConfig:(n==null?void 0:n.commanderConfig)||((Xe=i==null?void 0:i.settings)==null?void 0:Xe.commanderConfig)||{pageHeaderCommands:[]},propertyOverFileName:(n==null?void 0:n.propertyOverFileName)||((Ze=i==null?void 0:i.settings)==null?void 0:Ze.propertyOverFileName)||{propertyKey:"title"},imageInserter:(n==null?void 0:n.imageInserter)||((et=i==null?void 0:i.settings)==null?void 0:et.imageInserter)||{valueFormat:"[[attachments/{image-url}]]",insertFormat:"[[attachments/{image-url}]]"},...n},this.steps=[ee,ie,oe,ae,me,ge,ye,ve,xe,Ce,De]}onOpen(){let{contentEl:t}=this;t.empty(),this.displayCurrentStep().catch(n=>{console.error("Error displaying wizard step:",n)})}onClose(){let{contentEl:t}=this;t.empty()}async displayCurrentStep(){let{contentEl:t}=this;if(t.empty(),this.currentStepIndex>=this.steps.length){this.close();return}let n=this.steps[this.currentStepIndex];this.currentStepInstance=new n(this.app,t,this.state,()=>this.nextStep(),()=>this.previousStep(),()=>this.close()),await this.currentStepInstance.display(),this.state.currentStep=this.currentStepIndex;let o=t.createDiv({cls:"wizard-footer"}).createDiv({cls:"wizard-buttons"});if(o.style.display="flex",o.style.gap="10px",this.currentStepIndex>0&&o.createEl("button",{text:"Previous",cls:"mod-button"}).addEventListener("click",async()=>{await this.previousStep()}),this.currentStepIndex<this.steps.length-1){o.createEl("button",{text:"Next",cls:"mod-button mod-cta"}).addEventListener("click",async()=>{this.currentStepInstance&&this.currentStepInstance.validate()&&(await this.saveCurrentStepState(),await this.nextStep())});let s=o.createEl("button",{text:"Skip",cls:"mod-button"});s.style.opacity="0.6",s.addEventListener("click",async()=>{await this.nextStep()})}else o.createEl("button",{text:"Complete Setup",cls:"mod-button mod-cta"}).addEventListener("click",async()=>{this.currentStepInstance&&this.currentStepInstance.validate()&&(await this.saveStateIfNeeded(),this.close())})}async nextStep(){this.currentStepIndex<this.steps.length-1?(this.currentStepIndex++,await this.displayCurrentStep()):(await this.saveStateIfNeeded(),this.close())}async saveCurrentStepState(){var t,n;try{this.saveCallback&&this.pluginInstance&&(this.pluginInstance.settings.projectRoot=((t=this.state.projectDetection)==null?void 0:t.projectRoot)||"",this.pluginInstance.settings.configFilePath=((n=this.state.projectDetection)==null?void 0:n.configFilePath)||"",this.pluginInstance.settings.contentTypes=this.state.contentTypes,this.pluginInstance.settings.frontmatterProperties=this.state.frontmatterProperties,this.pluginInstance.settings.defaultContentTypeId=this.state.defaultContentTypeId,this.pluginInstance.settings.sharedAttachmentsFolder=this.state.sharedAttachmentsFolder,this.pluginInstance.settings.preset=this.state.preset,this.pluginInstance.settings.enableWYSIWYG=this.state.enableWYSIWYG,this.pluginInstance.settings.enabledPlugins=this.state.enabledPlugins,this.pluginInstance.settings.disabledPlugins=this.state.disabledPlugins,this.pluginInstance.settings.theme=this.state.theme,this.pluginInstance.settings.basesCMSConfig=this.state.basesCMSConfig,this.pluginInstance.settings.astroComposerConfig=this.state.astroComposerConfig,this.pluginInstance.settings.seoConfig=this.state.seoConfig,this.pluginInstance.settings.commanderConfig=this.state.commanderConfig,this.pluginInstance.settings.propertyOverFileName=this.state.propertyOverFileName,this.pluginInstance.settings.imageInserter=this.state.imageInserter,await this.pluginInstance.saveSettings())}catch(i){console.error("Error saving current step state:",i)}}async previousStep(){this.currentStepIndex>0&&(this.currentStepIndex--,await this.displayCurrentStep())}getState(){return this.state}setSaveCallback(t){this.saveCallback=t}async saveStateIfNeeded(){this.saveCallback&&this.currentStepIndex===this.steps.length-1&&await this.saveCallback(this.state)}};var Oe=class extends N.PluginSettingTab{constructor(t,n){super(t,n);this.plugin=n}display(){let{containerEl:t}=this;t.empty(),t.createEl("h2",{text:"Vault CMS Settings"}),new N.Setting(t).setName("Open Setup Wizard").setDesc("Launch the setup wizard to configure Vault CMS").addButton(n=>n.setButtonText("Open Wizard").setCta().onClick(()=>{new M(this.app,this.plugin.settings,this.plugin).open()})),new N.Setting(t).setName("Run Wizard on Startup").setDesc("Automatically open the wizard when the plugin loads (if not completed)").addToggle(n=>n.setValue(this.plugin.settings.runWizardOnStartup).onChange(async i=>{this.plugin.settings.runWizardOnStartup=i,await this.plugin.saveSettings()})),t.createEl("h3",{text:"Current Configuration"}),new N.Setting(t).setName("Preset").setDesc(`Current preset: ${this.plugin.settings.preset}`).addText(n=>n.setValue(this.plugin.settings.preset).setDisabled(!0)),new N.Setting(t).setName("Project Root").setDesc(this.plugin.settings.projectRoot||"Not configured").addText(n=>n.setValue(this.plugin.settings.projectRoot||"").setDisabled(!0)),new N.Setting(t).setName("Config File").setDesc(this.plugin.settings.configFilePath||"Not configured").addText(n=>n.setValue(this.plugin.settings.configFilePath||"").setDisabled(!0)),new N.Setting(t).setName("Content Types").setDesc(`${this.plugin.settings.contentTypes.length} content types configured`).addText(n=>n.setValue(`${this.plugin.settings.contentTypes.length}`).setDisabled(!0)),new N.Setting(t).setName("WYSIWYG Toolbar").setDesc(this.plugin.settings.enableWYSIWYG?"Enabled":"Disabled").addText(n=>n.setValue(this.plugin.settings.enableWYSIWYG?"Enabled":"Disabled").setDisabled(!0))}};function Jt(e){e.addCommand({id:"vault-cms-open-wizard",name:"Open Setup Wizard",callback:()=>{let r=new M(e.app,e.settings,e);r.setSaveCallback(async t=>{var n,i;e.settings.projectRoot=((n=t.projectDetection)==null?void 0:n.projectRoot)||"",e.settings.configFilePath=((i=t.projectDetection)==null?void 0:i.configFilePath)||"",e.settings.contentTypes=t.contentTypes,e.settings.frontmatterProperties=t.frontmatterProperties,e.settings.defaultContentTypeId=t.defaultContentTypeId,e.settings.sharedAttachmentsFolder=t.sharedAttachmentsFolder,e.settings.preset=t.preset,e.settings.enableWYSIWYG=t.enableWYSIWYG,e.settings.enabledPlugins=t.enabledPlugins,e.settings.disabledPlugins=t.disabledPlugins,e.settings.theme=t.theme,e.settings.basesCMSConfig=t.basesCMSConfig,e.settings.astroComposerConfig=t.astroComposerConfig,e.settings.seoConfig=t.seoConfig,e.settings.commanderConfig=t.commanderConfig,e.settings.propertyOverFileName=t.propertyOverFileName,e.settings.imageInserter=t.imageInserter,e.settings.wizardCompleted=!0,await e.saveSettings()}),r.open()}})}var Ne=class extends Qt.Plugin{async onload(){await this.loadSettings(),Jt(this),this.addSettingTab(new Oe(this.app,this)),this.settings.runWizardOnStartup&&!this.settings.wizardCompleted&&this.app.workspace.onLayoutReady(()=>{this.startupTimeoutId=window.setTimeout(async()=>{if(await this.loadSettings(),this.settings.runWizardOnStartup&&!this.settings.wizardCompleted){let t=new M(this.app,this.settings,this);t.setSaveCallback(async n=>{var i,o;this.settings.projectRoot=((i=n.projectDetection)==null?void 0:i.projectRoot)||"",this.settings.configFilePath=((o=n.projectDetection)==null?void 0:o.configFilePath)||"",this.settings.contentTypes=n.contentTypes,this.settings.frontmatterProperties=n.frontmatterProperties,this.settings.defaultContentTypeId=n.defaultContentTypeId,this.settings.sharedAttachmentsFolder=n.sharedAttachmentsFolder,this.settings.preset=n.preset,this.settings.enableWYSIWYG=n.enableWYSIWYG,this.settings.enabledPlugins=n.enabledPlugins,this.settings.disabledPlugins=n.disabledPlugins,this.settings.theme=n.theme,this.settings.basesCMSConfig=n.basesCMSConfig,this.settings.astroComposerConfig=n.astroComposerConfig,this.settings.seoConfig=n.seoConfig,this.settings.commanderConfig=n.commanderConfig,this.settings.propertyOverFileName=n.propertyOverFileName,this.settings.imageInserter=n.imageInserter,this.settings.wizardCompleted=!0,await this.saveSettings()}),t.open()}},2e3)})}onunload(){this.startupTimeoutId&&window.clearTimeout(this.startupTimeoutId)}async loadSettings(){this.settings=Object.assign({},rt,await this.loadData())}async saveSettings(){await this.saveData(this.settings)}};
/*! Bundled license information:

js-yaml/dist/js-yaml.mjs:
  (*! js-yaml 4.1.1 https://github.com/nodeca/js-yaml @license MIT *)
*/
