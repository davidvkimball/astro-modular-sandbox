/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var ir=Object.create;var oe=Object.defineProperty;var nr=Object.getOwnPropertyDescriptor;var or=Object.getOwnPropertyNames;var ar=Object.getPrototypeOf,sr=Object.prototype.hasOwnProperty;var lr=(e,t)=>{for(var r in t)oe(e,r,{get:t[r],enumerable:!0})},nt=(e,t,r,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let i of or(t))!sr.call(e,i)&&i!==r&&oe(e,i,{get:()=>t[i],enumerable:!(n=nr(t,i))||n.enumerable});return e};var U=(e,t,r)=>(r=e!=null?ir(ar(e)):{},nt(t||!e||!e.__esModule?oe(r,"default",{value:e,enumerable:!0}):r,e)),pr=e=>nt(oe({},"__esModule",{value:!0}),e);var Ln={};lr(Ln,{default:()=>Re});module.exports=pr(Ln);var er=require("obsidian");var ot={projectRoot:"",configFilePath:"",contentTypes:[],frontmatterProperties:{},preset:"vanilla",enableWYSIWYG:!1,enabledPlugins:[],disabledPlugins:[],theme:"",basesCMSConfig:{views:[]},astroComposerConfig:{customContentTypes:[],defaultTemplate:"",configFilePath:"",terminalProjectRootPath:""},seoConfig:{titleProperty:"title",descriptionProperty:void 0,scanDirectories:"",useFilenameAsTitle:!1,useFilenameAsSlug:!0},commanderConfig:{pageHeaderCommands:[]},propertyOverFileName:{propertyKey:"title"},imageInserter:{valueFormat:"[[attachments/{image-url}]]",insertFormat:"[[attachments/{image-url}]]"},runWizardOnStartup:!0,wizardCompleted:!1};var j=require("obsidian");var Xt=require("obsidian");var w=class{constructor(t,r,n,i,o,a){this.app=t,this.containerEl=r,this.state=n,this.onNext=i,this.onBack=o,this.onCancel=a}};var ae=class extends w{display(){let{containerEl:t}=this;t.empty(),t.createEl("h2",{text:"Welcome to Vault CMS Setup"}),t.createEl("p",{text:"This wizard will help you configure your Vault CMS setup. We'll guide you through:"});let r=t.createEl("ul");r.createEl("li",{text:"Detecting your Astro project structure"}),r.createEl("li",{text:"Identifying your content types"}),r.createEl("li",{text:"Mapping frontmatter properties"}),r.createEl("li",{text:"Configuring plugins and themes"}),r.createEl("li",{text:"Setting up Bases CMS views"}),r.createEl("li",{text:"Configuring Astro Composer and SEO plugins"}),t.createEl("p",{text:'Click "Next" to begin the setup process.'})}validate(){return!0}getTitle(){return"Welcome"}getDescription(){return"Introduction to Vault CMS setup"}};var z=require("obsidian"),Z=U(require("path")),G=U(require("fs"));var N=U(require("path")),le=U(require("fs")),se=class{constructor(t){this.app=t}async detectProject(){let r=this.app.vault.adapter,n=r.basePath||r.path;if(!n)return null;let i=await this.searchUpwardForConfig(n);if(!i)return null;let o=this.detectVaultLocation(n,i.projectRoot);return{projectRoot:i.projectRoot,configFilePath:i.configFilePath,vaultLocation:o}}async searchUpwardForConfig(t){let r=["astro.config.ts","astro.config.mjs","astro.config.js","astro.config.mts","astro.config.cjs"],n=N.resolve(t),i=N.parse(n).root;for(;n!==i;){for(let a of r){let s=N.join(n,a);try{if(le.existsSync(s)&&le.statSync(s).isFile())return{projectRoot:n,configFilePath:s}}catch(l){}}let o=N.dirname(n);if(o===n)break;n=o}return null}detectVaultLocation(t,r){let n=N.normalize(t),i=N.normalize(r);if(!n.startsWith(i))return"root";let a=N.relative(i,n).split(N.sep).filter(p=>p.length>0),s=a.findIndex(p=>p.toLowerCase()==="content");if(s>0){let p=s-1;if(p>=0&&a[p].toLowerCase()==="src")return"content"}let l=a.findIndex(p=>p.toLowerCase()==="src");return l>=0&&l<a.length-1&&a[l+1].toLowerCase()==="content"?"nested-content":"root"}};var pe=class extends w{constructor(r,n,i,o,a,s){super(r,n,i,o,a,s);this.detected=!1;this.projectRootDisplay=null;this.configFileDisplay=null;this.projectDetector=new se(r)}async display(){var i,o;let{containerEl:r}=this;r.empty();let n=((i=this.state.projectDetection)==null?void 0:i.projectRoot)&&((o=this.state.projectDetection)==null?void 0:o.configFilePath);if(n)this.detected=!0;else{r.createEl("h2",{text:"Project Detection"}),r.createEl("p",{text:"Detecting your Astro project structure..."});let a=await this.projectDetector.detectProject();a?(this.state.projectDetection=a,this.detected=!0):this.detected=!1}if(this.state.projectDetection&&(this.detected||n)){await new Promise(l=>setTimeout(l,500)),r.empty(),r.createEl("h2",{text:"Project Detected"}),r.createEl("p",{text:'Project structure detected successfully. You can modify the paths below if needed, then click "Next" to continue.'});let a=new z.Setting(r).setName("Project Root").setDesc("Select the folder containing your Astro project root");this.projectRootDisplay=a.descEl.createDiv({text:this.state.projectDetection.projectRoot||"No folder selected",cls:"vault-cms-path-display"}),this.projectRootDisplay.style.color="var(--text-normal)",a.addButton(l=>l.setButtonText("Browse...").setCta().onClick(async()=>{let p=await this.selectFolder();p&&(this.state.projectDetection.projectRoot=p,this.projectRootDisplay&&(this.projectRootDisplay.textContent=p,this.projectRootDisplay.style.color="var(--text-normal)"),this.detected=!1)}));let s=new z.Setting(r).setName("Config File").setDesc("Select your Astro config file (astro.config.ts, astro.config.mjs, src/config.ts, etc.)");this.configFileDisplay=s.descEl.createDiv({text:this.state.projectDetection.configFilePath||"No file selected",cls:"vault-cms-path-display"}),this.configFileDisplay.style.color="var(--text-normal)",s.addButton(l=>l.setButtonText("Browse...").setCta().onClick(async()=>{var d;let p=((d=this.state.projectDetection)==null?void 0:d.projectRoot)||this.getVaultPath(),u=await this.selectConfigFile(p);u&&(this.state.projectDetection.configFilePath=u,this.configFileDisplay&&(this.configFileDisplay.textContent=u,this.configFileDisplay.style.color="var(--text-normal)"),this.detected=!1)}))}else{r.empty(),r.createEl("h2",{text:"Project Detection Failed"}),r.createEl("p",{text:"Could not detect Astro project structure. Please select your Astro project root and config file manually."}),this.state.projectDetection||(this.state.projectDetection={projectRoot:"",configFilePath:"",vaultLocation:"root"});let a=new z.Setting(r).setName("Project Root").setDesc("Select the folder containing your Astro project root");this.projectRootDisplay=a.descEl.createDiv({text:this.state.projectDetection.projectRoot||"No folder selected",cls:"vault-cms-path-display"}),this.state.projectDetection.projectRoot?this.projectRootDisplay.style.color="var(--text-normal)":this.projectRootDisplay.style.color="var(--text-muted)",a.addButton(l=>l.setButtonText("Browse...").setCta().onClick(async()=>{let p=await this.selectFolder();p&&(this.state.projectDetection.projectRoot=p,this.projectRootDisplay&&(this.projectRootDisplay.textContent=p,this.projectRootDisplay.style.color="var(--text-normal)"))}));let s=new z.Setting(r).setName("Config File").setDesc("Select your Astro config file (astro.config.ts, astro.config.mjs, etc.)");this.configFileDisplay=s.descEl.createDiv({text:this.state.projectDetection.configFilePath||"No file selected",cls:"vault-cms-path-display"}),this.state.projectDetection.configFilePath?this.configFileDisplay.style.color="var(--text-normal)":this.configFileDisplay.style.color="var(--text-muted)",s.addButton(l=>l.setButtonText("Browse...").setCta().onClick(async()=>{var d;let p=((d=this.state.projectDetection)==null?void 0:d.projectRoot)||this.getVaultPath(),u=await this.selectConfigFile(p);u&&(this.state.projectDetection.configFilePath=u,this.configFileDisplay&&(this.configFileDisplay.textContent=u,this.configFileDisplay.style.color="var(--text-normal)"))}))}}async selectFolder(){var r,n,i;try{let o=null;try{let p=require("@electron/remote");o=p==null?void 0:p.dialog}catch(p){}if(!o)try{let p=((r=window.require)==null?void 0:r.call(window,"electron"))||require("electron");o=(n=p==null?void 0:p.remote)==null?void 0:n.dialog}catch(p){}if(!o)try{let p=require("electron");o=p==null?void 0:p.dialog}catch(p){}if(!o||typeof o.showOpenDialogSync!="function")throw new Error("Electron dialog API not available");let a=this.getVaultPath(),s=((i=this.state.projectDetection)==null?void 0:i.projectRoot)||a,l=o.showOpenDialogSync({title:"Select Astro Project Root Folder",defaultPath:s,properties:["openDirectory"]});if(l&&l.length>0)return Z.normalize(l[0])}catch(o){console.error("Error opening folder picker:",o),new z.Notice("Unable to open folder picker. Please ensure you are using Obsidian on desktop.")}return null}async selectConfigFile(r){var n,i;try{let o=null;try{let l=require("@electron/remote");o=l==null?void 0:l.dialog}catch(l){}if(!o)try{let l=((n=window.require)==null?void 0:n.call(window,"electron"))||require("electron");o=(i=l==null?void 0:l.remote)==null?void 0:i.dialog}catch(l){}if(!o)try{let l=require("electron");o=l==null?void 0:l.dialog}catch(l){}if(!o||typeof o.showOpenDialogSync!="function")throw new Error("Electron dialog API not available");let a=r||this.getVaultPath(),s=o.showOpenDialogSync({title:"Select Astro Config File",defaultPath:a,filters:[{name:"Astro Config Files",extensions:["ts","mjs","js","mts","cjs"]},{name:"All Files",extensions:["*"]}],properties:["openFile"]});if(s&&s.length>0)return Z.normalize(s[0])}catch(o){console.error("Error opening file picker:",o),new z.Notice("Unable to open file picker. Please ensure you are using Obsidian on desktop.")}return null}getVaultPath(){let r=this.app.vault.adapter,n=r.basePath||r.path;return n?Z.resolve(n):process.cwd()}validate(){var i,o;if(this.detected)return!0;let r=(i=this.state.projectDetection)==null?void 0:i.projectRoot,n=(o=this.state.projectDetection)==null?void 0:o.configFilePath;if(!r||!n)return!1;try{return!(!G.existsSync(r)||!G.statSync(r).isDirectory()||!G.existsSync(n)||!G.statSync(n).isFile())}catch(a){return!1}}getTitle(){return"Project Detection"}getDescription(){return"Detect Astro project structure"}};var M=require("obsidian"),V=U(require("path"));var ze=require("obsidian"),ce=class{constructor(t){this.app=t}async detectContentTypes(){let r=this.app.vault.getRoot();if(!(r instanceof ze.TFolder))return[];let n=[],i=this.getTopLevelFolders(r);for(let o of i){let a=this.detectContentType(o);a&&n.push(a)}return n}getTopLevelFolders(t){let r=[];if(!t.children)return r;for(let n of t.children)n instanceof ze.TFolder&&!n.name.startsWith(".")&&n.name!=="bases"&&n.name!=="_bases"&&n.name!=="node_modules"&&n.name!==".obsidian"&&r.push(n);return r}detectContentType(t){let r=t.name.toLowerCase(),n,i=!1;return r==="posts"||r==="post"||r==="blog"?(n="Posts",i=!0):r==="pages"||r==="page"?(n="Pages",i=!0):(n=this.capitalizeFirst(t.name),i=!1),{id:`content-type-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,name:n,folder:t.name,fileOrganization:"file",enabled:i,indexFileName:"index"}}capitalizeFirst(t){return t.charAt(0).toUpperCase()+t.slice(1)}};var Be=class extends M.AbstractInputSuggest{constructor(r,n,i){super(r,n);this.inputEl=n,this.mode=i}getSuggestions(r){let n=[],i=r.toLowerCase();if(this.mode==="subfolder"){"attachments".toLowerCase().includes(i)&&n.push("attachments");let o=this.app.vault.getAllLoadedFiles(),a=new Set;for(let s of o)if(s instanceof M.TFolder){let l=s.name;l.toLowerCase().includes(i)&&l!=="attachments"&&a.add(l)}n.push(...Array.from(a).slice(0,10))}else{let o=this.app.vault.getAllLoadedFiles(),a=new Set;for(let s of o)if(s instanceof M.TFolder){let l=s.path;l.toLowerCase().includes(i)&&a.add(l)}n.push(...Array.from(a).slice(0,10))}return n}renderSuggestion(r,n){n.setText(r)}selectSuggestion(r){this.inputEl.value=r,this.inputEl.trigger("input"),this.close()}},fe=class extends w{constructor(r,n,i,o,a,s){super(r,n,i,o,a,s);this.detected=!1;this.contentTypeDetector=new ce(r)}async display(){let{containerEl:r}=this,n=r.querySelector(".content-type-step-content");if(n?n.empty():(r.empty(),n=r.createDiv({cls:"content-type-step-content"})),n.createEl("h2",{text:"Content Types"}),n.createEl("p",{text:"Detecting content types in your vault..."}),!this.detected){let o=await this.contentTypeDetector.detectContentTypes();this.state.contentTypes=o,this.detected=!0}if(n.empty(),n.createEl("h2",{text:"Content Types"}),n.createEl("p",{text:"Select and configure your content types:"}),n.createEl("h3",{text:"Attachment Handling",cls:"vault-cms-section-header"}),n.createEl("p",{text:"How should attachments be stored globally?",cls:"vault-cms-section-desc"}),new M.Setting(n).setName("How are attachments handled?").setDesc("Choose how attachments are stored for all content types").addDropdown(o=>o.addOption("same-folder","Same folder as current file").addOption("specified-folder","In the specified folder").addOption("subfolder","In subfolder under current folder").setValue(this.state.attachmentHandlingMode||"subfolder").onChange(a=>{this.state.attachmentHandlingMode=a,a==="same-folder"&&(this.state.attachmentFolderName=void 0),this.display()})),this.state.attachmentHandlingMode==="specified-folder"||this.state.attachmentHandlingMode==="subfolder"){let o=this.state.attachmentHandlingMode==="specified-folder"?'Enter the exact path to the folder for attachments (e.g., "attachments" or "images/attachments"). Leave blank to use "attachments" as default.':'Enter the name of the subfolder for attachments (e.g., "attachments"). Leave blank to use "attachments" as default.';new M.Setting(n).setName("Attachment Folder").setDesc(o).addText(s=>{s.setPlaceholder("attachments").setValue(this.state.attachmentFolderName||"").onChange(l=>{this.state.attachmentFolderName=l||void 0}),this.state.attachmentHandlingMode!=="same-folder"&&new Be(this.app,s.inputEl,this.state.attachmentHandlingMode)})}n.createEl("hr",{cls:"vault-cms-divider"}),n.createEl("h3",{text:"Content Types",cls:"vault-cms-section-header"});for(let o of this.state.contentTypes){let a=new M.Setting(n).setName(o.name).setDesc(`Folder: ${o.folder}`).addToggle(s=>s.setValue(o.enabled).onChange(l=>{o.enabled=l}));new M.Setting(n).setName(`${o.name} - File Organization`).setDesc("Choose how content is organized for this content type").addDropdown(s=>s.addOption("file","File-based").addOption("folder","Folder-based").setValue(o.fileOrganization||"file").onChange(l=>{o.fileOrganization=l,this.display()})),o.fileOrganization==="folder"&&new M.Setting(n).setName(`${o.name} - Index File Name`).setDesc("Name of the index file in folder-based organization").addText(s=>s.setValue(o.indexFileName||"index").onChange(l=>{o.indexFileName=l||"index"}))}let i=n.createEl("button",{text:"Add Additional Content Type",cls:"mod-cta"});i.style.marginTop="20px",i.style.marginBottom="30px",i.addEventListener("click",async()=>{let o=await this.selectContentTypeFolder();if(o){let a=V.basename(o),s={id:`content-type-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,name:this.capitalizeFirst(a),folder:a,fileOrganization:"file",enabled:!1,indexFileName:"index"};this.state.contentTypes.push(s),this.display()}})}async selectContentTypeFolder(){var r,n;try{let i=null;try{let s=require("@electron/remote");i=s==null?void 0:s.dialog}catch(s){}if(!i)try{let s=((r=window.require)==null?void 0:r.call(window,"electron"))||require("electron");i=(n=s==null?void 0:s.remote)==null?void 0:n.dialog}catch(s){}if(!i)try{let s=require("electron");i=s==null?void 0:s.dialog}catch(s){}if(!i||typeof i.showOpenDialogSync!="function")throw new Error("Electron dialog API not available");let o=this.getVaultPath(),a=i.showOpenDialogSync({title:"Select Content Type Folder",defaultPath:o,properties:["openDirectory"]});if(a&&a.length>0)return V.normalize(a[0])}catch(i){console.error("Error opening folder picker:",i),new M.Notice("Unable to open folder picker. Please ensure you are using Obsidian on desktop.")}return null}getVaultPath(){let r=this.app.vault.adapter,n=r.basePath||r.path;return n?V.resolve(n):process.cwd()}capitalizeFirst(r){return r.charAt(0).toUpperCase()+r.slice(1)}validate(){return this.state.contentTypes.some(r=>r.enabled)}getTitle(){return"Content Types"}getDescription(){return"Configure content types"}};var at=require("obsidian");var ue=class extends w{display(){let{containerEl:t}=this;t.empty(),t.createEl("h2",{text:"Default Content Type"}),t.createEl("p",{text:"Select which content type should be used as the default. This will:"});let r=t.createEl("ul");r.createEl("li",{text:"Set as the default Bases CMS view"}),r.createEl("li",{text:`Configure Obsidian's "Default location for new notes" to that folder`});let n=this.state.contentTypes.filter(i=>i.enabled);if(n.length===0){t.createEl("p",{text:"No enabled content types found. Please go back and enable at least one content type."});return}!this.state.defaultContentTypeId&&n.length>0&&(this.state.defaultContentTypeId=n[0].id),new at.Setting(t).setName("Default Content Type").setDesc("Choose the default content type for new notes").addDropdown(i=>{var o;n.forEach(a=>{i.addOption(a.id,a.name)}),i.setValue(this.state.defaultContentTypeId||((o=n[0])==null?void 0:o.id)||""),i.onChange(a=>{this.state.defaultContentTypeId=a})})}validate(){return!!this.state.defaultContentTypeId}getTitle(){return"Default Content Type"}getDescription(){return"Select default content type"}};var T=require("obsidian");var et=require("obsidian");function bt(e){return typeof e=="undefined"||e===null}function cr(e){return typeof e=="object"&&e!==null}function fr(e){return Array.isArray(e)?e:bt(e)?[]:[e]}function ur(e,t){var r,n,i,o;if(t)for(o=Object.keys(t),r=0,n=o.length;r<n;r+=1)i=o[r],e[i]=t[i];return e}function dr(e,t){var r="",n;for(n=0;n<t;n+=1)r+=e;return r}function hr(e){return e===0&&Number.NEGATIVE_INFINITY===1/e}var mr=bt,gr=cr,yr=fr,vr=dr,Cr=hr,xr=ur,F={isNothing:mr,isObject:gr,toArray:yr,repeat:vr,isNegativeZero:Cr,extend:xr};function wt(e,t){var r="",n=e.reason||"(unknown reason)";return e.mark?(e.mark.name&&(r+='in "'+e.mark.name+'" '),r+="("+(e.mark.line+1)+":"+(e.mark.column+1)+")",!t&&e.mark.snippet&&(r+=`

`+e.mark.snippet),n+" "+r):n}function te(e,t){Error.call(this),this.name="YAMLException",this.reason=e,this.mark=t,this.message=wt(this,!1),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack||""}te.prototype=Object.create(Error.prototype);te.prototype.constructor=te;te.prototype.toString=function(t){return this.name+": "+wt(this,t)};var I=te;function We(e,t,r,n,i){var o="",a="",s=Math.floor(i/2)-1;return n-t>s&&(o=" ... ",t=n-s+o.length),r-n>s&&(a=" ...",r=n+s-a.length),{str:o+e.slice(t,r).replace(/\t/g,"\u2192")+a,pos:n-t+o.length}}function $e(e,t){return F.repeat(" ",t-e.length)+e}function Pr(e,t){if(t=Object.create(t||null),!e.buffer)return null;t.maxLength||(t.maxLength=79),typeof t.indent!="number"&&(t.indent=1),typeof t.linesBefore!="number"&&(t.linesBefore=3),typeof t.linesAfter!="number"&&(t.linesAfter=2);for(var r=/\r?\n|\r|\0/g,n=[0],i=[],o,a=-1;o=r.exec(e.buffer);)i.push(o.index),n.push(o.index+o[0].length),e.position<=o.index&&a<0&&(a=n.length-2);a<0&&(a=n.length-1);var s="",l,p,u=Math.min(e.line+t.linesAfter,i.length).toString().length,d=t.maxLength-(t.indent+u+3);for(l=1;l<=t.linesBefore&&!(a-l<0);l++)p=We(e.buffer,n[a-l],i[a-l],e.position-(n[a]-n[a-l]),d),s=F.repeat(" ",t.indent)+$e((e.line-l+1).toString(),u)+" | "+p.str+`
`+s;for(p=We(e.buffer,n[a],i[a],e.position,d),s+=F.repeat(" ",t.indent)+$e((e.line+1).toString(),u)+" | "+p.str+`
`,s+=F.repeat("-",t.indent+u+3+p.pos)+`^
`,l=1;l<=t.linesAfter&&!(a+l>=i.length);l++)p=We(e.buffer,n[a+l],i[a+l],e.position-(n[a]-n[a+l]),d),s+=F.repeat(" ",t.indent)+$e((e.line+l+1).toString(),u)+" | "+p.str+`
`;return s.replace(/\n$/,"")}var br=Pr,wr=["kind","multi","resolve","construct","instanceOf","predicate","represent","representName","defaultStyle","styleAliases"],Ar=["scalar","sequence","mapping"];function Fr(e){var t={};return e!==null&&Object.keys(e).forEach(function(r){e[r].forEach(function(n){t[String(n)]=r})}),t}function Tr(e,t){if(t=t||{},Object.keys(t).forEach(function(r){if(wr.indexOf(r)===-1)throw new I('Unknown option "'+r+'" is met in definition of "'+e+'" YAML type.')}),this.options=t,this.tag=e,this.kind=t.kind||null,this.resolve=t.resolve||function(){return!0},this.construct=t.construct||function(r){return r},this.instanceOf=t.instanceOf||null,this.predicate=t.predicate||null,this.represent=t.represent||null,this.representName=t.representName||null,this.defaultStyle=t.defaultStyle||null,this.multi=t.multi||!1,this.styleAliases=Fr(t.styleAliases||null),Ar.indexOf(this.kind)===-1)throw new I('Unknown kind "'+this.kind+'" is specified for "'+e+'" YAML type.')}var E=Tr;function st(e,t){var r=[];return e[t].forEach(function(n){var i=r.length;r.forEach(function(o,a){o.tag===n.tag&&o.kind===n.kind&&o.multi===n.multi&&(i=a)}),r[i]=n}),r}function Sr(){var e={scalar:{},sequence:{},mapping:{},fallback:{},multi:{scalar:[],sequence:[],mapping:[],fallback:[]}},t,r;function n(i){i.multi?(e.multi[i.kind].push(i),e.multi.fallback.push(i)):e[i.kind][i.tag]=e.fallback[i.tag]=i}for(t=0,r=arguments.length;t<r;t+=1)arguments[t].forEach(n);return e}function He(e){return this.extend(e)}He.prototype.extend=function(t){var r=[],n=[];if(t instanceof E)n.push(t);else if(Array.isArray(t))n=n.concat(t);else if(t&&(Array.isArray(t.implicit)||Array.isArray(t.explicit)))t.implicit&&(r=r.concat(t.implicit)),t.explicit&&(n=n.concat(t.explicit));else throw new I("Schema.extend argument should be a Type, [ Type ], or a schema definition ({ implicit: [...], explicit: [...] })");r.forEach(function(o){if(!(o instanceof E))throw new I("Specified list of YAML types (or a single Type object) contains a non-Type object.");if(o.loadKind&&o.loadKind!=="scalar")throw new I("There is a non-scalar type in the implicit list of a schema. Implicit resolving of such types is not supported.");if(o.multi)throw new I("There is a multi type in the implicit list of a schema. Multi tags can only be listed as explicit.")}),n.forEach(function(o){if(!(o instanceof E))throw new I("Specified list of YAML types (or a single Type object) contains a non-Type object.")});var i=Object.create(He.prototype);return i.implicit=(this.implicit||[]).concat(r),i.explicit=(this.explicit||[]).concat(n),i.compiledImplicit=st(i,"implicit"),i.compiledExplicit=st(i,"explicit"),i.compiledTypeMap=Sr(i.compiledImplicit,i.compiledExplicit),i};var Er=He,Dr=new E("tag:yaml.org,2002:str",{kind:"scalar",construct:function(e){return e!==null?e:""}}),Nr=new E("tag:yaml.org,2002:seq",{kind:"sequence",construct:function(e){return e!==null?e:[]}}),Or=new E("tag:yaml.org,2002:map",{kind:"mapping",construct:function(e){return e!==null?e:{}}}),Ir=new Er({explicit:[Dr,Nr,Or]});function Lr(e){if(e===null)return!0;var t=e.length;return t===1&&e==="~"||t===4&&(e==="null"||e==="Null"||e==="NULL")}function Mr(){return null}function kr(e){return e===null}var jr=new E("tag:yaml.org,2002:null",{kind:"scalar",resolve:Lr,construct:Mr,predicate:kr,represent:{canonical:function(){return"~"},lowercase:function(){return"null"},uppercase:function(){return"NULL"},camelcase:function(){return"Null"},empty:function(){return""}},defaultStyle:"lowercase"});function _r(e){if(e===null)return!1;var t=e.length;return t===4&&(e==="true"||e==="True"||e==="TRUE")||t===5&&(e==="false"||e==="False"||e==="FALSE")}function Rr(e){return e==="true"||e==="True"||e==="TRUE"}function zr(e){return Object.prototype.toString.call(e)==="[object Boolean]"}var Br=new E("tag:yaml.org,2002:bool",{kind:"scalar",resolve:_r,construct:Rr,predicate:zr,represent:{lowercase:function(e){return e?"true":"false"},uppercase:function(e){return e?"TRUE":"FALSE"},camelcase:function(e){return e?"True":"False"}},defaultStyle:"lowercase"});function Wr(e){return 48<=e&&e<=57||65<=e&&e<=70||97<=e&&e<=102}function $r(e){return 48<=e&&e<=55}function Yr(e){return 48<=e&&e<=57}function Hr(e){if(e===null)return!1;var t=e.length,r=0,n=!1,i;if(!t)return!1;if(i=e[r],(i==="-"||i==="+")&&(i=e[++r]),i==="0"){if(r+1===t)return!0;if(i=e[++r],i==="b"){for(r++;r<t;r++)if(i=e[r],i!=="_"){if(i!=="0"&&i!=="1")return!1;n=!0}return n&&i!=="_"}if(i==="x"){for(r++;r<t;r++)if(i=e[r],i!=="_"){if(!Wr(e.charCodeAt(r)))return!1;n=!0}return n&&i!=="_"}if(i==="o"){for(r++;r<t;r++)if(i=e[r],i!=="_"){if(!$r(e.charCodeAt(r)))return!1;n=!0}return n&&i!=="_"}}if(i==="_")return!1;for(;r<t;r++)if(i=e[r],i!=="_"){if(!Yr(e.charCodeAt(r)))return!1;n=!0}return!(!n||i==="_")}function Ur(e){var t=e,r=1,n;if(t.indexOf("_")!==-1&&(t=t.replace(/_/g,"")),n=t[0],(n==="-"||n==="+")&&(n==="-"&&(r=-1),t=t.slice(1),n=t[0]),t==="0")return 0;if(n==="0"){if(t[1]==="b")return r*parseInt(t.slice(2),2);if(t[1]==="x")return r*parseInt(t.slice(2),16);if(t[1]==="o")return r*parseInt(t.slice(2),8)}return r*parseInt(t,10)}function Gr(e){return Object.prototype.toString.call(e)==="[object Number]"&&e%1===0&&!F.isNegativeZero(e)}var Vr=new E("tag:yaml.org,2002:int",{kind:"scalar",resolve:Hr,construct:Ur,predicate:Gr,represent:{binary:function(e){return e>=0?"0b"+e.toString(2):"-0b"+e.toString(2).slice(1)},octal:function(e){return e>=0?"0o"+e.toString(8):"-0o"+e.toString(8).slice(1)},decimal:function(e){return e.toString(10)},hexadecimal:function(e){return e>=0?"0x"+e.toString(16).toUpperCase():"-0x"+e.toString(16).toUpperCase().slice(1)}},defaultStyle:"decimal",styleAliases:{binary:[2,"bin"],octal:[8,"oct"],decimal:[10,"dec"],hexadecimal:[16,"hex"]}}),qr=new RegExp("^(?:[-+]?(?:[0-9][0-9_]*)(?:\\.[0-9_]*)?(?:[eE][-+]?[0-9]+)?|\\.[0-9_]+(?:[eE][-+]?[0-9]+)?|[-+]?\\.(?:inf|Inf|INF)|\\.(?:nan|NaN|NAN))$");function Kr(e){return!(e===null||!qr.test(e)||e[e.length-1]==="_")}function Jr(e){var t,r;return t=e.replace(/_/g,"").toLowerCase(),r=t[0]==="-"?-1:1,"+-".indexOf(t[0])>=0&&(t=t.slice(1)),t===".inf"?r===1?Number.POSITIVE_INFINITY:Number.NEGATIVE_INFINITY:t===".nan"?NaN:r*parseFloat(t,10)}var Qr=/^[-+]?[0-9]+e/;function Xr(e,t){var r;if(isNaN(e))switch(t){case"lowercase":return".nan";case"uppercase":return".NAN";case"camelcase":return".NaN"}else if(Number.POSITIVE_INFINITY===e)switch(t){case"lowercase":return".inf";case"uppercase":return".INF";case"camelcase":return".Inf"}else if(Number.NEGATIVE_INFINITY===e)switch(t){case"lowercase":return"-.inf";case"uppercase":return"-.INF";case"camelcase":return"-.Inf"}else if(F.isNegativeZero(e))return"-0.0";return r=e.toString(10),Qr.test(r)?r.replace("e",".e"):r}function Zr(e){return Object.prototype.toString.call(e)==="[object Number]"&&(e%1!==0||F.isNegativeZero(e))}var ei=new E("tag:yaml.org,2002:float",{kind:"scalar",resolve:Kr,construct:Jr,predicate:Zr,represent:Xr,defaultStyle:"lowercase"}),ti=Ir.extend({implicit:[jr,Br,Vr,ei]}),ri=ti,At=new RegExp("^([0-9][0-9][0-9][0-9])-([0-9][0-9])-([0-9][0-9])$"),Ft=new RegExp("^([0-9][0-9][0-9][0-9])-([0-9][0-9]?)-([0-9][0-9]?)(?:[Tt]|[ \\t]+)([0-9][0-9]?):([0-9][0-9]):([0-9][0-9])(?:\\.([0-9]*))?(?:[ \\t]*(Z|([-+])([0-9][0-9]?)(?::([0-9][0-9]))?))?$");function ii(e){return e===null?!1:At.exec(e)!==null||Ft.exec(e)!==null}function ni(e){var t,r,n,i,o,a,s,l=0,p=null,u,d,f;if(t=At.exec(e),t===null&&(t=Ft.exec(e)),t===null)throw new Error("Date resolve error");if(r=+t[1],n=+t[2]-1,i=+t[3],!t[4])return new Date(Date.UTC(r,n,i));if(o=+t[4],a=+t[5],s=+t[6],t[7]){for(l=t[7].slice(0,3);l.length<3;)l+="0";l=+l}return t[9]&&(u=+t[10],d=+(t[11]||0),p=(u*60+d)*6e4,t[9]==="-"&&(p=-p)),f=new Date(Date.UTC(r,n,i,o,a,s,l)),p&&f.setTime(f.getTime()-p),f}function oi(e){return e.toISOString()}var ai=new E("tag:yaml.org,2002:timestamp",{kind:"scalar",resolve:ii,construct:ni,instanceOf:Date,represent:oi});function si(e){return e==="<<"||e===null}var li=new E("tag:yaml.org,2002:merge",{kind:"scalar",resolve:si}),Ke=`ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=
\r`;function pi(e){if(e===null)return!1;var t,r,n=0,i=e.length,o=Ke;for(r=0;r<i;r++)if(t=o.indexOf(e.charAt(r)),!(t>64)){if(t<0)return!1;n+=6}return n%8===0}function ci(e){var t,r,n=e.replace(/[\r\n=]/g,""),i=n.length,o=Ke,a=0,s=[];for(t=0;t<i;t++)t%4===0&&t&&(s.push(a>>16&255),s.push(a>>8&255),s.push(a&255)),a=a<<6|o.indexOf(n.charAt(t));return r=i%4*6,r===0?(s.push(a>>16&255),s.push(a>>8&255),s.push(a&255)):r===18?(s.push(a>>10&255),s.push(a>>2&255)):r===12&&s.push(a>>4&255),new Uint8Array(s)}function fi(e){var t="",r=0,n,i,o=e.length,a=Ke;for(n=0;n<o;n++)n%3===0&&n&&(t+=a[r>>18&63],t+=a[r>>12&63],t+=a[r>>6&63],t+=a[r&63]),r=(r<<8)+e[n];return i=o%3,i===0?(t+=a[r>>18&63],t+=a[r>>12&63],t+=a[r>>6&63],t+=a[r&63]):i===2?(t+=a[r>>10&63],t+=a[r>>4&63],t+=a[r<<2&63],t+=a[64]):i===1&&(t+=a[r>>2&63],t+=a[r<<4&63],t+=a[64],t+=a[64]),t}function ui(e){return Object.prototype.toString.call(e)==="[object Uint8Array]"}var di=new E("tag:yaml.org,2002:binary",{kind:"scalar",resolve:pi,construct:ci,predicate:ui,represent:fi}),hi=Object.prototype.hasOwnProperty,mi=Object.prototype.toString;function gi(e){if(e===null)return!0;var t=[],r,n,i,o,a,s=e;for(r=0,n=s.length;r<n;r+=1){if(i=s[r],a=!1,mi.call(i)!=="[object Object]")return!1;for(o in i)if(hi.call(i,o))if(!a)a=!0;else return!1;if(!a)return!1;if(t.indexOf(o)===-1)t.push(o);else return!1}return!0}function yi(e){return e!==null?e:[]}var vi=new E("tag:yaml.org,2002:omap",{kind:"sequence",resolve:gi,construct:yi}),Ci=Object.prototype.toString;function xi(e){if(e===null)return!0;var t,r,n,i,o,a=e;for(o=new Array(a.length),t=0,r=a.length;t<r;t+=1){if(n=a[t],Ci.call(n)!=="[object Object]"||(i=Object.keys(n),i.length!==1))return!1;o[t]=[i[0],n[i[0]]]}return!0}function Pi(e){if(e===null)return[];var t,r,n,i,o,a=e;for(o=new Array(a.length),t=0,r=a.length;t<r;t+=1)n=a[t],i=Object.keys(n),o[t]=[i[0],n[i[0]]];return o}var bi=new E("tag:yaml.org,2002:pairs",{kind:"sequence",resolve:xi,construct:Pi}),wi=Object.prototype.hasOwnProperty;function Ai(e){if(e===null)return!0;var t,r=e;for(t in r)if(wi.call(r,t)&&r[t]!==null)return!1;return!0}function Fi(e){return e!==null?e:{}}var Ti=new E("tag:yaml.org,2002:set",{kind:"mapping",resolve:Ai,construct:Fi}),Tt=ri.extend({implicit:[ai,li],explicit:[di,vi,bi,Ti]}),W=Object.prototype.hasOwnProperty,de=1,St=2,Et=3,he=4,Ye=1,Si=2,lt=3,Ei=/[\x00-\x08\x0B\x0C\x0E-\x1F\x7F-\x84\x86-\x9F\uFFFE\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]/,Di=/[\x85\u2028\u2029]/,Ni=/[,\[\]\{\}]/,Dt=/^(?:!|!!|![a-z\-]+!)$/i,Nt=/^(?:!|[^,\[\]\{\}])(?:%[0-9a-f]{2}|[0-9a-z\-#;\/\?:@&=\+\$,_\.!~\*'\(\)\[\]])*$/i;function pt(e){return Object.prototype.toString.call(e)}function k(e){return e===10||e===13}function H(e){return e===9||e===32}function L(e){return e===9||e===32||e===10||e===13}function K(e){return e===44||e===91||e===93||e===123||e===125}function Oi(e){var t;return 48<=e&&e<=57?e-48:(t=e|32,97<=t&&t<=102?t-97+10:-1)}function Ii(e){return e===120?2:e===117?4:e===85?8:0}function Li(e){return 48<=e&&e<=57?e-48:-1}function ct(e){return e===48?"\0":e===97?"\x07":e===98?"\b":e===116||e===9?"	":e===110?`
`:e===118?"\v":e===102?"\f":e===114?"\r":e===101?"\x1B":e===32?" ":e===34?'"':e===47?"/":e===92?"\\":e===78?"\x85":e===95?"\xA0":e===76?"\u2028":e===80?"\u2029":""}function Mi(e){return e<=65535?String.fromCharCode(e):String.fromCharCode((e-65536>>10)+55296,(e-65536&1023)+56320)}function Ot(e,t,r){t==="__proto__"?Object.defineProperty(e,t,{configurable:!0,enumerable:!0,writable:!0,value:r}):e[t]=r}var It=new Array(256),Lt=new Array(256);for(Y=0;Y<256;Y++)It[Y]=ct(Y)?1:0,Lt[Y]=ct(Y);var Y;function ki(e,t){this.input=e,this.filename=t.filename||null,this.schema=t.schema||Tt,this.onWarning=t.onWarning||null,this.legacy=t.legacy||!1,this.json=t.json||!1,this.listener=t.listener||null,this.implicitTypes=this.schema.compiledImplicit,this.typeMap=this.schema.compiledTypeMap,this.length=e.length,this.position=0,this.line=0,this.lineStart=0,this.lineIndent=0,this.firstTabInLine=-1,this.documents=[]}function Mt(e,t){var r={name:e.filename,buffer:e.input.slice(0,-1),position:e.position,line:e.line,column:e.position-e.lineStart};return r.snippet=br(r),new I(t,r)}function g(e,t){throw Mt(e,t)}function me(e,t){e.onWarning&&e.onWarning.call(null,Mt(e,t))}var ft={YAML:function(t,r,n){var i,o,a;t.version!==null&&g(t,"duplication of %YAML directive"),n.length!==1&&g(t,"YAML directive accepts exactly one argument"),i=/^([0-9]+)\.([0-9]+)$/.exec(n[0]),i===null&&g(t,"ill-formed argument of the YAML directive"),o=parseInt(i[1],10),a=parseInt(i[2],10),o!==1&&g(t,"unacceptable YAML version of the document"),t.version=n[0],t.checkLineBreaks=a<2,a!==1&&a!==2&&me(t,"unsupported YAML version of the document")},TAG:function(t,r,n){var i,o;n.length!==2&&g(t,"TAG directive accepts exactly two arguments"),i=n[0],o=n[1],Dt.test(i)||g(t,"ill-formed tag handle (first argument) of the TAG directive"),W.call(t.tagMap,i)&&g(t,'there is a previously declared suffix for "'+i+'" tag handle'),Nt.test(o)||g(t,"ill-formed tag prefix (second argument) of the TAG directive");try{o=decodeURIComponent(o)}catch(a){g(t,"tag prefix is malformed: "+o)}t.tagMap[i]=o}};function B(e,t,r,n){var i,o,a,s;if(t<r){if(s=e.input.slice(t,r),n)for(i=0,o=s.length;i<o;i+=1)a=s.charCodeAt(i),a===9||32<=a&&a<=1114111||g(e,"expected valid JSON character");else Ei.test(s)&&g(e,"the stream contains non-printable characters");e.result+=s}}function ut(e,t,r,n){var i,o,a,s;for(F.isObject(r)||g(e,"cannot merge mappings; the provided source object is unacceptable"),i=Object.keys(r),a=0,s=i.length;a<s;a+=1)o=i[a],W.call(t,o)||(Ot(t,o,r[o]),n[o]=!0)}function J(e,t,r,n,i,o,a,s,l){var p,u;if(Array.isArray(i))for(i=Array.prototype.slice.call(i),p=0,u=i.length;p<u;p+=1)Array.isArray(i[p])&&g(e,"nested arrays are not supported inside keys"),typeof i=="object"&&pt(i[p])==="[object Object]"&&(i[p]="[object Object]");if(typeof i=="object"&&pt(i)==="[object Object]"&&(i="[object Object]"),i=String(i),t===null&&(t={}),n==="tag:yaml.org,2002:merge")if(Array.isArray(o))for(p=0,u=o.length;p<u;p+=1)ut(e,t,o[p],r);else ut(e,t,o,r);else!e.json&&!W.call(r,i)&&W.call(t,i)&&(e.line=a||e.line,e.lineStart=s||e.lineStart,e.position=l||e.position,g(e,"duplicated mapping key")),Ot(t,i,o),delete r[i];return t}function Je(e){var t;t=e.input.charCodeAt(e.position),t===10?e.position++:t===13?(e.position++,e.input.charCodeAt(e.position)===10&&e.position++):g(e,"a line break is expected"),e.line+=1,e.lineStart=e.position,e.firstTabInLine=-1}function A(e,t,r){for(var n=0,i=e.input.charCodeAt(e.position);i!==0;){for(;H(i);)i===9&&e.firstTabInLine===-1&&(e.firstTabInLine=e.position),i=e.input.charCodeAt(++e.position);if(t&&i===35)do i=e.input.charCodeAt(++e.position);while(i!==10&&i!==13&&i!==0);if(k(i))for(Je(e),i=e.input.charCodeAt(e.position),n++,e.lineIndent=0;i===32;)e.lineIndent++,i=e.input.charCodeAt(++e.position);else break}return r!==-1&&n!==0&&e.lineIndent<r&&me(e,"deficient indentation"),n}function ve(e){var t=e.position,r;return r=e.input.charCodeAt(t),!!((r===45||r===46)&&r===e.input.charCodeAt(t+1)&&r===e.input.charCodeAt(t+2)&&(t+=3,r=e.input.charCodeAt(t),r===0||L(r)))}function Qe(e,t){t===1?e.result+=" ":t>1&&(e.result+=F.repeat(`
`,t-1))}function ji(e,t,r){var n,i,o,a,s,l,p,u,d=e.kind,f=e.result,c;if(c=e.input.charCodeAt(e.position),L(c)||K(c)||c===35||c===38||c===42||c===33||c===124||c===62||c===39||c===34||c===37||c===64||c===96||(c===63||c===45)&&(i=e.input.charCodeAt(e.position+1),L(i)||r&&K(i)))return!1;for(e.kind="scalar",e.result="",o=a=e.position,s=!1;c!==0;){if(c===58){if(i=e.input.charCodeAt(e.position+1),L(i)||r&&K(i))break}else if(c===35){if(n=e.input.charCodeAt(e.position-1),L(n))break}else{if(e.position===e.lineStart&&ve(e)||r&&K(c))break;if(k(c))if(l=e.line,p=e.lineStart,u=e.lineIndent,A(e,!1,-1),e.lineIndent>=t){s=!0,c=e.input.charCodeAt(e.position);continue}else{e.position=a,e.line=l,e.lineStart=p,e.lineIndent=u;break}}s&&(B(e,o,a,!1),Qe(e,e.line-l),o=a=e.position,s=!1),H(c)||(a=e.position+1),c=e.input.charCodeAt(++e.position)}return B(e,o,a,!1),e.result?!0:(e.kind=d,e.result=f,!1)}function _i(e,t){var r,n,i;if(r=e.input.charCodeAt(e.position),r!==39)return!1;for(e.kind="scalar",e.result="",e.position++,n=i=e.position;(r=e.input.charCodeAt(e.position))!==0;)if(r===39)if(B(e,n,e.position,!0),r=e.input.charCodeAt(++e.position),r===39)n=e.position,e.position++,i=e.position;else return!0;else k(r)?(B(e,n,i,!0),Qe(e,A(e,!1,t)),n=i=e.position):e.position===e.lineStart&&ve(e)?g(e,"unexpected end of the document within a single quoted scalar"):(e.position++,i=e.position);g(e,"unexpected end of the stream within a single quoted scalar")}function Ri(e,t){var r,n,i,o,a,s;if(s=e.input.charCodeAt(e.position),s!==34)return!1;for(e.kind="scalar",e.result="",e.position++,r=n=e.position;(s=e.input.charCodeAt(e.position))!==0;){if(s===34)return B(e,r,e.position,!0),e.position++,!0;if(s===92){if(B(e,r,e.position,!0),s=e.input.charCodeAt(++e.position),k(s))A(e,!1,t);else if(s<256&&It[s])e.result+=Lt[s],e.position++;else if((a=Ii(s))>0){for(i=a,o=0;i>0;i--)s=e.input.charCodeAt(++e.position),(a=Oi(s))>=0?o=(o<<4)+a:g(e,"expected hexadecimal character");e.result+=Mi(o),e.position++}else g(e,"unknown escape sequence");r=n=e.position}else k(s)?(B(e,r,n,!0),Qe(e,A(e,!1,t)),r=n=e.position):e.position===e.lineStart&&ve(e)?g(e,"unexpected end of the document within a double quoted scalar"):(e.position++,n=e.position)}g(e,"unexpected end of the stream within a double quoted scalar")}function zi(e,t){var r=!0,n,i,o,a=e.tag,s,l=e.anchor,p,u,d,f,c,h=Object.create(null),m,x,b,v;if(v=e.input.charCodeAt(e.position),v===91)u=93,c=!1,s=[];else if(v===123)u=125,c=!0,s={};else return!1;for(e.anchor!==null&&(e.anchorMap[e.anchor]=s),v=e.input.charCodeAt(++e.position);v!==0;){if(A(e,!0,t),v=e.input.charCodeAt(e.position),v===u)return e.position++,e.tag=a,e.anchor=l,e.kind=c?"mapping":"sequence",e.result=s,!0;r?v===44&&g(e,"expected the node content, but found ','"):g(e,"missed comma between flow collection entries"),x=m=b=null,d=f=!1,v===63&&(p=e.input.charCodeAt(e.position+1),L(p)&&(d=f=!0,e.position++,A(e,!0,t))),n=e.line,i=e.lineStart,o=e.position,Q(e,t,de,!1,!0),x=e.tag,m=e.result,A(e,!0,t),v=e.input.charCodeAt(e.position),(f||e.line===n)&&v===58&&(d=!0,v=e.input.charCodeAt(++e.position),A(e,!0,t),Q(e,t,de,!1,!0),b=e.result),c?J(e,s,h,x,m,b,n,i,o):d?s.push(J(e,null,h,x,m,b,n,i,o)):s.push(m),A(e,!0,t),v=e.input.charCodeAt(e.position),v===44?(r=!0,v=e.input.charCodeAt(++e.position)):r=!1}g(e,"unexpected end of the stream within a flow collection")}function Bi(e,t){var r,n,i=Ye,o=!1,a=!1,s=t,l=0,p=!1,u,d;if(d=e.input.charCodeAt(e.position),d===124)n=!1;else if(d===62)n=!0;else return!1;for(e.kind="scalar",e.result="";d!==0;)if(d=e.input.charCodeAt(++e.position),d===43||d===45)Ye===i?i=d===43?lt:Si:g(e,"repeat of a chomping mode identifier");else if((u=Li(d))>=0)u===0?g(e,"bad explicit indentation width of a block scalar; it cannot be less than one"):a?g(e,"repeat of an indentation width identifier"):(s=t+u-1,a=!0);else break;if(H(d)){do d=e.input.charCodeAt(++e.position);while(H(d));if(d===35)do d=e.input.charCodeAt(++e.position);while(!k(d)&&d!==0)}for(;d!==0;){for(Je(e),e.lineIndent=0,d=e.input.charCodeAt(e.position);(!a||e.lineIndent<s)&&d===32;)e.lineIndent++,d=e.input.charCodeAt(++e.position);if(!a&&e.lineIndent>s&&(s=e.lineIndent),k(d)){l++;continue}if(e.lineIndent<s){i===lt?e.result+=F.repeat(`
`,o?1+l:l):i===Ye&&o&&(e.result+=`
`);break}for(n?H(d)?(p=!0,e.result+=F.repeat(`
`,o?1+l:l)):p?(p=!1,e.result+=F.repeat(`
`,l+1)):l===0?o&&(e.result+=" "):e.result+=F.repeat(`
`,l):e.result+=F.repeat(`
`,o?1+l:l),o=!0,a=!0,l=0,r=e.position;!k(d)&&d!==0;)d=e.input.charCodeAt(++e.position);B(e,r,e.position,!1)}return!0}function dt(e,t){var r,n=e.tag,i=e.anchor,o=[],a,s=!1,l;if(e.firstTabInLine!==-1)return!1;for(e.anchor!==null&&(e.anchorMap[e.anchor]=o),l=e.input.charCodeAt(e.position);l!==0&&(e.firstTabInLine!==-1&&(e.position=e.firstTabInLine,g(e,"tab characters must not be used in indentation")),!(l!==45||(a=e.input.charCodeAt(e.position+1),!L(a))));){if(s=!0,e.position++,A(e,!0,-1)&&e.lineIndent<=t){o.push(null),l=e.input.charCodeAt(e.position);continue}if(r=e.line,Q(e,t,Et,!1,!0),o.push(e.result),A(e,!0,-1),l=e.input.charCodeAt(e.position),(e.line===r||e.lineIndent>t)&&l!==0)g(e,"bad indentation of a sequence entry");else if(e.lineIndent<t)break}return s?(e.tag=n,e.anchor=i,e.kind="sequence",e.result=o,!0):!1}function Wi(e,t,r){var n,i,o,a,s,l,p=e.tag,u=e.anchor,d={},f=Object.create(null),c=null,h=null,m=null,x=!1,b=!1,v;if(e.firstTabInLine!==-1)return!1;for(e.anchor!==null&&(e.anchorMap[e.anchor]=d),v=e.input.charCodeAt(e.position);v!==0;){if(!x&&e.firstTabInLine!==-1&&(e.position=e.firstTabInLine,g(e,"tab characters must not be used in indentation")),n=e.input.charCodeAt(e.position+1),o=e.line,(v===63||v===58)&&L(n))v===63?(x&&(J(e,d,f,c,h,null,a,s,l),c=h=m=null),b=!0,x=!0,i=!0):x?(x=!1,i=!0):g(e,"incomplete explicit mapping pair; a key node is missed; or followed by a non-tabulated empty line"),e.position+=1,v=n;else{if(a=e.line,s=e.lineStart,l=e.position,!Q(e,r,St,!1,!0))break;if(e.line===o){for(v=e.input.charCodeAt(e.position);H(v);)v=e.input.charCodeAt(++e.position);if(v===58)v=e.input.charCodeAt(++e.position),L(v)||g(e,"a whitespace character is expected after the key-value separator within a block mapping"),x&&(J(e,d,f,c,h,null,a,s,l),c=h=m=null),b=!0,x=!1,i=!1,c=e.tag,h=e.result;else if(b)g(e,"can not read an implicit mapping pair; a colon is missed");else return e.tag=p,e.anchor=u,!0}else if(b)g(e,"can not read a block mapping entry; a multiline key may not be an implicit key");else return e.tag=p,e.anchor=u,!0}if((e.line===o||e.lineIndent>t)&&(x&&(a=e.line,s=e.lineStart,l=e.position),Q(e,t,he,!0,i)&&(x?h=e.result:m=e.result),x||(J(e,d,f,c,h,m,a,s,l),c=h=m=null),A(e,!0,-1),v=e.input.charCodeAt(e.position)),(e.line===o||e.lineIndent>t)&&v!==0)g(e,"bad indentation of a mapping entry");else if(e.lineIndent<t)break}return x&&J(e,d,f,c,h,null,a,s,l),b&&(e.tag=p,e.anchor=u,e.kind="mapping",e.result=d),b}function $i(e){var t,r=!1,n=!1,i,o,a;if(a=e.input.charCodeAt(e.position),a!==33)return!1;if(e.tag!==null&&g(e,"duplication of a tag property"),a=e.input.charCodeAt(++e.position),a===60?(r=!0,a=e.input.charCodeAt(++e.position)):a===33?(n=!0,i="!!",a=e.input.charCodeAt(++e.position)):i="!",t=e.position,r){do a=e.input.charCodeAt(++e.position);while(a!==0&&a!==62);e.position<e.length?(o=e.input.slice(t,e.position),a=e.input.charCodeAt(++e.position)):g(e,"unexpected end of the stream within a verbatim tag")}else{for(;a!==0&&!L(a);)a===33&&(n?g(e,"tag suffix cannot contain exclamation marks"):(i=e.input.slice(t-1,e.position+1),Dt.test(i)||g(e,"named tag handle cannot contain such characters"),n=!0,t=e.position+1)),a=e.input.charCodeAt(++e.position);o=e.input.slice(t,e.position),Ni.test(o)&&g(e,"tag suffix cannot contain flow indicator characters")}o&&!Nt.test(o)&&g(e,"tag name cannot contain such characters: "+o);try{o=decodeURIComponent(o)}catch(s){g(e,"tag name is malformed: "+o)}return r?e.tag=o:W.call(e.tagMap,i)?e.tag=e.tagMap[i]+o:i==="!"?e.tag="!"+o:i==="!!"?e.tag="tag:yaml.org,2002:"+o:g(e,'undeclared tag handle "'+i+'"'),!0}function Yi(e){var t,r;if(r=e.input.charCodeAt(e.position),r!==38)return!1;for(e.anchor!==null&&g(e,"duplication of an anchor property"),r=e.input.charCodeAt(++e.position),t=e.position;r!==0&&!L(r)&&!K(r);)r=e.input.charCodeAt(++e.position);return e.position===t&&g(e,"name of an anchor node must contain at least one character"),e.anchor=e.input.slice(t,e.position),!0}function Hi(e){var t,r,n;if(n=e.input.charCodeAt(e.position),n!==42)return!1;for(n=e.input.charCodeAt(++e.position),t=e.position;n!==0&&!L(n)&&!K(n);)n=e.input.charCodeAt(++e.position);return e.position===t&&g(e,"name of an alias node must contain at least one character"),r=e.input.slice(t,e.position),W.call(e.anchorMap,r)||g(e,'unidentified alias "'+r+'"'),e.result=e.anchorMap[r],A(e,!0,-1),!0}function Q(e,t,r,n,i){var o,a,s,l=1,p=!1,u=!1,d,f,c,h,m,x;if(e.listener!==null&&e.listener("open",e),e.tag=null,e.anchor=null,e.kind=null,e.result=null,o=a=s=he===r||Et===r,n&&A(e,!0,-1)&&(p=!0,e.lineIndent>t?l=1:e.lineIndent===t?l=0:e.lineIndent<t&&(l=-1)),l===1)for(;$i(e)||Yi(e);)A(e,!0,-1)?(p=!0,s=o,e.lineIndent>t?l=1:e.lineIndent===t?l=0:e.lineIndent<t&&(l=-1)):s=!1;if(s&&(s=p||i),(l===1||he===r)&&(de===r||St===r?m=t:m=t+1,x=e.position-e.lineStart,l===1?s&&(dt(e,x)||Wi(e,x,m))||zi(e,m)?u=!0:(a&&Bi(e,m)||_i(e,m)||Ri(e,m)?u=!0:Hi(e)?(u=!0,(e.tag!==null||e.anchor!==null)&&g(e,"alias node should not have any properties")):ji(e,m,de===r)&&(u=!0,e.tag===null&&(e.tag="?")),e.anchor!==null&&(e.anchorMap[e.anchor]=e.result)):l===0&&(u=s&&dt(e,x))),e.tag===null)e.anchor!==null&&(e.anchorMap[e.anchor]=e.result);else if(e.tag==="?"){for(e.result!==null&&e.kind!=="scalar"&&g(e,'unacceptable node kind for !<?> tag; it should be "scalar", not "'+e.kind+'"'),d=0,f=e.implicitTypes.length;d<f;d+=1)if(h=e.implicitTypes[d],h.resolve(e.result)){e.result=h.construct(e.result),e.tag=h.tag,e.anchor!==null&&(e.anchorMap[e.anchor]=e.result);break}}else if(e.tag!=="!"){if(W.call(e.typeMap[e.kind||"fallback"],e.tag))h=e.typeMap[e.kind||"fallback"][e.tag];else for(h=null,c=e.typeMap.multi[e.kind||"fallback"],d=0,f=c.length;d<f;d+=1)if(e.tag.slice(0,c[d].tag.length)===c[d].tag){h=c[d];break}h||g(e,"unknown tag !<"+e.tag+">"),e.result!==null&&h.kind!==e.kind&&g(e,"unacceptable node kind for !<"+e.tag+'> tag; it should be "'+h.kind+'", not "'+e.kind+'"'),h.resolve(e.result,e.tag)?(e.result=h.construct(e.result,e.tag),e.anchor!==null&&(e.anchorMap[e.anchor]=e.result)):g(e,"cannot resolve a node with !<"+e.tag+"> explicit tag")}return e.listener!==null&&e.listener("close",e),e.tag!==null||e.anchor!==null||u}function Ui(e){var t=e.position,r,n,i,o=!1,a;for(e.version=null,e.checkLineBreaks=e.legacy,e.tagMap=Object.create(null),e.anchorMap=Object.create(null);(a=e.input.charCodeAt(e.position))!==0&&(A(e,!0,-1),a=e.input.charCodeAt(e.position),!(e.lineIndent>0||a!==37));){for(o=!0,a=e.input.charCodeAt(++e.position),r=e.position;a!==0&&!L(a);)a=e.input.charCodeAt(++e.position);for(n=e.input.slice(r,e.position),i=[],n.length<1&&g(e,"directive name must not be less than one character in length");a!==0;){for(;H(a);)a=e.input.charCodeAt(++e.position);if(a===35){do a=e.input.charCodeAt(++e.position);while(a!==0&&!k(a));break}if(k(a))break;for(r=e.position;a!==0&&!L(a);)a=e.input.charCodeAt(++e.position);i.push(e.input.slice(r,e.position))}a!==0&&Je(e),W.call(ft,n)?ft[n](e,n,i):me(e,'unknown document directive "'+n+'"')}if(A(e,!0,-1),e.lineIndent===0&&e.input.charCodeAt(e.position)===45&&e.input.charCodeAt(e.position+1)===45&&e.input.charCodeAt(e.position+2)===45?(e.position+=3,A(e,!0,-1)):o&&g(e,"directives end mark is expected"),Q(e,e.lineIndent-1,he,!1,!0),A(e,!0,-1),e.checkLineBreaks&&Di.test(e.input.slice(t,e.position))&&me(e,"non-ASCII line breaks are interpreted as content"),e.documents.push(e.result),e.position===e.lineStart&&ve(e)){e.input.charCodeAt(e.position)===46&&(e.position+=3,A(e,!0,-1));return}if(e.position<e.length-1)g(e,"end of the stream or a document separator is expected");else return}function kt(e,t){e=String(e),t=t||{},e.length!==0&&(e.charCodeAt(e.length-1)!==10&&e.charCodeAt(e.length-1)!==13&&(e+=`
`),e.charCodeAt(0)===65279&&(e=e.slice(1)));var r=new ki(e,t),n=e.indexOf("\0");for(n!==-1&&(r.position=n,g(r,"null byte is not allowed in input")),r.input+="\0";r.input.charCodeAt(r.position)===32;)r.lineIndent+=1,r.position+=1;for(;r.position<r.length-1;)Ui(r);return r.documents}function Gi(e,t,r){t!==null&&typeof t=="object"&&typeof r=="undefined"&&(r=t,t=null);var n=kt(e,r);if(typeof t!="function")return n;for(var i=0,o=n.length;i<o;i+=1)t(n[i])}function Vi(e,t){var r=kt(e,t);if(r.length!==0){if(r.length===1)return r[0];throw new I("expected a single document in the stream, but found more")}}var qi=Gi,Ki=Vi,jt={loadAll:qi,load:Ki},_t=Object.prototype.toString,Rt=Object.prototype.hasOwnProperty,Xe=65279,Ji=9,re=10,Qi=13,Xi=32,Zi=33,en=34,Ue=35,tn=37,rn=38,nn=39,on=42,zt=44,an=45,ge=58,sn=61,ln=62,pn=63,cn=64,Bt=91,Wt=93,fn=96,$t=123,un=124,Yt=125,D={};D[0]="\\0";D[7]="\\a";D[8]="\\b";D[9]="\\t";D[10]="\\n";D[11]="\\v";D[12]="\\f";D[13]="\\r";D[27]="\\e";D[34]='\\"';D[92]="\\\\";D[133]="\\N";D[160]="\\_";D[8232]="\\L";D[8233]="\\P";var dn=["y","Y","yes","Yes","YES","on","On","ON","n","N","no","No","NO","off","Off","OFF"],hn=/^[-+]?[0-9_]+(?::[0-9_]+)+(?:\.[0-9_]*)?$/;function mn(e,t){var r,n,i,o,a,s,l;if(t===null)return{};for(r={},n=Object.keys(t),i=0,o=n.length;i<o;i+=1)a=n[i],s=String(t[a]),a.slice(0,2)==="!!"&&(a="tag:yaml.org,2002:"+a.slice(2)),l=e.compiledTypeMap.fallback[a],l&&Rt.call(l.styleAliases,s)&&(s=l.styleAliases[s]),r[a]=s;return r}function gn(e){var t,r,n;if(t=e.toString(16).toUpperCase(),e<=255)r="x",n=2;else if(e<=65535)r="u",n=4;else if(e<=4294967295)r="U",n=8;else throw new I("code point within a string may not be greater than 0xFFFFFFFF");return"\\"+r+F.repeat("0",n-t.length)+t}var yn=1,ie=2;function vn(e){this.schema=e.schema||Tt,this.indent=Math.max(1,e.indent||2),this.noArrayIndent=e.noArrayIndent||!1,this.skipInvalid=e.skipInvalid||!1,this.flowLevel=F.isNothing(e.flowLevel)?-1:e.flowLevel,this.styleMap=mn(this.schema,e.styles||null),this.sortKeys=e.sortKeys||!1,this.lineWidth=e.lineWidth||80,this.noRefs=e.noRefs||!1,this.noCompatMode=e.noCompatMode||!1,this.condenseFlow=e.condenseFlow||!1,this.quotingType=e.quotingType==='"'?ie:yn,this.forceQuotes=e.forceQuotes||!1,this.replacer=typeof e.replacer=="function"?e.replacer:null,this.implicitTypes=this.schema.compiledImplicit,this.explicitTypes=this.schema.compiledExplicit,this.tag=null,this.result="",this.duplicates=[],this.usedDuplicates=null}function ht(e,t){for(var r=F.repeat(" ",t),n=0,i=-1,o="",a,s=e.length;n<s;)i=e.indexOf(`
`,n),i===-1?(a=e.slice(n),n=s):(a=e.slice(n,i+1),n=i+1),a.length&&a!==`
`&&(o+=r),o+=a;return o}function Ge(e,t){return`
`+F.repeat(" ",e.indent*t)}function Cn(e,t){var r,n,i;for(r=0,n=e.implicitTypes.length;r<n;r+=1)if(i=e.implicitTypes[r],i.resolve(t))return!0;return!1}function ye(e){return e===Xi||e===Ji}function ne(e){return 32<=e&&e<=126||161<=e&&e<=55295&&e!==8232&&e!==8233||57344<=e&&e<=65533&&e!==Xe||65536<=e&&e<=1114111}function mt(e){return ne(e)&&e!==Xe&&e!==Qi&&e!==re}function gt(e,t,r){var n=mt(e),i=n&&!ye(e);return(r?n:n&&e!==zt&&e!==Bt&&e!==Wt&&e!==$t&&e!==Yt)&&e!==Ue&&!(t===ge&&!i)||mt(t)&&!ye(t)&&e===Ue||t===ge&&i}function xn(e){return ne(e)&&e!==Xe&&!ye(e)&&e!==an&&e!==pn&&e!==ge&&e!==zt&&e!==Bt&&e!==Wt&&e!==$t&&e!==Yt&&e!==Ue&&e!==rn&&e!==on&&e!==Zi&&e!==un&&e!==sn&&e!==ln&&e!==nn&&e!==en&&e!==tn&&e!==cn&&e!==fn}function Pn(e){return!ye(e)&&e!==ge}function ee(e,t){var r=e.charCodeAt(t),n;return r>=55296&&r<=56319&&t+1<e.length&&(n=e.charCodeAt(t+1),n>=56320&&n<=57343)?(r-55296)*1024+n-56320+65536:r}function Ht(e){var t=/^\n* /;return t.test(e)}var Ut=1,Ve=2,Gt=3,Vt=4,q=5;function bn(e,t,r,n,i,o,a,s){var l,p=0,u=null,d=!1,f=!1,c=n!==-1,h=-1,m=xn(ee(e,0))&&Pn(ee(e,e.length-1));if(t||a)for(l=0;l<e.length;p>=65536?l+=2:l++){if(p=ee(e,l),!ne(p))return q;m=m&&gt(p,u,s),u=p}else{for(l=0;l<e.length;p>=65536?l+=2:l++){if(p=ee(e,l),p===re)d=!0,c&&(f=f||l-h-1>n&&e[h+1]!==" ",h=l);else if(!ne(p))return q;m=m&&gt(p,u,s),u=p}f=f||c&&l-h-1>n&&e[h+1]!==" "}return!d&&!f?m&&!a&&!i(e)?Ut:o===ie?q:Ve:r>9&&Ht(e)?q:a?o===ie?q:Ve:f?Vt:Gt}function wn(e,t,r,n,i){e.dump=function(){if(t.length===0)return e.quotingType===ie?'""':"''";if(!e.noCompatMode&&(dn.indexOf(t)!==-1||hn.test(t)))return e.quotingType===ie?'"'+t+'"':"'"+t+"'";var o=e.indent*Math.max(1,r),a=e.lineWidth===-1?-1:Math.max(Math.min(e.lineWidth,40),e.lineWidth-o),s=n||e.flowLevel>-1&&r>=e.flowLevel;function l(p){return Cn(e,p)}switch(bn(t,s,e.indent,a,l,e.quotingType,e.forceQuotes&&!n,i)){case Ut:return t;case Ve:return"'"+t.replace(/'/g,"''")+"'";case Gt:return"|"+yt(t,e.indent)+vt(ht(t,o));case Vt:return">"+yt(t,e.indent)+vt(ht(An(t,a),o));case q:return'"'+Fn(t)+'"';default:throw new I("impossible error: invalid scalar style")}}()}function yt(e,t){var r=Ht(e)?String(t):"",n=e[e.length-1]===`
`,i=n&&(e[e.length-2]===`
`||e===`
`),o=i?"+":n?"":"-";return r+o+`
`}function vt(e){return e[e.length-1]===`
`?e.slice(0,-1):e}function An(e,t){for(var r=/(\n+)([^\n]*)/g,n=function(){var p=e.indexOf(`
`);return p=p!==-1?p:e.length,r.lastIndex=p,Ct(e.slice(0,p),t)}(),i=e[0]===`
`||e[0]===" ",o,a;a=r.exec(e);){var s=a[1],l=a[2];o=l[0]===" ",n+=s+(!i&&!o&&l!==""?`
`:"")+Ct(l,t),i=o}return n}function Ct(e,t){if(e===""||e[0]===" ")return e;for(var r=/ [^ ]/g,n,i=0,o,a=0,s=0,l="";n=r.exec(e);)s=n.index,s-i>t&&(o=a>i?a:s,l+=`
`+e.slice(i,o),i=o+1),a=s;return l+=`
`,e.length-i>t&&a>i?l+=e.slice(i,a)+`
`+e.slice(a+1):l+=e.slice(i),l.slice(1)}function Fn(e){for(var t="",r=0,n,i=0;i<e.length;r>=65536?i+=2:i++)r=ee(e,i),n=D[r],!n&&ne(r)?(t+=e[i],r>=65536&&(t+=e[i+1])):t+=n||gn(r);return t}function Tn(e,t,r){var n="",i=e.tag,o,a,s;for(o=0,a=r.length;o<a;o+=1)s=r[o],e.replacer&&(s=e.replacer.call(r,String(o),s)),(R(e,t,s,!1,!1)||typeof s=="undefined"&&R(e,t,null,!1,!1))&&(n!==""&&(n+=","+(e.condenseFlow?"":" ")),n+=e.dump);e.tag=i,e.dump="["+n+"]"}function xt(e,t,r,n){var i="",o=e.tag,a,s,l;for(a=0,s=r.length;a<s;a+=1)l=r[a],e.replacer&&(l=e.replacer.call(r,String(a),l)),(R(e,t+1,l,!0,!0,!1,!0)||typeof l=="undefined"&&R(e,t+1,null,!0,!0,!1,!0))&&((!n||i!=="")&&(i+=Ge(e,t)),e.dump&&re===e.dump.charCodeAt(0)?i+="-":i+="- ",i+=e.dump);e.tag=o,e.dump=i||"[]"}function Sn(e,t,r){var n="",i=e.tag,o=Object.keys(r),a,s,l,p,u;for(a=0,s=o.length;a<s;a+=1)u="",n!==""&&(u+=", "),e.condenseFlow&&(u+='"'),l=o[a],p=r[l],e.replacer&&(p=e.replacer.call(r,l,p)),R(e,t,l,!1,!1)&&(e.dump.length>1024&&(u+="? "),u+=e.dump+(e.condenseFlow?'"':"")+":"+(e.condenseFlow?"":" "),R(e,t,p,!1,!1)&&(u+=e.dump,n+=u));e.tag=i,e.dump="{"+n+"}"}function En(e,t,r,n){var i="",o=e.tag,a=Object.keys(r),s,l,p,u,d,f;if(e.sortKeys===!0)a.sort();else if(typeof e.sortKeys=="function")a.sort(e.sortKeys);else if(e.sortKeys)throw new I("sortKeys must be a boolean or a function");for(s=0,l=a.length;s<l;s+=1)f="",(!n||i!=="")&&(f+=Ge(e,t)),p=a[s],u=r[p],e.replacer&&(u=e.replacer.call(r,p,u)),R(e,t+1,p,!0,!0,!0)&&(d=e.tag!==null&&e.tag!=="?"||e.dump&&e.dump.length>1024,d&&(e.dump&&re===e.dump.charCodeAt(0)?f+="?":f+="? "),f+=e.dump,d&&(f+=Ge(e,t)),R(e,t+1,u,!0,d)&&(e.dump&&re===e.dump.charCodeAt(0)?f+=":":f+=": ",f+=e.dump,i+=f));e.tag=o,e.dump=i||"{}"}function Pt(e,t,r){var n,i,o,a,s,l;for(i=r?e.explicitTypes:e.implicitTypes,o=0,a=i.length;o<a;o+=1)if(s=i[o],(s.instanceOf||s.predicate)&&(!s.instanceOf||typeof t=="object"&&t instanceof s.instanceOf)&&(!s.predicate||s.predicate(t))){if(r?s.multi&&s.representName?e.tag=s.representName(t):e.tag=s.tag:e.tag="?",s.represent){if(l=e.styleMap[s.tag]||s.defaultStyle,_t.call(s.represent)==="[object Function]")n=s.represent(t,l);else if(Rt.call(s.represent,l))n=s.represent[l](t,l);else throw new I("!<"+s.tag+'> tag resolver accepts not "'+l+'" style');e.dump=n}return!0}return!1}function R(e,t,r,n,i,o,a){e.tag=null,e.dump=r,Pt(e,r,!1)||Pt(e,r,!0);var s=_t.call(e.dump),l=n,p;n&&(n=e.flowLevel<0||e.flowLevel>t);var u=s==="[object Object]"||s==="[object Array]",d,f;if(u&&(d=e.duplicates.indexOf(r),f=d!==-1),(e.tag!==null&&e.tag!=="?"||f||e.indent!==2&&t>0)&&(i=!1),f&&e.usedDuplicates[d])e.dump="*ref_"+d;else{if(u&&f&&!e.usedDuplicates[d]&&(e.usedDuplicates[d]=!0),s==="[object Object]")n&&Object.keys(e.dump).length!==0?(En(e,t,e.dump,i),f&&(e.dump="&ref_"+d+e.dump)):(Sn(e,t,e.dump),f&&(e.dump="&ref_"+d+" "+e.dump));else if(s==="[object Array]")n&&e.dump.length!==0?(e.noArrayIndent&&!a&&t>0?xt(e,t-1,e.dump,i):xt(e,t,e.dump,i),f&&(e.dump="&ref_"+d+e.dump)):(Tn(e,t,e.dump),f&&(e.dump="&ref_"+d+" "+e.dump));else if(s==="[object String]")e.tag!=="?"&&wn(e,e.dump,t,o,l);else{if(s==="[object Undefined]")return!1;if(e.skipInvalid)return!1;throw new I("unacceptable kind of an object to dump "+s)}e.tag!==null&&e.tag!=="?"&&(p=encodeURI(e.tag[0]==="!"?e.tag.slice(1):e.tag).replace(/!/g,"%21"),e.tag[0]==="!"?p="!"+p:p.slice(0,18)==="tag:yaml.org,2002:"?p="!!"+p.slice(18):p="!<"+p+">",e.dump=p+" "+e.dump)}return!0}function Dn(e,t){var r=[],n=[],i,o;for(qe(e,r,n),i=0,o=n.length;i<o;i+=1)t.duplicates.push(r[n[i]]);t.usedDuplicates=new Array(o)}function qe(e,t,r){var n,i,o;if(e!==null&&typeof e=="object")if(i=t.indexOf(e),i!==-1)r.indexOf(i)===-1&&r.push(i);else if(t.push(e),Array.isArray(e))for(i=0,o=e.length;i<o;i+=1)qe(e[i],t,r);else for(n=Object.keys(e),i=0,o=n.length;i<o;i+=1)qe(e[n[i]],t,r)}function Nn(e,t){t=t||{};var r=new vn(t);r.noRefs||Dn(e,r);var n=e;return r.replacer&&(n=r.replacer.call({"":n},"",n)),R(r,0,n,!0,!0)?r.dump+`
`:""}var On=Nn,In={dump:On};function Ze(e,t){return function(){throw new Error("Function yaml."+e+" is removed in js-yaml 4. Use yaml."+t+" instead, which is now safe by default.")}}var Ce=jt.load,Zn=jt.loadAll,eo=In.dump;var to=Ze("safeLoad","load"),ro=Ze("safeLoadAll","loadAll"),io=Ze("safeDump","dump");var xe=class{constructor(t){this.app=t}async findExampleFile(t){let r=this.app.vault.getAbstractFileByPath(t);if(!r)return null;if(r instanceof et.TFile&&r.extension==="md")return await this.parseFrontmatter(r);let n=this.getMarkdownFiles(r);for(let i of n){let o=await this.parseFrontmatter(i);if(o)return o}return null}getMarkdownFiles(t){let r=[];if(t.children)for(let n of t.children)n instanceof et.TFile&&n.extension==="md"?r.push(n):n.children&&r.push(...this.getMarkdownFiles(n));return r}async parseFrontmatter(t){try{let r=await this.app.vault.read(t),n=/^---\s*\n([\s\S]*?)\n---\s*\n/,i=r.match(n);if(!i)return null;let o=i[1],a=Ce(o);return!a||typeof a!="object"?null:{file:t.path,frontmatter:a,rawYaml:o}}catch(r){return null}}autoDetectDateProperty(t){let r=["date","pubDate","publishedDate","publishDate"];for(let n of r)if(t.hasOwnProperty(n))return n;return"date"}autoDetectDescriptionProperty(t){let r=["description","summary","excerpt","intro","snippet","blurb"];for(let n of r)if(t.hasOwnProperty(n))return n;return null}autoDetectTagsProperty(t){let r=["tags","tag","categories","category"];for(let n of r)if(t.hasOwnProperty(n))return n;return null}autoDetectDraftProperty(t){return t.hasOwnProperty("draft")?{property:"draft",logic:"true-draft"}:t.hasOwnProperty("published")?{property:"published",logic:"false-draft"}:null}autoDetectImageProperty(t){let r=["image","cover","coverImage","thumbnail","featuredImage"];for(let n of r)if(t.hasOwnProperty(n))return n;return null}};var Pe=class extends w{constructor(r,n,i,o,a,s){super(r,n,i,o,a,s);this.examples={};this.frontmatterAnalyzer=new xe(r)}async display(){let{containerEl:r}=this,n=r.querySelector(".frontmatter-step-content");n&&n.remove();let i=r.createDiv({cls:"frontmatter-step-content"});i.createEl("h2",{text:"Frontmatter Properties"}),i.createEl("p",{text:"Map frontmatter properties for each content type. We'll find example files to help you."});for(let o of this.state.contentTypes){if(!o.enabled)continue;let a=i.createDiv({cls:"content-type-settings"});if(!this.examples[o.id]){let y=await this.frontmatterAnalyzer.findExampleFile(o.folder);y&&(this.examples[o.id]=y)}let s=this.examples[o.id];if(a.createEl("h3",{text:o.name}),s){a.createEl("p",{text:`Example file: ${s.file}`}),a.createEl("pre",{text:s.rawYaml,cls:"frontmatter-example"});let y=this.frontmatterAnalyzer.autoDetectDateProperty(s.frontmatter),C=this.frontmatterAnalyzer.autoDetectDescriptionProperty(s.frontmatter)}if(!this.state.frontmatterProperties[o.id]){let y=s?this.frontmatterAnalyzer.autoDetectDraftProperty(s.frontmatter):null,C=s?this.frontmatterAnalyzer.autoDetectTagsProperty(s.frontmatter):null,P=s?this.frontmatterAnalyzer.autoDetectImageProperty(s.frontmatter):null,S=s?this.frontmatterAnalyzer.autoDetectDescriptionProperty(s.frontmatter):null;this.state.frontmatterProperties[o.id]={titleProperty:s?"title":"",dateProperty:s?this.frontmatterAnalyzer.autoDetectDateProperty(s.frontmatter):"",descriptionProperty:S||void 0,tagsProperty:C||void 0,draftProperty:y==null?void 0:y.property,draftLogic:(y==null?void 0:y.property)==="published"?"false-draft":y?"true-draft":void 0,imageProperty:P||void 0}}let l=this.state.frontmatterProperties[o.id];new T.Setting(a).setName("Title Property").setDesc("The frontmatter property that contains the title (e.g., title, name, heading). Leave blank to use file name instead.").addText(y=>{let C="title";y.setPlaceholder(C).setValue(l.titleProperty||"").onChange(P=>{l.titleProperty=P.trim()||void 0})}),new T.Setting(a).setName("Date Property").setDesc("The frontmatter property that contains the date (e.g., date, pubDate, publishedDate, publishDate). Leave blank to use file created date instead.").addText(y=>{let C=s?this.frontmatterAnalyzer.autoDetectDateProperty(s.frontmatter):"date";y.setPlaceholder(C).setValue(l.dateProperty||"").onChange(P=>{l.dateProperty=P.trim()||void 0})});let p=new T.Setting(a).setName("Has Description/Summary?").setDesc("Does this content type have a description or summary field?"),u=null;p.addToggle(y=>y.setValue(!!l.descriptionProperty).onChange(C=>{C&&!l.descriptionProperty?(l.descriptionProperty=s&&this.frontmatterAnalyzer.autoDetectDescriptionProperty(s.frontmatter)||"description",u||(u=new T.Setting(a).setName("Description Property").setDesc("The frontmatter property that contains the description (e.g., description, summary, excerpt, intro, snippet, blurb)").addText(P=>P.setValue(l.descriptionProperty||"").onChange(S=>{l.descriptionProperty=S.trim()||void 0})),u.settingEl.remove(),p.settingEl.insertAdjacentElement("afterend",u.settingEl))):C||(l.descriptionProperty=void 0,u&&(u.settingEl.remove(),u=null))})),l.descriptionProperty&&(u=new T.Setting(a).setName("Description Property").setDesc("The frontmatter property that contains the description (e.g., description, summary, excerpt, intro, snippet, blurb)").addText(y=>y.setValue(l.descriptionProperty||"").onChange(C=>{l.descriptionProperty=C.trim()||void 0})),u.settingEl.remove(),p.settingEl.insertAdjacentElement("afterend",u.settingEl));let d=new T.Setting(a).setName("Has Tags?").setDesc("Does this content type have tags?"),f=null;d.addToggle(y=>y.setValue(!!l.tagsProperty).onChange(C=>{if(C&&!l.tagsProperty){let P=s?this.frontmatterAnalyzer.autoDetectTagsProperty(s.frontmatter):null;l.tagsProperty=P||"tags",f||(f=new T.Setting(a).setName("Tags Property").setDesc("The frontmatter property that contains tags (e.g., tags, tag, categories, category). Leave blank if not applicable.").addText(S=>{let O=s?this.frontmatterAnalyzer.autoDetectTagsProperty(s.frontmatter):null;S.setPlaceholder(O||"tags").setValue(l.tagsProperty||"").onChange(_=>{l.tagsProperty=_.trim()||void 0})}),f.settingEl.remove(),d.settingEl.insertAdjacentElement("afterend",f.settingEl))}else C||(l.tagsProperty=void 0,f&&(f.settingEl.remove(),f=null))})),l.tagsProperty&&(f=new T.Setting(a).setName("Tags Property").setDesc("The frontmatter property that contains tags (e.g., tags, tag, categories, category). Leave blank if not applicable.").addText(y=>{let C=s?this.frontmatterAnalyzer.autoDetectTagsProperty(s.frontmatter):null;y.setPlaceholder(C||"tags").setValue(l.tagsProperty||"").onChange(P=>{l.tagsProperty=P.trim()||void 0})}),f.settingEl.remove(),d.settingEl.insertAdjacentElement("afterend",f.settingEl));let c=new T.Setting(a).setName("Has Draft Status?").setDesc("Does this content type have draft status?"),h=null,m=null;c.addToggle(y=>y.setValue(!!l.draftProperty).onChange(C=>{if(C&&!l.draftProperty){let P=s?this.frontmatterAnalyzer.autoDetectDraftProperty(s.frontmatter):null;l.draftProperty=(P==null?void 0:P.property)||"draft",(P==null?void 0:P.property)==="published"?l.draftLogic="false-draft":l.draftLogic="true-draft",h||(h=new T.Setting(a).setName("Draft Property").setDesc("The frontmatter property that contains draft status. Leave blank to use an underscore prefix instead.").addText(S=>{let O=s?this.frontmatterAnalyzer.autoDetectDraftProperty(s.frontmatter):null;S.setPlaceholder((O==null?void 0:O.property)||"draft").setValue(l.draftProperty||"").onChange(_=>{l.draftProperty=_.trim()||void 0,_==="published"?l.draftLogic="false-draft":_&&(l.draftLogic="true-draft"),_&&!m?(m=new T.Setting(a).setName("Draft Logic").setDesc("How draft status is represented").addDropdown(tr=>tr.addOption("true-draft","true = draft").addOption("false-draft","false = draft").setValue(l.draftLogic||"true-draft").onChange(rr=>{l.draftLogic=rr})),m.settingEl.remove(),h&&h.settingEl.insertAdjacentElement("afterend",m.settingEl)):!_&&m&&(m.settingEl.remove(),m=null)})}),h.settingEl.remove(),c.settingEl.insertAdjacentElement("afterend",h.settingEl)),l.draftProperty&&!m&&(m=new T.Setting(a).setName("Draft Logic").setDesc("How draft status is represented").addDropdown(S=>S.addOption("true-draft","true = draft").addOption("false-draft","false = draft").setValue(l.draftLogic||"true-draft").onChange(O=>{l.draftLogic=O})),m.settingEl.remove(),h&&h.settingEl.insertAdjacentElement("afterend",m.settingEl))}else C||(l.draftProperty=void 0,l.draftLogic=void 0,h&&(h.settingEl.remove(),h=null),m&&(m.settingEl.remove(),m=null))})),l.draftProperty&&(h=new T.Setting(a).setName("Draft Property").setDesc("The frontmatter property that contains draft status. Leave blank to use an underscore prefix instead.").addText(y=>{let C=s?this.frontmatterAnalyzer.autoDetectDraftProperty(s.frontmatter):null;y.setPlaceholder((C==null?void 0:C.property)||"draft").setValue(l.draftProperty||"").onChange(P=>{l.draftProperty=P.trim()||void 0,P==="published"?l.draftLogic="false-draft":P&&(l.draftLogic="true-draft"),P&&!m?(m=new T.Setting(a).setName("Draft Logic").setDesc("How draft status is represented").addDropdown(S=>S.addOption("true-draft","true = draft").addOption("false-draft","false = draft").setValue(l.draftLogic||"true-draft").onChange(O=>{l.draftLogic=O})),m.settingEl.remove(),h&&h.settingEl.insertAdjacentElement("afterend",m.settingEl)):!P&&m&&(m.settingEl.remove(),m=null)})}),h.settingEl.remove(),c.settingEl.insertAdjacentElement("afterend",h.settingEl),l.draftProperty&&(m=new T.Setting(a).setName("Draft Logic").setDesc("How draft status is represented").addDropdown(y=>y.addOption("true-draft","true = draft").addOption("false-draft","false = draft").setValue(l.draftLogic||"true-draft").onChange(C=>{l.draftLogic=C})),m.settingEl.remove(),h&&h.settingEl.insertAdjacentElement("afterend",m.settingEl)));let x=new T.Setting(a).setName("Has Image/Cover Property?").setDesc("Does this content type have an image or cover property? Used for Bases CMS cover images, Simple Banner, and Image Inserter."),b=null;if(x.addToggle(y=>y.setValue(!!l.imageProperty).onChange(C=>{if(C&&!l.imageProperty){let P=s?this.frontmatterAnalyzer.autoDetectImageProperty(s.frontmatter):null;l.imageProperty=P||"image",b||(b=new T.Setting(a).setName("Image Property").setDesc("The frontmatter property that contains the image/cover (e.g., image, cover, coverImage, thumbnail, featuredImage). Leave blank if not applicable.").addText(S=>{let O=s?this.frontmatterAnalyzer.autoDetectImageProperty(s.frontmatter):null;S.setPlaceholder(O||"image").setValue(l.imageProperty||"").onChange(_=>{l.imageProperty=_.trim()||void 0})}),b.settingEl.remove(),x.settingEl.insertAdjacentElement("afterend",b.settingEl))}else C||(l.imageProperty=void 0,b&&(b.settingEl.remove(),b=null))})),l.imageProperty&&(b=new T.Setting(a).setName("Image Property").setDesc("The frontmatter property that contains the image/cover (e.g., image, cover, coverImage, thumbnail, featuredImage). Leave blank if not applicable.").addText(y=>{let C=s?this.frontmatterAnalyzer.autoDetectImageProperty(s.frontmatter):null;y.setPlaceholder(C||"image").setValue(l.imageProperty||"").onChange(P=>{l.imageProperty=P.trim()||void 0})}),b.settingEl.remove(),x.settingEl.insertAdjacentElement("afterend",b.settingEl)),a.createEl("h4",{text:"Template"}),a.createEl("p",{text:"Edit the template that will be used when creating new files of this content type. Use {{title}} and {{date}} as placeholders."}),!l.template){let y=o.name==="Posts";l.template=this.generateDefaultTemplate(l,y,s)}let v=a.createEl("textarea",{cls:"template-editor",attr:{rows:"10",style:"width: 100%; font-family: monospace;"}});v.value=l.template||"",v.addEventListener("input",y=>{let C=y.target;l.template=C.value})}}generateDefaultTemplate(r,n,i){let o=`---
`;if(i&&i.rawYaml){let a=i.rawYaml.split(`
`),s=new Set,l=!1;for(let p of a){let u=p.trim();if(!u||u.startsWith("#"))continue;let d=u.indexOf(":");if(d>0){let f=u.substring(0,d).trim();if(f===r.titleProperty){o+=`${r.titleProperty}: "{{title}}"
`,l=!0,s.add(f);continue}}}l||(o+=`${r.titleProperty}: "{{title}}"
`);for(let p of a){let u=p.trim();if(!u||u.startsWith("#"))continue;let d=u.indexOf(":");if(d>0){let f=u.substring(0,d).trim();if(s.has(f)||f===r.titleProperty)continue;if(f===r.dateProperty&&n){o+=`${r.dateProperty}: {{date}}
`,s.add(f);continue}if(f===r.descriptionProperty){o+=`${r.descriptionProperty}: ""
`,s.add(f);continue}let c=i.frontmatter[f];c==null?o+=`${f}:
`:Array.isArray(c)?o+=`${f}: []
`:typeof c=="boolean"?o+=`${f}: ${c}
`:typeof c=="number"?o+=`${f}: ${c}
`:typeof c=="string"?/^\d{4}-\d{2}-\d{2}/.test(c)&&f.toLowerCase().includes("date")?o+=`${f}: {{date}}
`:o+=`${f}: ""
`:typeof c=="object"&&(Array.isArray(c)?o+=`${f}: []
`:o+=`${f}:
`),s.add(f)}}}else o+=`${r.titleProperty}: "{{title}}"
`,n&&r.dateProperty&&(o+=`${r.dateProperty}: {{date}}
`),r.descriptionProperty&&(o+=`${r.descriptionProperty}: ""
`),o+=`tags: []
`,o+=`draft: true
`;return o+=`---
`,o}validate(){for(let r of this.state.contentTypes)if(r.enabled){let n=this.state.frontmatterProperties[r.id];if(!n||!n.titleProperty||!n.dateProperty)return!1}return!0}getTitle(){return"Frontmatter Properties"}getDescription(){return"Map frontmatter properties"}};var Kt=require("obsidian");var be=class extends w{display(){let{containerEl:t}=this;t.empty(),t.createEl("h2",{text:"WYSIWYG Editing Toolbar"}),t.createEl("p",{text:"Do you want to use the WYSIWYG editing toolbar?"}),t.createEl("p",{text:"This enables a visual editing toolbar for formatting text. The toolbar can be toggled on/off via command."}),new Kt.Setting(t).setName("Enable WYSIWYG Toolbar").setDesc("Show the editing toolbar command in the page header").addToggle(r=>r.setValue(this.state.enableWYSIWYG).onChange(n=>{this.state.enableWYSIWYG=n}))}validate(){return!0}getTitle(){return"WYSIWYG Preference"}getDescription(){return"Configure editing toolbar preference"}};var we=class extends w{display(){let{containerEl:t}=this;t.empty(),t.createEl("h2",{text:"Bases CMS Configuration"}),t.createEl("p",{text:"Bases CMS views will be automatically created for each enabled content type using your mapped frontmatter properties."});let r=this.state.contentTypes.filter(i=>i.enabled);if(r.length===0){t.createEl("p",{text:"No content types enabled. Please go back and enable at least one content type."});return}t.createEl("h3",{text:"Views to be created:"});let n=t.createEl("ul");for(let i of r){let o=this.state.frontmatterProperties[i.id];o&&n.createEl("li",{text:`${i.name}: ${o.titleProperty}, ${o.dateProperty}${o.descriptionProperty?`, ${o.descriptionProperty}`:""}`})}t.createEl("p",{text:"You can customize these views later in the Bases CMS settings."})}validate(){return this.state.contentTypes.some(t=>t.enabled)}getTitle(){return"Bases CMS Configuration"}getDescription(){return"Configure Bases CMS views"}};var Ae=class extends w{display(){var i;let{containerEl:t}=this;t.empty(),t.createEl("h2",{text:"Astro Composer Configuration"}),t.createEl("p",{text:"Astro Composer will be configured with your content types and frontmatter properties."});let r=this.state.contentTypes.filter(o=>o.enabled);if(r.length===0){t.createEl("p",{text:"No content types enabled."});return}t.createEl("h3",{text:"Content types to configure:"});let n=t.createEl("ul");for(let o of r)if(this.state.frontmatterProperties[o.id]){let s=o.fileOrganization==="folder"?"folder-based":"file-based";n.createEl("li",{text:`${o.name} (${o.folder}): ${s}`})}(i=this.state.projectDetection)!=null&&i.configFilePath&&t.createEl("p",{text:`Config file: ${this.state.projectDetection.configFilePath}`})}validate(){return!0}getTitle(){return"Astro Composer Configuration"}getDescription(){return"Configure Astro Composer"}};var Jt=require("obsidian");var Fe=class extends w{display(){let{containerEl:t}=this;t.empty(),t.createEl("h2",{text:"SEO Plugin Configuration"}),t.createEl("p",{text:"SEO plugin will be configured using your mapped frontmatter properties."});let r=this.state.contentTypes.find(i=>i.enabled),n=r?this.state.frontmatterProperties[r.id]:void 0;if(n){t.createEl("h3",{text:"Configuration:"}),t.createEl("p",{text:`Title property: ${n.titleProperty}`}),n.descriptionProperty&&t.createEl("p",{text:`Description property: ${n.descriptionProperty}`});let i=this.state.contentTypes.filter(o=>o.enabled).map(o=>o.folder).join(", ");t.createEl("p",{text:`Scan directories: ${i}`})}new Jt.Setting(t).setName("Scan Directories").setDesc("Comma-separated list of directories to scan (you can customize this)").addText(i=>i.setValue(this.state.contentTypes.filter(o=>o.enabled).map(o=>o.folder).join(",")).onChange(o=>{this.state.seoConfig&&(this.state.seoConfig.scanDirectories=o)}))}validate(){return!0}getTitle(){return"SEO Configuration"}getDescription(){return"Configure SEO plugin"}};var Qt=require("obsidian");var X=class{constructor(t){this.app=t}async enablePlugin(t){let r=this.app.plugins;if(!r)return;let n=r.plugins[t];n&&!n.enabled&&await r.enablePlugin(t)}async disablePlugin(t){let r=this.app.plugins;if(!r)return;let n=r.plugins[t];n&&n.enabled&&await r.disablePlugin(t)}async setPluginStates(t,r){for(let n of r)await this.disablePlugin(n);for(let n of t)await this.enablePlugin(n)}getPresetPlugins(t){let r=["astro-composer","bases-cms","homepage","new-tab-default-page","seo","property-over-file-name","settings-search","statusbar-organizer","zenmode","cmdr","editing-toolbar","simple-focus","tag-wrangler"],n=["insert-unsplash-image","custom-save","title-only-tab","obsidian-paste-image-rename","obsidian42-brat","obsidian-hider","disable-tabs","obsidian-style-settings","mdx-as-md-obsidian"],i=["obsidian-oxygen","obsidian-style-settings"];return t==="vanilla"?{enabled:[...r,...n.filter(o=>!i.includes(o))],disabled:i}:t==="opinionated"?{enabled:[...r,...n],disabled:[]}:{enabled:[],disabled:[]}}};var Te=class extends w{constructor(r,n,i,o,a,s){super(r,n,i,o,a,s);this.pluginManager=new X(r)}display(){let{containerEl:r}=this;if(r.empty(),this.state.preset!=="custom"){r.createEl("h2",{text:"Plugin Configuration"}),r.createEl("p",{text:`Using ${this.state.preset} preset. Plugins will be configured automatically.`});return}r.createEl("h2",{text:"Optional Plugins"}),r.createEl("p",{text:"Select which plugins to enable:"});let n=[{id:"insert-unsplash-image",name:"Image Inserter"},{id:"title-only-tab",name:"Title Only Tab"},{id:"obsidian-paste-image-rename",name:"Paste Image Rename"},{id:"obsidian42-brat",name:"BRAT"},{id:"obsidian-style-settings",name:"Style Settings"},{id:"simple-banner",name:"Simple Banner"},{id:"alias-file-name-history",name:"Alias File Name History"},{id:"folder-notes",name:"Folder notes"},{id:"iconic",name:"Iconic"}];for(let i of n){let o=this.state.enabledPlugins.includes(i.id);new Qt.Setting(r).setName(i.name).setDesc(`Plugin ID: ${i.id}`).addToggle(a=>a.setValue(o).onChange(s=>{s?(this.state.enabledPlugins.includes(i.id)||this.state.enabledPlugins.push(i.id),this.state.disabledPlugins=this.state.disabledPlugins.filter(l=>l!==i.id)):(this.state.enabledPlugins=this.state.enabledPlugins.filter(l=>l!==i.id),this.state.disabledPlugins.includes(i.id)||this.state.disabledPlugins.push(i.id))}))}}validate(){return!0}getTitle(){return"Optional Plugins"}getDescription(){return"Configure optional plugins"}};var it=require("obsidian");var Se=require("obsidian");var Ee=class{constructor(t){this.app=t}async createOrUpdateBaseFile(t,r,n){let i="bases/Home.base";if(!this.app.vault.getAbstractFileByPath("bases"))try{await this.app.vault.createFolder("bases")}catch(f){(!f.message||!f.message.includes("already exists"))&&console.warn("BasesCMSConfig: Could not create bases folder:",f)}let a=this.app.vault.getAbstractFileByPath(i),s=null;if(a&&a instanceof Se.TFile)try{let f=await this.app.vault.read(a);s=Ce(f)}catch(f){console.error("BasesCMSConfig: Failed to parse existing base file:",f)}let l=t.filter(f=>f.enabled);console.log("BasesCMSConfig: Generating base content for",t.length,"content types"),console.log("BasesCMSConfig: Enabled content types:",l.map(f=>f.name));let p=this.generateBaseContent(t,r,n,s),u=p.match(/^\s*-\s+type:\s+bases-cms/gm),d=u?u.length:0;if(console.log("BasesCMSConfig: Generated",d,"views in base content"),a=this.app.vault.getAbstractFileByPath(i),a&&a instanceof Se.TFile){console.log("BasesCMSConfig: Modifying existing Home.base file");try{await this.app.vault.modify(a,p),console.log("BasesCMSConfig: Successfully modified Home.base file");return}catch(f){throw console.error("BasesCMSConfig: Failed to modify file:",f),f}}console.log("BasesCMSConfig: Creating new Home.base file");try{await this.app.vault.create(i,p),console.log("BasesCMSConfig: Successfully created Home.base file")}catch(f){if(f.message&&(f.message.includes("already exists")||f.message.includes("File already exists"))){console.log("BasesCMSConfig: File existed, attempting direct modify via path");try{let c=this.app.vault.adapter;if(c&&typeof c.write=="function")await c.write(i,p),console.log("BasesCMSConfig: Successfully wrote Home.base file via adapter");else{console.log("BasesCMSConfig: Adapter write not available, retrying getAbstractFileByPath");for(let h=0;h<10;h++){await new Promise(x=>setTimeout(x,200));let m=this.app.vault.getAbstractFileByPath(i);if(m&&m instanceof Se.TFile){await this.app.vault.modify(m,p),console.log(`BasesCMSConfig: Successfully modified Home.base file on retry ${h+1}`);return}}throw console.error("BasesCMSConfig: File exists but cannot be found after all retries"),new Error("File exists but cannot be accessed. Please try again or manually edit bases/Home.base")}}catch(c){throw console.error("BasesCMSConfig: Failed to write file via adapter:",c),c}}else throw console.error("BasesCMSConfig: Failed to create base file:",f),f}}generateBaseContent(t,r,n,i){var u,d,f;let o=[];if(i!=null&&i.formulas){o.push("formulas:");for(let[c,h]of Object.entries(i.formulas))if(typeof h=="string"){o.push(`  ${c}: |-`);let m=h.split(`
`);for(let x of m)o.push(`    ${x}`)}o.push("")}o.push("filters:"),o.push("  and:"),o.push('    - file.ext == "md"'),o.push("");let a=new Set;for(let c of t){let h=r[c.id];h&&(a.add(`note.${h.titleProperty}`),a.add(`note.${h.dateProperty}`),h.descriptionProperty&&a.add(`note.${h.descriptionProperty}`),h.tagsProperty&&a.add(`note.${h.tagsProperty}`),h.draftProperty&&a.add(`note.${h.draftProperty}`),h.imageProperty&&a.add(`note.${h.imageProperty}`))}if(a.add("note.title"),a.add("note.date"),a.add("note.pubDate"),a.add("note.draft"),a.add("file.name"),i!=null&&i.properties)for(let c of Object.keys(i.properties))c.startsWith("formula.")&&a.add(c);if(a.size>0){o.push("properties:");let c=(i==null?void 0:i.properties)||{};for(let h of Array.from(a).sort())if(o.push(`  ${h}:`),(u=c[h])!=null&&u.displayName)o.push(`    displayName: ${c[h].displayName}`);else{let m=h.replace("note.","").replace("file.","");o.push(`    displayName: ${this.capitalizeFirst(m)}`)}o.push("")}o.push("views:");let s=n?t.find(c=>c.id===n&&c.enabled):null,l=s?r[s.id]:r[Object.keys(r)[0]];if(s){let c=r[s.id];if(c){let h=(d=i==null?void 0:i.views)==null?void 0:d.find(m=>m.name===s.name);o.push("  - type: bases-cms"),o.push(`    name: ${s.name}`),o.push("    filters:"),o.push("      and:"),o.push(`        - file.folder.startsWith("${s.folder}")`),o.push("    imageFormat: cover"),c.titleProperty?o.push(`    titleProperty: note.${c.titleProperty}`):o.push("    titleProperty: file.name"),c.dateProperty?o.push(`    dateProperty: note.${c.dateProperty}`):o.push("    dateProperty: file.ctime"),c.descriptionProperty&&o.push(`    descriptionProperty: note.${c.descriptionProperty}`),c.imageProperty&&o.push(`    imageProperty: note.${c.imageProperty}`),o.push(`    showTags: ${c.tagsProperty?"true":"false"}`),c.tagsProperty&&o.push(`    tagsProperty: note.${c.tagsProperty}`),o.push("    showDate: true"),o.push(`    showDraftStatus: ${c.draftProperty?"true":"false"}`),c.draftProperty&&o.push(`    draftStatusProperty: note.${c.draftProperty}`),o.push("    customizeNewButton: true"),o.push(`    newNoteLocation: "${s.folder}"`),o.push("    fallbackToEmbeds: if-empty"),o.push("    propertyDisplay1: file.name"),o.push("    showTextPreview: true"),o.push("    propertyLabels: above"),o.push("    sort:"),c.dateProperty?o.push(`      - property: note.${c.dateProperty}`):o.push("      - property: file.ctime"),o.push("        direction: DESC")}}let p=(f=i==null?void 0:i.views)==null?void 0:f.find(c=>c.name==="All Content");if(l){if(o.push("  - type: bases-cms"),o.push("    name: All Content"),o.push("    filters:"),o.push("      and:"),o.push('        - file.ext == "md"'),p!=null&&p.groupBy&&(o.push("    groupBy:"),typeof p.groupBy=="object"&&p.groupBy.property&&(o.push(`      property: ${p.groupBy.property}`),o.push(`      direction: ${p.groupBy.direction||"ASC"}`))),p!=null&&p.order){o.push("    order:");for(let c of p.order)o.push(`      - ${c}`)}else o.push("    order:"),o.push("      - file.name");o.push("    sort:"),l.dateProperty?o.push(`      - property: note.${l.dateProperty}`):o.push("      - property: file.ctime"),o.push("        direction: DESC"),o.push(`    fallbackToEmbeds: ${(p==null?void 0:p.fallbackToEmbeds)||"if-empty"}`),o.push("    propertyDisplay1: file.name"),o.push(`    showTextPreview: ${(p==null?void 0:p.showTextPreview)!==!1?"true":"false"}`),o.push("    imageFormat: cover"),o.push("    showDate: true"),o.push(`    showDraftStatus: ${l.draftProperty||p!=null&&p.showDraftStatus?"true":"false"}`),o.push("    propertyLabels: above"),l.titleProperty?o.push(`    titleProperty: note.${l.titleProperty}`):o.push("    titleProperty: file.name"),l.dateProperty?o.push(`    dateProperty: note.${l.dateProperty}`):o.push("    dateProperty: file.ctime"),l.descriptionProperty&&o.push(`    descriptionProperty: note.${l.descriptionProperty}`),l.imageProperty&&o.push(`    imageProperty: note.${l.imageProperty}`),o.push(`    propertyLayout12SideBySide: ${p!=null&&p.propertyLayout12SideBySide?"true":"false"}`),o.push(`    propertyLayout34SideBySide: ${p!=null&&p.propertyLayout34SideBySide?"true":"false"}`),o.push(`    showTags: ${l.tagsProperty?"true":"false"}`),l.tagsProperty&&o.push(`    tagsProperty: note.${l.tagsProperty}`),l.draftProperty&&o.push(`    draftStatusProperty: note.${l.draftProperty}`),o.push("    customizeNewButton: true"),s?o.push(`    newNoteLocation: "${s.folder}"`):o.push('    newNoteLocation: ""'),o.push(`    cardSize: ${(p==null?void 0:p.cardSize)||250}`),o.push(`    imageAspectRatio: ${(p==null?void 0:p.imageAspectRatio)||.55}`),o.push(`    maxTagsToShow: ${(p==null?void 0:p.maxTagsToShow)||2}`),o.push(`    dateIncludeTime: ${p!=null&&p.dateIncludeTime?"true":"false"}`)}for(let c of t){if(!c.enabled||c.name==="All Content"||s&&c.id===s.id)continue;let h=r[c.id];h&&(o.push("  - type: bases-cms"),o.push(`    name: ${c.name}`),o.push("    filters:"),o.push("      and:"),o.push(`        - file.folder.startsWith("${c.folder}")`),o.push("    imageFormat: cover"),h.titleProperty?o.push(`    titleProperty: note.${h.titleProperty}`):o.push("    titleProperty: file.name"),h.dateProperty?o.push(`    dateProperty: note.${h.dateProperty}`):o.push("    dateProperty: file.ctime"),h.descriptionProperty&&o.push(`    descriptionProperty: note.${h.descriptionProperty}`),h.imageProperty&&o.push(`    imageProperty: note.${h.imageProperty}`),o.push(`    showTags: ${h.tagsProperty?"true":"false"}`),h.tagsProperty&&o.push(`    tagsProperty: note.${h.tagsProperty}`),o.push("    showDate: true"),o.push(`    showDraftStatus: ${h.draftProperty?"true":"false"}`),h.draftProperty&&o.push(`    draftStatusProperty: note.${h.draftProperty}`),o.push("    customizeNewButton: true"),o.push(`    newNoteLocation: "${c.folder}"`),o.push("    fallbackToEmbeds: if-empty"),o.push("    propertyDisplay1: file.name"),o.push("    showTextPreview: true"),o.push("    propertyLabels: above"),o.push("    sort:"),h.dateProperty?o.push(`      - property: note.${h.dateProperty}`):o.push("      - property: file.ctime"),o.push("        direction: DESC"))}return o.join(`
`)}capitalizeFirst(t){return t.charAt(0).toUpperCase()+t.slice(1)}};var tt=require("obsidian"),rt=U(require("path")),De=class{constructor(t){this.app=t}async configureAstroComposer(t,r,n,i){let o={customContentTypes:[],defaultTemplate:"",configFilePath:this.relativePath(i),terminalProjectRootPath:this.relativePath(n)},a=t.find(l=>l.name==="Posts"&&l.enabled),s=t.find(l=>l.name==="Pages"&&l.enabled);if(a){let l=r[a.id];o.postsFolder=a.folder,o.postsCreationMode=a.fileOrganization,o.postsIndexFileName=a.indexFileName||"index",o.defaultTemplate=(l==null?void 0:l.template)||this.generateTemplate(l,!0)}if(s){let l=r[s.id];o.enablePages=!0,o.pagesFolder=s.folder,o.pagesCreationMode=s.fileOrganization,o.pagesIndexFileName=s.indexFileName||"index",o.pageTemplate=(l==null?void 0:l.template)||this.generateTemplate(l,!1)}for(let l of t)if(l.name!=="Posts"&&l.name!=="Pages"&&l.enabled){let p=r[l.id];o.customContentTypes.push({id:l.id,name:l.name,folder:l.folder,template:(p==null?void 0:p.template)||this.generateTemplate(p,!0),enabled:!0,linkBasePath:`/${l.folder}/`,creationMode:l.fileOrganization,indexFileName:l.indexFileName||"index"})}return o}generateTemplate(t,r){if(t!=null&&t.template)return t.template;if(!t)return`---
title: "{{title}}"
---
`;let n=`---
`;return n+=`${t.titleProperty}: "{{title}}"
`,r&&(n+=`${t.dateProperty}: {{date}}
`),t.descriptionProperty&&(n+=`${t.descriptionProperty}: ""
`),n+=`tags: []
`,n+=`draft: true
`,n+=`---
`,n}getCreationModeFromAttachmentHandling(t){return t==="same-folder"?"folder":"file"}relativePath(t){let r=this.app.vault.adapter,n=r.basePath||r.path;if(!n)return t;let i=rt.normalize(n),o=rt.normalize(t);return o.startsWith(i)?o.slice(i.length+1):t}async saveConfig(t){var r;try{let n=this.app.plugins,i=(r=n==null?void 0:n.plugins)==null?void 0:r["astro-composer"];if(!i){console.warn("AstroComposerConfig: Astro Composer plugin not found, using fallback file method"),await this.saveConfigFallback(t);return}if(!i.settings){console.warn("AstroComposerConfig: Astro Composer plugin settings not available, using fallback file method"),await this.saveConfigFallback(t);return}let o=i.settings;t.defaultTemplate&&(o.defaultTemplate=t.defaultTemplate),t.pageTemplate&&(o.pageTemplate=t.pageTemplate),t.postsFolder&&(o.postsFolder=t.postsFolder),t.postsCreationMode&&(o.creationMode=t.postsCreationMode),t.postsIndexFileName&&(o.indexFileName=t.postsIndexFileName),t.enablePages!==void 0&&(o.enablePages=t.enablePages),t.pagesFolder&&(o.pagesFolder=t.pagesFolder),t.pagesCreationMode&&(o.pagesCreationMode=t.pagesCreationMode),t.pagesIndexFileName&&(o.pagesIndexFileName=t.pagesIndexFileName),t.configFilePath&&(o.configFilePath=t.configFilePath),t.terminalProjectRootPath&&(o.terminalProjectRootPath=t.terminalProjectRootPath),o.customContentTypes=this.mergeCustomContentTypes(o.customContentTypes||[],t.customContentTypes||[]),typeof i.saveSettings=="function"?(await i.saveSettings(),console.log("AstroComposerConfig: Successfully saved via plugin.saveSettings()")):(console.warn("AstroComposerConfig: Plugin saveSettings not available, using fallback"),await this.saveConfigFallback(t))}catch(n){console.error("Failed to save Astro Composer config via plugin method:",n),await this.saveConfigFallback(t)}}async saveConfigFallback(t){let r="astro-composer",n=`.obsidian/plugins/${r}/data.json`,i={},o=this.app.vault.getAbstractFileByPath(n);if(o&&o instanceof tt.TFile)try{i=JSON.parse(await this.app.vault.read(o))}catch(a){console.warn("Failed to parse existing Astro Composer data.json, starting fresh:",a),i={}}if(t.defaultTemplate&&(i.defaultTemplate=t.defaultTemplate),t.pageTemplate&&(i.pageTemplate=t.pageTemplate),t.postsFolder&&(i.postsFolder=t.postsFolder),t.postsCreationMode&&(i.creationMode=t.postsCreationMode),t.postsIndexFileName&&(i.indexFileName=t.postsIndexFileName),t.enablePages!==void 0&&(i.enablePages=t.enablePages),t.pagesFolder&&(i.pagesFolder=t.pagesFolder),t.pagesCreationMode&&(i.pagesCreationMode=t.pagesCreationMode),t.pagesIndexFileName&&(i.pagesIndexFileName=t.pagesIndexFileName),t.configFilePath&&(i.configFilePath=t.configFilePath),t.terminalProjectRootPath&&(i.terminalProjectRootPath=t.terminalProjectRootPath),i.customContentTypes=this.mergeCustomContentTypes(i.customContentTypes||[],t.customContentTypes||[]),o&&o instanceof tt.TFile)await this.app.vault.modify(o,JSON.stringify(i,null,2));else{let a=`.obsidian/plugins/${r}`;this.app.vault.getAbstractFileByPath(a)||await this.app.vault.createFolder(a),await this.app.vault.create(n,JSON.stringify(i,null,2))}}mergeCustomContentTypes(t,r){let n=[...t];for(let i of r){let o=n.findIndex(a=>a.id===i.id);o>=0?n[o]={...n[o],...i}:n.push(i)}return n}};var Ne=class{constructor(t){this.app=t}generateSEOConfig(t,r){let n=t.find(a=>a.enabled),i=n?r[n.id]:void 0;return{titleProperty:(i==null?void 0:i.titleProperty)||"title",descriptionProperty:i==null?void 0:i.descriptionProperty,scanDirectories:t.filter(a=>a.enabled).map(a=>a.folder).join(","),keywordProperty:"targetKeyword",useFilenameAsTitle:!1,useFilenameAsSlug:!0}}async saveConfig(t){let n=".obsidian/plugins/seo/data.json";try{let i=this.app.vault.getAbstractFileByPath(n);if(i){let a={...JSON.parse(await this.app.vault.read(i)),...t};await this.app.vault.modify(i,JSON.stringify(a,null,2))}}catch(i){console.error("Failed to save SEO config:",i)}}};var Oe=class{constructor(t){this.app=t}generateCommanderConfig(t){return{pageHeaderCommands:[]}}async toggleEditingToolbarCommand(t,r){var n;try{let i=t.plugins;if(!i){console.warn("Plugins API not available");return}let o=(n=i.plugins)==null?void 0:n["editing-toolbar"];if(!o){console.warn("Editing Toolbar plugin not found");return}r&&!o.enabled?await i.enablePlugin("editing-toolbar"):!r&&o.enabled&&await i.disablePlugin("editing-toolbar")}catch(i){console.error("Failed to toggle editing toolbar plugin:",i)}}async saveConfig(t){let n=".obsidian/plugins/cmdr/data.json";try{let i=this.app.vault.getAbstractFileByPath(n);if(i){let o=JSON.parse(await this.app.vault.read(i)),a=o.pageHeader||[],s={id:"editing-toolbar:hide-show-menu",icon:"lucide-chevrons-up-down",name:"Toggle editing toolbar",mode:"desktop"},l=a.filter(u=>u.id!=="editing-toolbar:hide-show-menu");t.pageHeaderCommands.length>0&&l.push(s);let p={...o,pageHeader:l};await this.app.vault.modify(i,JSON.stringify(p,null,2))}}catch(i){console.error("Failed to save Commander config:",i)}}};var Ie=class{constructor(t){this.app=t}async saveConfig(t){let n=".obsidian/plugins/property-over-file-name/data.json";try{let i=this.app.vault.getAbstractFileByPath(n);if(i){let a={...JSON.parse(await this.app.vault.read(i)),...t};await this.app.vault.modify(i,JSON.stringify(a,null,2))}}catch(i){console.error("Failed to save Property Over File Name config:",i)}}};var Le=class{constructor(t){this.app=t}async saveConfig(t,r){let i=".obsidian/plugins/insert-unsplash-image/data.json";try{let o={},a=this.app.vault.getAbstractFileByPath(i);a&&(o=JSON.parse(await this.app.vault.read(a)));let s={...o,...t};r&&(s.insertIntoProperty=r),a?await this.app.vault.modify(a,JSON.stringify(s,null,2)):await this.app.vault.create(i,JSON.stringify(s,null,2))}catch(o){console.error("Failed to save Image Inserter config:",o)}}};var Me=class{constructor(t){this.app=t}async saveConfig(t){let n=".obsidian/plugins/simple-banner/data.json";try{let i={},o=this.app.vault.getAbstractFileByPath(n);o&&(i=JSON.parse(await this.app.vault.read(o))),i.properties||(i.properties={}),i.properties.image=t,o?await this.app.vault.modify(o,JSON.stringify(i,null,2)):await this.app.vault.create(n,JSON.stringify(i,null,2))}catch(i){console.error("Failed to save Simple Banner config:",i)}}};var ke=class{constructor(t){this.app=t}async updateGuideFile(t){let r="_vault-cms-guide.md",n=this.app.vault.getAbstractFileByPath(r);if(n)try{await this.app.fileManager.processFrontMatter(n,i=>{if(t.titleProperty&&t.titleProperty!=="title"&&i.title!==void 0){let o=i.title;delete i.title,i[t.titleProperty]=o}if(t.dateProperty&&t.dateProperty!=="date"&&i.date!==void 0){let o=i.date;delete i.date,i[t.dateProperty]=o}})}catch(i){console.error("Failed to update guide file:",i)}}};var je=class extends w{constructor(r,n,i,o,a,s){super(r,n,i,o,a,s);this.applied=!1;this.pluginManager=new X(r),this.basesCMSConfigurator=new Ee(r),this.astroComposerConfigurator=new De(r),this.seoConfigurator=new Ne(r),this.commanderConfigurator=new Oe(r),this.propertyOverFileNameConfigurator=new Ie(r),this.imageInserterConfigurator=new Le(r),this.simpleBannerConfigurator=new Me(r),this.guideFileUpdater=new ke(r)}display(){let{containerEl:r}=this;r.empty(),r.createEl("h2",{text:"Finalize Configuration"}),r.createEl("p",{text:'Review your configuration and click "Apply" to save all settings:'});let n=r.createEl("div",{cls:"finalize-summary"});n.createEl("h3",{text:"Summary"}),n.createEl("p",{text:`Preset: ${this.state.preset}`}),n.createEl("p",{text:`Theme: ${this.state.theme||"Default"}`}),n.createEl("p",{text:`Content Types: ${this.state.contentTypes.filter(o=>o.enabled).length}`}),n.createEl("p",{text:`WYSIWYG Toolbar: ${this.state.enableWYSIWYG?"Enabled":"Disabled"}`}),r.createEl("button",{text:"Apply Configuration",cls:"mod-cta"}).addEventListener("click",async()=>{await this.applyConfiguration()})}async applyConfiguration(){if(!this.applied)try{if(console.log("FinalizeStep: Starting configuration application"),console.log("FinalizeStep: Enabled content types:",this.state.contentTypes.filter(s=>s.enabled).map(s=>s.name)),console.log("FinalizeStep: Configuring plugin states"),await this.pluginManager.setPluginStates(this.state.enabledPlugins,this.state.disabledPlugins),console.log("FinalizeStep: Configuring Bases CMS"),await this.basesCMSConfigurator.createOrUpdateBaseFile(this.state.contentTypes,this.state.frontmatterProperties,this.state.defaultContentTypeId),console.log("FinalizeStep: Bases CMS configuration complete"),this.state.projectDetection){let s=await this.astroComposerConfigurator.configureAstroComposer(this.state.contentTypes,this.state.frontmatterProperties,this.state.projectDetection.projectRoot,this.state.projectDetection.configFilePath);this.state.astroComposerConfig=s,await this.astroComposerConfigurator.saveConfig(s)}let r=this.seoConfigurator.generateSEOConfig(this.state.contentTypes,this.state.frontmatterProperties);this.state.seoConfig=r,await this.seoConfigurator.saveConfig(r),this.state.enableWYSIWYG&&await this.commanderConfigurator.toggleEditingToolbarCommand(this.app,!0);let n=this.commanderConfigurator.generateCommanderConfig(this.state.enableWYSIWYG);this.state.commanderConfig=n,await this.commanderConfigurator.saveConfig(n);let i=this.state.contentTypes.find(s=>s.enabled),o=i?this.state.frontmatterProperties[i.id]:void 0;o&&o.titleProperty&&(this.state.propertyOverFileName.propertyKey=o.titleProperty,await this.propertyOverFileNameConfigurator.saveConfig(this.state.propertyOverFileName)),o&&await this.guideFileUpdater.updateGuideFile(o);let a=o==null?void 0:o.imageProperty;if(a&&this.state.enabledPlugins.includes("simple-banner")&&await this.simpleBannerConfigurator.saveConfig(a),a&&this.state.enabledPlugins.includes("insert-unsplash-image")){let s={...this.state.imageInserter};if(this.state.attachmentHandlingMode==="same-folder")s.valueFormat="[[{image-url}]]",s.insertFormat="[[{image-url}]]";else{let l=this.state.attachmentFolderName||"attachments";s.valueFormat=`[[${l}/{image-url}]]`,s.insertFormat=`[[${l}/{image-url}]]`}await this.imageInserterConfigurator.saveConfig(s,a)}if(this.state.defaultContentTypeId){let s=this.state.contentTypes.find(l=>l.id===this.state.defaultContentTypeId);if(s){console.log("FinalizeStep: Configuring Obsidian settings for default content type:",s.name);let l=this.app,p="./";if(this.state.attachmentHandlingMode==="same-folder"?p="./":this.state.attachmentHandlingMode==="subfolder"?p=`./${this.state.attachmentFolderName||"attachments"}`:this.state.attachmentHandlingMode==="specified-folder"&&(p=this.state.attachmentFolderName||"attachments"),l.setting&&typeof l.setting.set=="function")console.log("FinalizeStep: Using app.setting API"),await l.setting.set("newFileLocation","folder"),await l.setting.set("newFileFolderPath",s.folder),await l.setting.set("attachmentFolderPath",p),await l.setting.set("newLinkFormat","relative"),typeof l.setting.save=="function"&&(await l.setting.save(),console.log("FinalizeStep: Obsidian settings saved via app.setting.save()"));else{console.log("FinalizeStep: Using vault.config API");let u=this.app.vault.config;u?(u.newFileLocation="folder",u.newFileFolderPath=s.folder,u.attachmentFolderPath=p,u.newLinkFormat="relative",typeof this.app.vault.saveConfig=="function"?(await this.app.vault.saveConfig(),console.log("FinalizeStep: Obsidian settings saved via vault.saveConfig()")):console.error("FinalizeStep: vault.saveConfig() is not available")):console.error("FinalizeStep: vault.config is not available")}}}this.applied=!0,new it.Notice("Configuration applied successfully!")}catch(r){console.error("Failed to apply configuration:",r),new it.Notice("Failed to apply configuration. Please check the console for details.")}}validate(){return!0}getTitle(){return"Finalize"}getDescription(){return"Review and apply configuration"}};var $=class extends Xt.Modal{constructor(r,n,i){var a,s,l,p,u,d,f,c,h,m,x,b,v,y,C,P,S,O;super(r);this.currentStepIndex=0;this.currentStepInstance=null;this.pluginInstance=i;let o=(n==null?void 0:n.projectDetection)||((a=i==null?void 0:i.settings)!=null&&a.projectRoot&&((s=i==null?void 0:i.settings)!=null&&s.configFilePath)?{projectRoot:i.settings.projectRoot,configFilePath:i.settings.configFilePath,vaultLocation:"content"}:void 0);this.state={currentStep:0,contentTypes:(n==null?void 0:n.contentTypes)||((l=i==null?void 0:i.settings)==null?void 0:l.contentTypes)||[],frontmatterProperties:(n==null?void 0:n.frontmatterProperties)||((p=i==null?void 0:i.settings)==null?void 0:p.frontmatterProperties)||{},projectDetection:o,defaultContentTypeId:(n==null?void 0:n.defaultContentTypeId)||((u=i==null?void 0:i.settings)==null?void 0:u.defaultContentTypeId),attachmentHandlingMode:(n==null?void 0:n.attachmentHandlingMode)||"subfolder",attachmentFolderName:n==null?void 0:n.attachmentFolderName,preset:(n==null?void 0:n.preset)||((d=i==null?void 0:i.settings)==null?void 0:d.preset)||"vanilla",enableWYSIWYG:(h=(c=n==null?void 0:n.enableWYSIWYG)!=null?c:(f=i==null?void 0:i.settings)==null?void 0:f.enableWYSIWYG)!=null?h:!1,enabledPlugins:(n==null?void 0:n.enabledPlugins)||((m=i==null?void 0:i.settings)==null?void 0:m.enabledPlugins)||[],disabledPlugins:(n==null?void 0:n.disabledPlugins)||((x=i==null?void 0:i.settings)==null?void 0:x.disabledPlugins)||[],theme:(n==null?void 0:n.theme)||((b=i==null?void 0:i.settings)==null?void 0:b.theme)||"",basesCMSConfig:(n==null?void 0:n.basesCMSConfig)||((v=i==null?void 0:i.settings)==null?void 0:v.basesCMSConfig)||{views:[]},astroComposerConfig:(n==null?void 0:n.astroComposerConfig)||((y=i==null?void 0:i.settings)==null?void 0:y.astroComposerConfig)||{customContentTypes:[],defaultTemplate:"",configFilePath:"",terminalProjectRootPath:""},seoConfig:(n==null?void 0:n.seoConfig)||((C=i==null?void 0:i.settings)==null?void 0:C.seoConfig)||{titleProperty:"title",scanDirectories:"",useFilenameAsTitle:!1,useFilenameAsSlug:!0},commanderConfig:(n==null?void 0:n.commanderConfig)||((P=i==null?void 0:i.settings)==null?void 0:P.commanderConfig)||{pageHeaderCommands:[]},propertyOverFileName:(n==null?void 0:n.propertyOverFileName)||((S=i==null?void 0:i.settings)==null?void 0:S.propertyOverFileName)||{propertyKey:"title"},imageInserter:(n==null?void 0:n.imageInserter)||((O=i==null?void 0:i.settings)==null?void 0:O.imageInserter)||{valueFormat:"[[attachments/{image-url}]]",insertFormat:"[[attachments/{image-url}]]"},...n},this.steps=[ae,pe,fe,ue,Pe,be,we,Ae,Fe,Te,je]}onOpen(){let{contentEl:r}=this;r.empty(),this.displayCurrentStep().catch(n=>{console.error("Error displaying wizard step:",n)})}onClose(){let{contentEl:r}=this;r.empty()}async displayCurrentStep(){let{contentEl:r}=this;if(r.empty(),this.currentStepIndex>=this.steps.length){this.close();return}let n=this.steps[this.currentStepIndex];this.currentStepInstance=new n(this.app,r,this.state,()=>this.nextStep(),()=>this.previousStep(),()=>this.close()),await this.currentStepInstance.display(),this.state.currentStep=this.currentStepIndex;let o=r.createDiv({cls:"wizard-footer"}).createDiv({cls:"wizard-buttons"});if(o.style.display="flex",o.style.gap="10px",this.currentStepIndex>0&&o.createEl("button",{text:"Previous",cls:"mod-button"}).addEventListener("click",async()=>{await this.previousStep()}),this.currentStepIndex<this.steps.length-1){o.createEl("button",{text:"Next",cls:"mod-button mod-cta"}).addEventListener("click",async()=>{this.currentStepInstance&&this.currentStepInstance.validate()&&(await this.saveCurrentStepState(),await this.nextStep())});let s=o.createEl("button",{text:"Skip",cls:"mod-button"});s.style.opacity="0.6",s.addEventListener("click",async()=>{await this.nextStep()})}else o.createEl("button",{text:"Complete Setup",cls:"mod-button mod-cta"}).addEventListener("click",async()=>{this.currentStepInstance&&this.currentStepInstance.validate()&&(await this.saveStateIfNeeded(),this.close())})}async nextStep(){this.currentStepIndex<this.steps.length-1?(this.currentStepIndex++,await this.displayCurrentStep()):(await this.saveStateIfNeeded(),this.close())}async saveCurrentStepState(){var r,n;try{this.saveCallback&&this.pluginInstance&&(this.pluginInstance.settings.projectRoot=((r=this.state.projectDetection)==null?void 0:r.projectRoot)||"",this.pluginInstance.settings.configFilePath=((n=this.state.projectDetection)==null?void 0:n.configFilePath)||"",this.pluginInstance.settings.contentTypes=this.state.contentTypes,this.pluginInstance.settings.frontmatterProperties=this.state.frontmatterProperties,this.pluginInstance.settings.defaultContentTypeId=this.state.defaultContentTypeId,this.pluginInstance.settings.preset=this.state.preset,this.pluginInstance.settings.enableWYSIWYG=this.state.enableWYSIWYG,this.pluginInstance.settings.enabledPlugins=this.state.enabledPlugins,this.pluginInstance.settings.disabledPlugins=this.state.disabledPlugins,this.pluginInstance.settings.theme=this.state.theme,this.pluginInstance.settings.basesCMSConfig=this.state.basesCMSConfig,this.pluginInstance.settings.astroComposerConfig=this.state.astroComposerConfig,this.pluginInstance.settings.seoConfig=this.state.seoConfig,this.pluginInstance.settings.commanderConfig=this.state.commanderConfig,this.pluginInstance.settings.propertyOverFileName=this.state.propertyOverFileName,this.pluginInstance.settings.imageInserter=this.state.imageInserter,await this.pluginInstance.saveSettings())}catch(i){console.error("Error saving current step state:",i)}}async previousStep(){this.currentStepIndex>0&&(this.currentStepIndex--,await this.displayCurrentStep())}getState(){return this.state}setSaveCallback(r){this.saveCallback=r}async saveStateIfNeeded(){this.saveCallback&&this.currentStepIndex===this.steps.length-1&&await this.saveCallback(this.state)}};var _e=class extends j.PluginSettingTab{constructor(r,n){super(r,n);this.plugin=n}display(){let{containerEl:r}=this;r.empty(),r.createEl("h2",{text:"Vault CMS Settings"}),new j.Setting(r).setName("Open Setup Wizard").setDesc("Launch the setup wizard to configure Vault CMS").addButton(n=>n.setButtonText("Open Wizard").setCta().onClick(()=>{new $(this.app,this.plugin.settings,this.plugin).open()})),new j.Setting(r).setName("Run Wizard on Startup").setDesc("Automatically open the wizard when the plugin loads (if not completed)").addToggle(n=>n.setValue(this.plugin.settings.runWizardOnStartup).onChange(async i=>{this.plugin.settings.runWizardOnStartup=i,await this.plugin.saveSettings()})),r.createEl("h3",{text:"Current Configuration"}),new j.Setting(r).setName("Preset").setDesc(`Current preset: ${this.plugin.settings.preset}`).addText(n=>n.setValue(this.plugin.settings.preset).setDisabled(!0)),new j.Setting(r).setName("Project Root").setDesc(this.plugin.settings.projectRoot||"Not configured").addText(n=>n.setValue(this.plugin.settings.projectRoot||"").setDisabled(!0)),new j.Setting(r).setName("Config File").setDesc(this.plugin.settings.configFilePath||"Not configured").addText(n=>n.setValue(this.plugin.settings.configFilePath||"").setDisabled(!0)),new j.Setting(r).setName("Content Types").setDesc(`${this.plugin.settings.contentTypes.length} content types configured`).addText(n=>n.setValue(`${this.plugin.settings.contentTypes.length}`).setDisabled(!0)),new j.Setting(r).setName("WYSIWYG Toolbar").setDesc(this.plugin.settings.enableWYSIWYG?"Enabled":"Disabled").addText(n=>n.setValue(this.plugin.settings.enableWYSIWYG?"Enabled":"Disabled").setDisabled(!0))}};function Zt(e){e.addCommand({id:"vault-cms-open-wizard",name:"Open Setup Wizard",callback:()=>{let t=new $(e.app,e.settings,e);t.setSaveCallback(async r=>{var n,i;e.settings.projectRoot=((n=r.projectDetection)==null?void 0:n.projectRoot)||"",e.settings.configFilePath=((i=r.projectDetection)==null?void 0:i.configFilePath)||"",e.settings.contentTypes=r.contentTypes,e.settings.frontmatterProperties=r.frontmatterProperties,e.settings.defaultContentTypeId=r.defaultContentTypeId,e.settings.preset=r.preset,e.settings.enableWYSIWYG=r.enableWYSIWYG,e.settings.enabledPlugins=r.enabledPlugins,e.settings.disabledPlugins=r.disabledPlugins,e.settings.theme=r.theme,e.settings.basesCMSConfig=r.basesCMSConfig,e.settings.astroComposerConfig=r.astroComposerConfig,e.settings.seoConfig=r.seoConfig,e.settings.commanderConfig=r.commanderConfig,e.settings.propertyOverFileName=r.propertyOverFileName,e.settings.imageInserter=r.imageInserter,e.settings.wizardCompleted=!0,await e.saveSettings()}),t.open()}})}var Re=class extends er.Plugin{async onload(){await this.loadSettings(),Zt(this),this.addSettingTab(new _e(this.app,this)),this.settings.runWizardOnStartup&&!this.settings.wizardCompleted&&this.app.workspace.onLayoutReady(()=>{this.startupTimeoutId=window.setTimeout(async()=>{if(await this.loadSettings(),this.settings.runWizardOnStartup&&!this.settings.wizardCompleted){let r=new $(this.app,this.settings,this);r.setSaveCallback(async n=>{var i,o;this.settings.projectRoot=((i=n.projectDetection)==null?void 0:i.projectRoot)||"",this.settings.configFilePath=((o=n.projectDetection)==null?void 0:o.configFilePath)||"",this.settings.contentTypes=n.contentTypes,this.settings.frontmatterProperties=n.frontmatterProperties,this.settings.defaultContentTypeId=n.defaultContentTypeId,this.settings.preset=n.preset,this.settings.enableWYSIWYG=n.enableWYSIWYG,this.settings.enabledPlugins=n.enabledPlugins,this.settings.disabledPlugins=n.disabledPlugins,this.settings.theme=n.theme,this.settings.basesCMSConfig=n.basesCMSConfig,this.settings.astroComposerConfig=n.astroComposerConfig,this.settings.seoConfig=n.seoConfig,this.settings.commanderConfig=n.commanderConfig,this.settings.propertyOverFileName=n.propertyOverFileName,this.settings.imageInserter=n.imageInserter,this.settings.wizardCompleted=!0,await this.saveSettings()}),r.open()}},2e3)})}onunload(){this.startupTimeoutId&&window.clearTimeout(this.startupTimeoutId)}async loadSettings(){this.settings=Object.assign({},ot,await this.loadData())}async saveSettings(){await this.saveData(this.settings)}};
/*! Bundled license information:

js-yaml/dist/js-yaml.mjs:
  (*! js-yaml 4.1.1 https://github.com/nodeca/js-yaml @license MIT *)
*/
