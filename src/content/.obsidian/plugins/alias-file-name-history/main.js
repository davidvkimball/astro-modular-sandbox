/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var __create = Object.create;
var __defProp = Object.defineProperty;
var __getOwnPropDesc = Object.getOwnPropertyDescriptor;
var __getOwnPropNames = Object.getOwnPropertyNames;
var __getProtoOf = Object.getPrototypeOf;
var __hasOwnProp = Object.prototype.hasOwnProperty;
var __export = (target, all) => {
  for (var name in all)
    __defProp(target, name, { get: all[name], enumerable: true });
};
var __copyProps = (to, from, except, desc) => {
  if (from && typeof from === "object" || typeof from === "function") {
    for (let key of __getOwnPropNames(from))
      if (!__hasOwnProp.call(to, key) && key !== except)
        __defProp(to, key, { get: () => from[key], enumerable: !(desc = __getOwnPropDesc(from, key)) || desc.enumerable });
  }
  return to;
};
var __toESM = (mod, isNodeMode, target) => (target = mod != null ? __create(__getProtoOf(mod)) : {}, __copyProps(
  // If the importer is in node compatibility mode or this is not an ESM
  // file that has been converted to a CommonJS file using a Babel-
  // compatible transform (i.e. "__esModule" has not been set), then set
  // "default" to the CommonJS "module.exports" for node compatibility.
  isNodeMode || !mod || !mod.__esModule ? __defProp(target, "default", { value: mod, enumerable: true }) : target,
  mod
));
var __toCommonJS = (mod) => __copyProps(__defProp({}, "__esModule", { value: true }), mod);

// src/main.ts
var main_exports = {};
__export(main_exports, {
  default: () => AliasFilenameHistoryPlugin
});
module.exports = __toCommonJS(main_exports);
var import_obsidian4 = require("obsidian");

// src/settings.ts
var DEFAULT_SETTINGS = {
  ignoreRegexes: ["^_", "^Untitled$", "^Untitled \\d+$"],
  timeoutSeconds: 5,
  caseSensitive: false,
  autoCreateFrontmatter: true,
  includeFolders: [],
  excludeFolders: [],
  fileExtensions: ["md"],
  trackFolderRenames: "",
  excludePropertyName: ""
};

// src/ui/settings-tab.ts
var import_obsidian2 = require("obsidian");

// src/utils/settings-compat.ts
var import_obsidian = require("obsidian");
var Obsidian = __toESM(require("obsidian"), 1);
function createSettingsGroup(containerEl, heading, manifestId) {
  if ((0, import_obsidian.requireApiVersion)("1.11.0")) {
    const ObsidianTyped = Obsidian;
    const SettingGroupCtor = ObsidianTyped.SettingGroup;
    const group = new SettingGroupCtor(containerEl);
    if (heading) {
      group.setHeading(heading);
    }
    return {
      addSetting(cb) {
        group.addSetting(cb);
      }
    };
  } else {
    if (manifestId) {
      containerEl.addClass(`${manifestId}-settings-compat`);
    }
    const groupEl = containerEl.createDiv("setting-group");
    if (heading) {
      const headingEl = groupEl.createDiv("setting-group-heading");
      headingEl.createEl("h3", { text: heading });
    }
    return {
      addSetting(cb) {
        const setting = new import_obsidian.Setting(groupEl);
        cb(setting);
      }
    };
  }
}

// src/ui/settings-tab.ts
var AliasFilenameHistorySettingTab = class extends import_obsidian2.PluginSettingTab {
  constructor(app, plugin) {
    super(app, plugin);
    this.plugin = plugin;
  }
  display() {
    const { containerEl } = this;
    containerEl.empty();
    const saveSettings = () => {
      void this.plugin.saveSettings();
    };
    const generalGroup = createSettingsGroup(containerEl, void 0, "alias-file-name-history");
    generalGroup.addSetting((setting) => {
      setting.setName("Timeout seconds").setDesc("Time in seconds the name must be stable before adding aliases.").addSlider(
        (slider) => slider.setLimits(1, 20, 1).setValue(this.plugin.settings.timeoutSeconds).setDynamicTooltip().onChange((value) => {
          this.plugin.settings.timeoutSeconds = value;
          saveSettings();
        })
      );
    });
    generalGroup.addSetting((setting) => {
      setting.setName("Case-sensitive uniqueness").setDesc("If enabled, treat note and Note as different aliases.").addToggle(
        (toggle) => toggle.setValue(this.plugin.settings.caseSensitive).onChange((value) => {
          this.plugin.settings.caseSensitive = value;
          saveSettings();
        })
      );
    });
    generalGroup.addSetting((setting) => {
      setting.setName("Auto-create properties").setDesc("Automatically create properties with aliases if missing.").addToggle(
        (toggle) => toggle.setValue(this.plugin.settings.autoCreateFrontmatter).onChange((value) => {
          this.plugin.settings.autoCreateFrontmatter = value;
          saveSettings();
        })
      );
    });
    generalGroup.addSetting((setting) => {
      setting.setName("File extensions").setDesc("Comma-separated list of file extensions to track.").addText(
        (text) => text.setPlaceholder("md, txt").setValue(this.plugin.settings.fileExtensions.join(",")).onChange((value) => {
          this.plugin.settings.fileExtensions = value.split(",").map((s) => s.trim()).filter((s) => s);
          saveSettings();
        })
      );
    });
    const filteringGroup = createSettingsGroup(containerEl, "Filtering", "alias-file-name-history");
    const foldersGroup = createSettingsGroup(containerEl, "Folders", "alias-file-name-history");
    const advancedGroup = createSettingsGroup(containerEl, "Advanced", "alias-file-name-history");
    filteringGroup.addSetting((setting) => {
      setting.setName("Ignore regex patterns").setDesc(
        "Comma-separated regex patterns for file names or immediate parent folder names to ignore (e.g., ^_ for underscore prefixes, ^untitled$ for untitled). Leave empty to disable."
      ).addText(
        (text) => text.setPlaceholder("^_, ^untitled$, ^untitled \\d+$").setValue(this.plugin.settings.ignoreRegexes.join(",")).onChange((value) => {
          this.plugin.settings.ignoreRegexes = value.split(",").map((s) => s.trim()).filter((s) => s);
          saveSettings();
        })
      );
    });
    filteringGroup.addSetting((setting) => {
      setting.setName("Exclude property name").setDesc(
        "Name of a boolean property to check in files. Files with this property set to true will be excluded from tracking. Takes priority over folder filtering."
      ).addText(
        (text) => text.setPlaceholder("skip-rename-tracking").setValue(this.plugin.settings.excludePropertyName).onChange((value) => {
          this.plugin.settings.excludePropertyName = value;
          saveSettings();
        })
      );
    });
    foldersGroup.addSetting((setting) => {
      setting.setName("Include folders").setDesc(
        "Comma-separated list of folder paths to include. If empty, all folders are included. Use {vault} or {root} to include only files directly in the vault root (no subfolders)."
      ).addText(
        (text) => text.setValue(this.plugin.settings.includeFolders.join(",")).onChange((value) => {
          this.plugin.settings.includeFolders = value.split(",").map((s) => s.trim()).filter((s) => s);
          saveSettings();
        })
      );
    });
    foldersGroup.addSetting((setting) => {
      setting.setName("Exclude folders").setDesc(
        'Comma-separated list of folder paths to exclude. Supports wildcards: use "folder/*" to exclude direct children, "folder/**" to exclude all descendants. Use {vault} or {root} to exclude files directly in the vault root.'
      ).addText(
        (text) => text.setValue(this.plugin.settings.excludeFolders.join(",")).onChange((value) => {
          this.plugin.settings.excludeFolders = value.split(",").map((s) => s.trim()).filter((s) => s);
          saveSettings();
        })
      );
    });
    advancedGroup.addSetting((setting) => {
      setting.setName("Track folder renames for specific file name").setDesc(
        // eslint-disable-next-line obsidianmd/ui/sentence-case
        "If a markdown file matches this file name, store old immediate parent folder names as aliases when parent folders are renamed."
      ).addText(
        (text) => text.setPlaceholder("index").setValue(this.plugin.settings.trackFolderRenames).onChange((value) => {
          this.plugin.settings.trackFolderRenames = value;
          saveSettings();
        })
      );
    });
  }
};

// src/utils/alias-processor.ts
var import_obsidian3 = require("obsidian");
var AliasProcessor = class {
  constructor(app, settings) {
    this.app = app;
    this.settings = settings;
  }
  async processAliasesManually(path, queue) {
    const file = this.app.vault.getFileByPath(path);
    if (!file) {
      return;
    }
    const regexes = [];
    for (const regexStr of this.settings.ignoreRegexes) {
      try {
        regexes.push(new RegExp(regexStr));
      } catch (e) {
        console.error(`Invalid ignore regex: ${regexStr}`, e);
      }
    }
    const toAdd = [];
    const currentBasename = file.basename;
    const currentBasenameLower = currentBasename.toLowerCase();
    for (const name of queue) {
      if (regexes.some((re) => re.test(name))) {
        continue;
      }
      const nameLower = name.toLowerCase();
      if (this.settings.caseSensitive && name === currentBasename || !this.settings.caseSensitive && nameLower === currentBasenameLower) {
        continue;
      }
      toAdd.push(name);
    }
    if (toAdd.length === 0) {
      return;
    }
    let content = await this.app.vault.read(file);
    const frontmatterRegex = /^---\n([\s\S]*?)\n---\n/;
    const match = content.match(frontmatterRegex);
    let frontmatter = {};
    let frontmatterText = "";
    let bodyContent = content;
    if (match) {
      frontmatterText = match[1];
      bodyContent = content.slice(match[0].length);
      try {
        const parsed = (0, import_obsidian3.parseYaml)(frontmatterText);
        frontmatter = parsed && typeof parsed === "object" ? parsed : {};
      } catch (e) {
        console.error(`Error parsing frontmatter:`, e);
        frontmatter = {};
      }
    } else {
      bodyContent = content;
    }
    let aliases = frontmatter.aliases;
    if (!Array.isArray(aliases)) {
      const hasFrontmatter = Object.keys(frontmatter).length > 0;
      if (hasFrontmatter && !this.settings.autoCreateFrontmatter) {
        return;
      }
      aliases = [];
    }
    const aliasesArray = aliases;
    const existing = new Set(
      this.settings.caseSensitive ? aliasesArray : aliasesArray.map((a) => a.toLowerCase())
    );
    let added = false;
    for (const name of toAdd) {
      const checkName = this.settings.caseSensitive ? name : name.toLowerCase();
      if (!existing.has(checkName)) {
        aliasesArray.push(name);
        existing.add(checkName);
        added = true;
      }
    }
    if (!added) {
      return;
    }
    frontmatter.aliases = aliasesArray;
    const newFrontmatterText = (0, import_obsidian3.stringifyYaml)(frontmatter).trim();
    const newContent = `---
${newFrontmatterText}
---
${bodyContent}`;
    await this.app.vault.modify(file, newContent);
  }
  async processAliases(path, queue) {
    const file = this.app.vault.getFileByPath(path);
    if (!file) return;
    const regexes = [];
    for (const regexStr of this.settings.ignoreRegexes) {
      try {
        regexes.push(new RegExp(regexStr));
      } catch (e) {
        console.error(`Invalid ignore regex: ${regexStr}`, e);
      }
    }
    const toAdd = [];
    const currentBasename = file.basename;
    const currentBasenameLower = currentBasename.toLowerCase();
    for (const name of queue) {
      if (regexes.some((re) => re.test(name))) {
        continue;
      }
      const nameLower = name.toLowerCase();
      if (this.settings.caseSensitive && name === currentBasename || !this.settings.caseSensitive && nameLower === currentBasenameLower) {
        continue;
      }
      toAdd.push(name);
    }
    if (toAdd.length === 0) {
      return;
    }
    if (file.extension !== "md") {
      await this.processAliasesManually(path, queue);
      return;
    }
    await this.app.fileManager.processFrontMatter(file, (fm) => {
      let aliases = fm.aliases;
      if (!Array.isArray(aliases)) {
        const hasFrontmatter = Object.keys(fm).length > 0;
        if (hasFrontmatter && !this.settings.autoCreateFrontmatter) {
          return;
        }
        aliases = [];
        fm.aliases = aliases;
      }
      const aliasesArray = aliases;
      const existing = new Set(
        this.settings.caseSensitive ? aliasesArray : aliasesArray.map((a) => a.toLowerCase())
      );
      for (const name of toAdd) {
        const checkName = this.settings.caseSensitive ? name : name.toLowerCase();
        if (!existing.has(checkName)) {
          aliasesArray.push(name);
          existing.add(checkName);
        }
      }
    });
  }
};

// src/utils/path-utils.ts
function getBasename(path) {
  const name = path.split("/").pop() || "";
  return name.replace(/\.[^/.]+$/, "");
}
function getImmediateParentName(path) {
  const parts = path.split("/");
  parts.pop();
  return parts.pop() || "";
}

// src/main.ts
var AliasFilenameHistoryPlugin = class extends import_obsidian4.Plugin {
  constructor() {
    super(...arguments);
    this.debounceMap = /* @__PURE__ */ new Map();
  }
  async onload() {
    await this.loadSettings();
    this.aliasProcessor = new AliasProcessor(this.app, this.settings);
    this.addSettingTab(new AliasFilenameHistorySettingTab(this.app, this));
    this.registerEvent(
      this.app.vault.on("rename", (file, oldPath) => {
        this.handleRename(file, oldPath);
      })
    );
  }
  onunload() {
    for (const entry of this.debounceMap.values()) {
      if (entry.timeoutId !== 0) {
        window.clearTimeout(entry.timeoutId);
      }
    }
    this.debounceMap.clear();
  }
  async loadSettings() {
    const loadedData = await this.loadData();
    this.settings = Object.assign({}, DEFAULT_SETTINGS, loadedData);
  }
  async saveSettings() {
    await this.saveData(this.settings);
  }
  isPathInFolder(path, folder) {
    if (folder.includes("{vault}") || folder.includes("{root}")) {
      const resolvedFolder = folder.replace(/\{vault\}|\{root\}/g, "");
      if (resolvedFolder === "" || resolvedFolder === "/") {
        const isVaultRoot = !path.includes("/");
        return isVaultRoot;
      }
      return path.startsWith(resolvedFolder + "/") || path === resolvedFolder;
    }
    return path.startsWith(folder + "/") || path === folder;
  }
  isPathExcluded(path, excludePattern) {
    if (excludePattern.includes("{vault}") || excludePattern.includes("{root}")) {
      const resolvedPattern = excludePattern.replace(/\{vault\}|\{root\}/g, "");
      if (resolvedPattern === "" || resolvedPattern === "/") {
        return !path.includes("/");
      }
      excludePattern = resolvedPattern;
    }
    if (excludePattern.endsWith("/**")) {
      const baseFolder = excludePattern.slice(0, -3);
      return path.startsWith(baseFolder + "/") || path === baseFolder;
    } else if (excludePattern.endsWith("/*")) {
      const baseFolder = excludePattern.slice(0, -2);
      if (!path.startsWith(baseFolder + "/")) {
        return path === baseFolder;
      }
      const pathAfterBase = path.slice(baseFolder.length + 1);
      return pathAfterBase.includes("/");
    }
    return path.startsWith(excludePattern + "/") || path === excludePattern;
  }
  handleRename(newFile, oldPath) {
    if (!(newFile instanceof import_obsidian4.TFile)) return;
    if (!this.settings.fileExtensions.includes(newFile.extension)) return;
    const oldBasename = getBasename(oldPath);
    const newBasename = newFile.basename;
    const oldImmediateParentName = getImmediateParentName(oldPath);
    const newImmediateParentName = getImmediateParentName(newFile.path);
    const isNameChange = this.settings.caseSensitive ? oldBasename !== newBasename : oldBasename.toLowerCase() !== newBasename.toLowerCase();
    const isFolderChange = oldImmediateParentName !== newImmediateParentName && !isNameChange;
    if (!isNameChange && !isFolderChange) {
      return;
    }
    const path = newFile.path;
    if (this.settings.excludePropertyName && this.settings.excludePropertyName.trim() !== "") {
      const cache = this.app.metadataCache.getFileCache(newFile);
      const frontmatter = cache == null ? void 0 : cache.frontmatter;
      if (frontmatter && frontmatter[this.settings.excludePropertyName] === true) {
        return;
      }
    }
    if (this.settings.includeFolders.length > 0) {
      if (!this.settings.includeFolders.some((f) => this.isPathInFolder(path, f))) {
        return;
      }
    }
    const isIndexFileForFolderRename = isFolderChange && this.settings.trackFolderRenames && this.settings.trackFolderRenames.trim() !== "" && (this.settings.caseSensitive ? newFile.basename === this.settings.trackFolderRenames : newFile.basename.toLowerCase() === this.settings.trackFolderRenames.toLowerCase());
    for (const excludePattern of this.settings.excludeFolders) {
      if (this.isPathExcluded(path, excludePattern)) {
        if (isIndexFileForFolderRename && excludePattern.endsWith("/*") && !excludePattern.endsWith("/**")) {
          const baseFolder = excludePattern.slice(0, -2);
          if (path.startsWith(baseFolder + "/")) {
            const pathAfterBase = path.slice(baseFolder.length + 1);
            const pathParts = pathAfterBase.split("/");
            if (pathParts.length === 2) {
              continue;
            }
          }
        }
        return;
      }
    }
    const regexes = [];
    for (const regexStr of this.settings.ignoreRegexes) {
      try {
        regexes.push(new RegExp(regexStr));
      } catch (e) {
        console.error(`Invalid ignore regex: ${regexStr}`, e);
      }
    }
    let toQueue = null;
    if (isNameChange) {
      if (regexes.some((re) => re.test(oldBasename) || re.test(newBasename))) {
        return;
      }
      toQueue = oldBasename;
    } else if (isFolderChange && this.settings.trackFolderRenames && this.settings.trackFolderRenames.trim() !== "") {
      const currentBasename = newFile.basename;
      const matchesFilename = this.settings.caseSensitive ? currentBasename === this.settings.trackFolderRenames : currentBasename.toLowerCase() === this.settings.trackFolderRenames.toLowerCase();
      if (!matchesFilename) {
        return;
      }
      if (oldImmediateParentName === "" || newImmediateParentName === "") {
        return;
      }
      if (regexes.some((re) => re.test(oldImmediateParentName) || re.test(newImmediateParentName))) {
        return;
      }
      toQueue = oldImmediateParentName;
    }
    if (!toQueue) return;
    let existingEntry = this.debounceMap.get(newFile.path);
    if (!existingEntry) {
      existingEntry = this.debounceMap.get(oldPath);
      if (existingEntry) {
        this.debounceMap.delete(oldPath);
      }
    }
    if (existingEntry) {
      if (existingEntry.timeoutId !== 0) {
        window.clearTimeout(existingEntry.timeoutId);
      }
      toQueue = Array.from(existingEntry.queue)[0];
    }
    const entry = {
      queue: /* @__PURE__ */ new Set([toQueue]),
      timeoutId: 0,
      currentPath: newFile.path
    };
    entry.timeoutId = window.setTimeout(() => {
      void (async () => {
        try {
          await this.aliasProcessor.processAliases(entry.currentPath, entry.queue);
        } catch (error) {
          console.error("Error processing aliases:", error);
        }
        this.debounceMap.delete(entry.currentPath);
      })();
    }, this.settings.timeoutSeconds * 1e3);
    this.debounceMap.set(newFile.path, entry);
  }
};
//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAic291cmNlcyI6IFsic3JjL21haW4udHMiLCAic3JjL3NldHRpbmdzLnRzIiwgInNyYy91aS9zZXR0aW5ncy10YWIudHMiLCAic3JjL3V0aWxzL3NldHRpbmdzLWNvbXBhdC50cyIsICJzcmMvdXRpbHMvYWxpYXMtcHJvY2Vzc29yLnRzIiwgInNyYy91dGlscy9wYXRoLXV0aWxzLnRzIl0sCiAgInNvdXJjZXNDb250ZW50IjogWyJpbXBvcnQgeyBQbHVnaW4sIFRBYnN0cmFjdEZpbGUsIFRGaWxlIH0gZnJvbSAnb2JzaWRpYW4nO1xuaW1wb3J0IHsgQWxpYXNGaWxlbmFtZUhpc3RvcnlTZXR0aW5ncywgREVGQVVMVF9TRVRUSU5HUyB9IGZyb20gJy4vc2V0dGluZ3MnO1xuaW1wb3J0IHsgQWxpYXNGaWxlbmFtZUhpc3RvcnlTZXR0aW5nVGFiIH0gZnJvbSAnLi91aS9zZXR0aW5ncy10YWInO1xuaW1wb3J0IHsgQWxpYXNQcm9jZXNzb3IgfSBmcm9tICcuL3V0aWxzL2FsaWFzLXByb2Nlc3Nvcic7XG5pbXBvcnQgeyBnZXRCYXNlbmFtZSwgZ2V0SW1tZWRpYXRlUGFyZW50TmFtZSB9IGZyb20gJy4vdXRpbHMvcGF0aC11dGlscyc7XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIEFsaWFzRmlsZW5hbWVIaXN0b3J5UGx1Z2luIGV4dGVuZHMgUGx1Z2luIHtcbiAgc2V0dGluZ3M6IEFsaWFzRmlsZW5hbWVIaXN0b3J5U2V0dGluZ3M7XG4gIHByaXZhdGUgZGVib3VuY2VNYXA6IE1hcDxzdHJpbmcsIHsgcXVldWU6IFNldDxzdHJpbmc+OyB0aW1lb3V0SWQ6IG51bWJlcjsgY3VycmVudFBhdGg6IHN0cmluZyB9PiA9IG5ldyBNYXAoKTtcbiAgcHJpdmF0ZSBhbGlhc1Byb2Nlc3NvcjogQWxpYXNQcm9jZXNzb3I7XG5cbiAgYXN5bmMgb25sb2FkKCkge1xuICAgIGF3YWl0IHRoaXMubG9hZFNldHRpbmdzKCk7XG4gICAgdGhpcy5hbGlhc1Byb2Nlc3NvciA9IG5ldyBBbGlhc1Byb2Nlc3Nvcih0aGlzLmFwcCwgdGhpcy5zZXR0aW5ncyk7XG4gICAgdGhpcy5hZGRTZXR0aW5nVGFiKG5ldyBBbGlhc0ZpbGVuYW1lSGlzdG9yeVNldHRpbmdUYWIodGhpcy5hcHAsIHRoaXMpKTtcbiAgICB0aGlzLnJlZ2lzdGVyRXZlbnQoXG4gICAgICB0aGlzLmFwcC52YXVsdC5vbigncmVuYW1lJywgKGZpbGU6IFRBYnN0cmFjdEZpbGUsIG9sZFBhdGg6IHN0cmluZykgPT4ge1xuICAgICAgICB0aGlzLmhhbmRsZVJlbmFtZShmaWxlLCBvbGRQYXRoKTtcbiAgICAgIH0pXG4gICAgKTtcbiAgfVxuXG4gIG9udW5sb2FkKCkge1xuICAgIC8vIENsZWFyIGFueSBwZW5kaW5nIHRpbWVvdXRzXG4gICAgZm9yIChjb25zdCBlbnRyeSBvZiB0aGlzLmRlYm91bmNlTWFwLnZhbHVlcygpKSB7XG4gICAgICBpZiAoZW50cnkudGltZW91dElkICE9PSAwKSB7XG4gICAgICAgIHdpbmRvdy5jbGVhclRpbWVvdXQoZW50cnkudGltZW91dElkKTtcbiAgICAgIH1cbiAgICB9XG4gICAgdGhpcy5kZWJvdW5jZU1hcC5jbGVhcigpO1xuICB9XG5cbiAgYXN5bmMgbG9hZFNldHRpbmdzKCkge1xuICAgIGNvbnN0IGxvYWRlZERhdGEgPSAoYXdhaXQgdGhpcy5sb2FkRGF0YSgpKSBhcyBQYXJ0aWFsPEFsaWFzRmlsZW5hbWVIaXN0b3J5U2V0dGluZ3M+IHwgbnVsbDtcbiAgICB0aGlzLnNldHRpbmdzID0gT2JqZWN0LmFzc2lnbih7fSwgREVGQVVMVF9TRVRUSU5HUywgbG9hZGVkRGF0YSk7XG4gIH1cblxuICBhc3luYyBzYXZlU2V0dGluZ3MoKSB7XG4gICAgYXdhaXQgdGhpcy5zYXZlRGF0YSh0aGlzLnNldHRpbmdzKTtcbiAgfVxuXG4gIHByaXZhdGUgaXNQYXRoSW5Gb2xkZXIocGF0aDogc3RyaW5nLCBmb2xkZXI6IHN0cmluZyk6IGJvb2xlYW4ge1xuICAgIC8vIEhhbmRsZSB2YXVsdCByb290IHZhcmlhYmxlXG4gICAgaWYgKGZvbGRlci5pbmNsdWRlcygne3ZhdWx0fScpIHx8IGZvbGRlci5pbmNsdWRlcygne3Jvb3R9JykpIHtcbiAgICAgIGNvbnN0IHJlc29sdmVkRm9sZGVyID0gZm9sZGVyLnJlcGxhY2UoL1xce3ZhdWx0XFx9fFxce3Jvb3RcXH0vZywgJycpO1xuICAgICAgLy8gSWYgdGhlIGZvbGRlciBpcyBqdXN0IHRoZSB2YXJpYWJsZSwgaXQgbWVhbnMgaW5jbHVkZSBvbmx5IHZhdWx0IHJvb3QgZmlsZXNcbiAgICAgIGlmIChyZXNvbHZlZEZvbGRlciA9PT0gJycgfHwgcmVzb2x2ZWRGb2xkZXIgPT09ICcvJykge1xuICAgICAgICAvLyBJbmNsdWRlIG9ubHkgZmlsZXMgZGlyZWN0bHkgaW4gdGhlIHZhdWx0IHJvb3QgKG5vIHN1YmZvbGRlcnMpXG4gICAgICAgIGNvbnN0IGlzVmF1bHRSb290ID0gIXBhdGguaW5jbHVkZXMoJy8nKTtcbiAgICAgICAgcmV0dXJuIGlzVmF1bHRSb290O1xuICAgICAgfVxuICAgICAgLy8gT3RoZXJ3aXNlLCByZXBsYWNlIHRoZSB2YXJpYWJsZSBhbmQgY2hlY2sgbm9ybWFsbHlcbiAgICAgIHJldHVybiBwYXRoLnN0YXJ0c1dpdGgocmVzb2x2ZWRGb2xkZXIgKyAnLycpIHx8IHBhdGggPT09IHJlc29sdmVkRm9sZGVyO1xuICAgIH1cbiAgICBcbiAgICAvLyBOb3JtYWwgZm9sZGVyIG1hdGNoaW5nXG4gICAgcmV0dXJuIHBhdGguc3RhcnRzV2l0aChmb2xkZXIgKyAnLycpIHx8IHBhdGggPT09IGZvbGRlcjtcbiAgfVxuXG4gIHByaXZhdGUgaXNQYXRoRXhjbHVkZWQocGF0aDogc3RyaW5nLCBleGNsdWRlUGF0dGVybjogc3RyaW5nKTogYm9vbGVhbiB7XG4gICAgLy8gSGFuZGxlIHZhdWx0IHJvb3QgdmFyaWFibGVcbiAgICBpZiAoZXhjbHVkZVBhdHRlcm4uaW5jbHVkZXMoJ3t2YXVsdH0nKSB8fCBleGNsdWRlUGF0dGVybi5pbmNsdWRlcygne3Jvb3R9JykpIHtcbiAgICAgIGNvbnN0IHJlc29sdmVkUGF0dGVybiA9IGV4Y2x1ZGVQYXR0ZXJuLnJlcGxhY2UoL1xce3ZhdWx0XFx9fFxce3Jvb3RcXH0vZywgJycpO1xuICAgICAgaWYgKHJlc29sdmVkUGF0dGVybiA9PT0gJycgfHwgcmVzb2x2ZWRQYXR0ZXJuID09PSAnLycpIHtcbiAgICAgICAgLy8gRXhjbHVkZSBvbmx5IGZpbGVzIGRpcmVjdGx5IGluIHRoZSB2YXVsdCByb290IChubyBzdWJmb2xkZXJzKVxuICAgICAgICByZXR1cm4gIXBhdGguaW5jbHVkZXMoJy8nKTtcbiAgICAgIH1cbiAgICAgIGV4Y2x1ZGVQYXR0ZXJuID0gcmVzb2x2ZWRQYXR0ZXJuO1xuICAgIH1cblxuICAgIC8vIEhhbmRsZSB3aWxkY2FyZHNcbiAgICBpZiAoZXhjbHVkZVBhdHRlcm4uZW5kc1dpdGgoJy8qKicpKSB7XG4gICAgICAvLyBSZWN1cnNpdmUgZXhjbHVzaW9uOiBkb2NzLyoqIG1hdGNoZXMgZG9jcyBhbmQgYWxsIHN1YmZvbGRlcnNcbiAgICAgIGNvbnN0IGJhc2VGb2xkZXIgPSBleGNsdWRlUGF0dGVybi5zbGljZSgwLCAtMyk7XG4gICAgICByZXR1cm4gcGF0aC5zdGFydHNXaXRoKGJhc2VGb2xkZXIgKyAnLycpIHx8IHBhdGggPT09IGJhc2VGb2xkZXI7XG4gICAgfSBlbHNlIGlmIChleGNsdWRlUGF0dGVybi5lbmRzV2l0aCgnLyonKSkge1xuICAgICAgLy8gRGlyZWN0IGNoaWxkcmVuIG9ubHk6IGRvY3MvKiBtYXRjaGVzIGRvY3Mvc3ViZm9sZGVyIGJ1dCBub3QgZG9jcy9zdWJmb2xkZXIvbmVzdGVkXG4gICAgICAvLyBTaG91bGQgZXhjbHVkZSBmaWxlcyBpbiBzdWJmb2xkZXJzLCBidXQgTk9UIGZpbGVzIGRpcmVjdGx5IGluIHRoZSBiYXNlIGZvbGRlclxuICAgICAgY29uc3QgYmFzZUZvbGRlciA9IGV4Y2x1ZGVQYXR0ZXJuLnNsaWNlKDAsIC0yKTtcbiAgICAgIGlmICghcGF0aC5zdGFydHNXaXRoKGJhc2VGb2xkZXIgKyAnLycpKSB7XG4gICAgICAgIHJldHVybiBwYXRoID09PSBiYXNlRm9sZGVyO1xuICAgICAgfVxuICAgICAgY29uc3QgcGF0aEFmdGVyQmFzZSA9IHBhdGguc2xpY2UoYmFzZUZvbGRlci5sZW5ndGggKyAxKTtcbiAgICAgIC8vIEV4Y2x1ZGUgaWYgcGF0aCBpcyBpbiBhIHN1YmZvbGRlciAoaGFzIGF0IGxlYXN0IG9uZSBzbGFzaClcbiAgICAgIC8vIERvbid0IGV4Y2x1ZGUgZmlsZXMgZGlyZWN0bHkgaW4gdGhlIGJhc2UgZm9sZGVyIChubyBzbGFzaClcbiAgICAgIHJldHVybiBwYXRoQWZ0ZXJCYXNlLmluY2x1ZGVzKCcvJyk7XG4gICAgfVxuICAgIFxuICAgIC8vIE5vcm1hbCBmb2xkZXIgbWF0Y2hpbmdcbiAgICByZXR1cm4gcGF0aC5zdGFydHNXaXRoKGV4Y2x1ZGVQYXR0ZXJuICsgJy8nKSB8fCBwYXRoID09PSBleGNsdWRlUGF0dGVybjtcbiAgfVxuXG4gIHByaXZhdGUgaGFuZGxlUmVuYW1lKG5ld0ZpbGU6IFRBYnN0cmFjdEZpbGUsIG9sZFBhdGg6IHN0cmluZykge1xuICAgIGlmICghKG5ld0ZpbGUgaW5zdGFuY2VvZiBURmlsZSkpIHJldHVybjtcbiAgICBpZiAoIXRoaXMuc2V0dGluZ3MuZmlsZUV4dGVuc2lvbnMuaW5jbHVkZXMobmV3RmlsZS5leHRlbnNpb24pKSByZXR1cm47XG5cbiAgICBjb25zdCBvbGRCYXNlbmFtZSA9IGdldEJhc2VuYW1lKG9sZFBhdGgpO1xuICAgIGNvbnN0IG5ld0Jhc2VuYW1lID0gbmV3RmlsZS5iYXNlbmFtZTtcbiAgICBjb25zdCBvbGRJbW1lZGlhdGVQYXJlbnROYW1lID0gZ2V0SW1tZWRpYXRlUGFyZW50TmFtZShvbGRQYXRoKTtcbiAgICBjb25zdCBuZXdJbW1lZGlhdGVQYXJlbnROYW1lID0gZ2V0SW1tZWRpYXRlUGFyZW50TmFtZShuZXdGaWxlLnBhdGgpO1xuXG4gICAgY29uc3QgaXNOYW1lQ2hhbmdlID0gdGhpcy5zZXR0aW5ncy5jYXNlU2Vuc2l0aXZlXG4gICAgICA/IG9sZEJhc2VuYW1lICE9PSBuZXdCYXNlbmFtZVxuICAgICAgOiBvbGRCYXNlbmFtZS50b0xvd2VyQ2FzZSgpICE9PSBuZXdCYXNlbmFtZS50b0xvd2VyQ2FzZSgpO1xuICAgIGNvbnN0IGlzRm9sZGVyQ2hhbmdlID0gb2xkSW1tZWRpYXRlUGFyZW50TmFtZSAhPT0gbmV3SW1tZWRpYXRlUGFyZW50TmFtZSAmJiAhaXNOYW1lQ2hhbmdlO1xuXG4gICAgaWYgKCFpc05hbWVDaGFuZ2UgJiYgIWlzRm9sZGVyQ2hhbmdlKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgY29uc3QgcGF0aCA9IG5ld0ZpbGUucGF0aDtcbiAgICBcbiAgICAvLyBBcHBseSBmaWx0ZXJpbmcgY2hlY2tzIHRvIGJvdGggZmlsZSBuYW1lIGNoYW5nZXMgYW5kIGZvbGRlciByZW5hbWVzXG4gICAgLy8gUHJpb3JpdHk6IFByb3BlcnR5IGV4Y2x1c2lvbiAtPiBJbmNsdWRlIGZvbGRlcnMgLT4gRXhjbHVkZSBmb2xkZXJzXG4gICAgXG4gICAgLy8gMS4gQ2hlY2sgcHJvcGVydHktYmFzZWQgZXhjbHVzaW9uIGZpcnN0IChoaWdoZXN0IHByaW9yaXR5KVxuICAgIGlmICh0aGlzLnNldHRpbmdzLmV4Y2x1ZGVQcm9wZXJ0eU5hbWUgJiYgdGhpcy5zZXR0aW5ncy5leGNsdWRlUHJvcGVydHlOYW1lLnRyaW0oKSAhPT0gJycpIHtcbiAgICAgIGNvbnN0IGNhY2hlID0gdGhpcy5hcHAubWV0YWRhdGFDYWNoZS5nZXRGaWxlQ2FjaGUobmV3RmlsZSk7XG4gICAgICBjb25zdCBmcm9udG1hdHRlciA9IGNhY2hlPy5mcm9udG1hdHRlcjtcbiAgICAgIGlmIChmcm9udG1hdHRlciAmJiBmcm9udG1hdHRlclt0aGlzLnNldHRpbmdzLmV4Y2x1ZGVQcm9wZXJ0eU5hbWVdID09PSB0cnVlKSB7XG4gICAgICAgIHJldHVybjsgLy8gRXhjbHVkZSB0aGlzIGZpbGVcbiAgICAgIH1cbiAgICB9XG4gICAgXG4gICAgLy8gMi4gQ2hlY2sgaW5jbHVkZSBmb2xkZXJzIChpZiBpbmNsdWRlRm9sZGVycyBpcyBub3QgZW1wdHksIG9ubHkgaW5jbHVkZSB0aG9zZSlcbiAgICBpZiAodGhpcy5zZXR0aW5ncy5pbmNsdWRlRm9sZGVycy5sZW5ndGggPiAwKSB7XG4gICAgICBpZiAoIXRoaXMuc2V0dGluZ3MuaW5jbHVkZUZvbGRlcnMuc29tZShmID0+IHRoaXMuaXNQYXRoSW5Gb2xkZXIocGF0aCwgZikpKSB7XG4gICAgICAgIHJldHVybjsgLy8gTm90IGluIGFueSBpbmNsdWRlZCBmb2xkZXJcbiAgICAgIH1cbiAgICB9XG4gICAgXG4gICAgLy8gMy4gQ2hlY2sgZXhjbHVkZSBmb2xkZXJzICh3aXRoIHdpbGRjYXJkIHN1cHBvcnQpXG4gICAgLy8gU3BlY2lhbCBjYXNlOiBpZiB0cmFja2luZyBmb2xkZXIgcmVuYW1lcyBmb3IgYSBzcGVjaWZpYyBmaWxlIG5hbWUsIGFsbG93IGl0IGV2ZW4gaW4gZXhjbHVkZWQgc3ViZm9sZGVyc1xuICAgIC8vIHVubGVzcyB1c2luZyByZWN1cnNpdmUgZXhjbHVzaW9uICgqKikgb3IgdGhlIGZpbGUgaXMgbmVzdGVkIGRlZXBlciB0aGFuIG9uZSBsZXZlbFxuICAgIGNvbnN0IGlzSW5kZXhGaWxlRm9yRm9sZGVyUmVuYW1lID0gaXNGb2xkZXJDaGFuZ2UgJiYgXG4gICAgICB0aGlzLnNldHRpbmdzLnRyYWNrRm9sZGVyUmVuYW1lcyAmJiBcbiAgICAgIHRoaXMuc2V0dGluZ3MudHJhY2tGb2xkZXJSZW5hbWVzLnRyaW0oKSAhPT0gJycgJiZcbiAgICAgICh0aGlzLnNldHRpbmdzLmNhc2VTZW5zaXRpdmUgXG4gICAgICAgID8gbmV3RmlsZS5iYXNlbmFtZSA9PT0gdGhpcy5zZXR0aW5ncy50cmFja0ZvbGRlclJlbmFtZXNcbiAgICAgICAgOiBuZXdGaWxlLmJhc2VuYW1lLnRvTG93ZXJDYXNlKCkgPT09IHRoaXMuc2V0dGluZ3MudHJhY2tGb2xkZXJSZW5hbWVzLnRvTG93ZXJDYXNlKCkpO1xuICAgIFxuICAgIGZvciAoY29uc3QgZXhjbHVkZVBhdHRlcm4gb2YgdGhpcy5zZXR0aW5ncy5leGNsdWRlRm9sZGVycykge1xuICAgICAgaWYgKHRoaXMuaXNQYXRoRXhjbHVkZWQocGF0aCwgZXhjbHVkZVBhdHRlcm4pKSB7XG4gICAgICAgIC8vIElmIHRoaXMgaXMgYW4gaW5kZXggZmlsZSBmb3IgZm9sZGVyIHJlbmFtZSB0cmFja2luZywgYW5kIHRoZSBwYXR0ZXJuIGlzIC8qIChub3QgLyoqKSxcbiAgICAgICAgLy8gYWxsb3cgaXQgdGhyb3VnaCBvbmx5IGlmIGl0J3MgaW4gYSBkaXJlY3QgY2hpbGQgZm9sZGVyIChvbmUgbGV2ZWwgZGVlcClcbiAgICAgICAgaWYgKGlzSW5kZXhGaWxlRm9yRm9sZGVyUmVuYW1lICYmIGV4Y2x1ZGVQYXR0ZXJuLmVuZHNXaXRoKCcvKicpICYmICFleGNsdWRlUGF0dGVybi5lbmRzV2l0aCgnLyoqJykpIHtcbiAgICAgICAgICAvLyBDaGVjayBpZiB0aGUgZmlsZSBpcyBpbiBhIGRpcmVjdCBjaGlsZCAob25seSBvbmUgbGV2ZWwgZGVlcClcbiAgICAgICAgICBjb25zdCBiYXNlRm9sZGVyID0gZXhjbHVkZVBhdHRlcm4uc2xpY2UoMCwgLTIpO1xuICAgICAgICAgIGlmIChwYXRoLnN0YXJ0c1dpdGgoYmFzZUZvbGRlciArICcvJykpIHtcbiAgICAgICAgICAgIGNvbnN0IHBhdGhBZnRlckJhc2UgPSBwYXRoLnNsaWNlKGJhc2VGb2xkZXIubGVuZ3RoICsgMSk7XG4gICAgICAgICAgICBjb25zdCBwYXRoUGFydHMgPSBwYXRoQWZ0ZXJCYXNlLnNwbGl0KCcvJyk7XG4gICAgICAgICAgICAvLyBJZiB0aGVyZSdzIG9ubHkgb25lIHBhdGggcGFydCBiZWZvcmUgdGhlIGZpbGVuYW1lLCBpdCdzIGEgZGlyZWN0IGNoaWxkXG4gICAgICAgICAgICAvLyBwYXRoUGFydHMgd2lsbCBiZSBsaWtlIFsnc3ViZm9sZGVyJywgJ2ZpbGVuYW1lLm1kJ10gLSB3ZSB3YW50IGV4YWN0bHkgMiBwYXJ0c1xuICAgICAgICAgICAgaWYgKHBhdGhQYXJ0cy5sZW5ndGggPT09IDIpIHtcbiAgICAgICAgICAgICAgY29udGludWU7IC8vIFNraXAgdGhpcyBleGNsdXNpb24gLSBpdCdzIGEgZGlyZWN0IGNoaWxkIGluZGV4IGZpbGVcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuOyAvLyBFeGNsdWRlZCBieSBmb2xkZXIgcGF0dGVyblxuICAgICAgfVxuICAgIH1cblxuICAgIC8vIENoZWNrIGlnbm9yZSByZWdleGVzXG4gICAgY29uc3QgcmVnZXhlczogUmVnRXhwW10gPSBbXTtcbiAgICBmb3IgKGNvbnN0IHJlZ2V4U3RyIG9mIHRoaXMuc2V0dGluZ3MuaWdub3JlUmVnZXhlcykge1xuICAgICAgdHJ5IHtcbiAgICAgICAgcmVnZXhlcy5wdXNoKG5ldyBSZWdFeHAocmVnZXhTdHIpKTtcbiAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihgSW52YWxpZCBpZ25vcmUgcmVnZXg6ICR7cmVnZXhTdHJ9YCwgZSk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgbGV0IHRvUXVldWU6IHN0cmluZyB8IG51bGwgPSBudWxsO1xuICAgIGlmIChpc05hbWVDaGFuZ2UpIHtcbiAgICAgIGlmIChyZWdleGVzLnNvbWUocmUgPT4gcmUudGVzdChvbGRCYXNlbmFtZSkgfHwgcmUudGVzdChuZXdCYXNlbmFtZSkpKSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIHRvUXVldWUgPSBvbGRCYXNlbmFtZTtcbiAgICB9IGVsc2UgaWYgKGlzRm9sZGVyQ2hhbmdlICYmIHRoaXMuc2V0dGluZ3MudHJhY2tGb2xkZXJSZW5hbWVzICYmIHRoaXMuc2V0dGluZ3MudHJhY2tGb2xkZXJSZW5hbWVzLnRyaW0oKSAhPT0gJycpIHtcbiAgICAgIC8vIENoZWNrIGlmIHRoZSBjdXJyZW50IGZpbGUgbmFtZSBtYXRjaGVzIHRoZSBzcGVjaWZpZWQgbmFtZSAod2l0aG91dCBleHRlbnNpb24pXG4gICAgICBjb25zdCBjdXJyZW50QmFzZW5hbWUgPSBuZXdGaWxlLmJhc2VuYW1lO1xuICAgICAgY29uc3QgbWF0Y2hlc0ZpbGVuYW1lID0gdGhpcy5zZXR0aW5ncy5jYXNlU2Vuc2l0aXZlIFxuICAgICAgICA/IGN1cnJlbnRCYXNlbmFtZSA9PT0gdGhpcy5zZXR0aW5ncy50cmFja0ZvbGRlclJlbmFtZXNcbiAgICAgICAgOiBjdXJyZW50QmFzZW5hbWUudG9Mb3dlckNhc2UoKSA9PT0gdGhpcy5zZXR0aW5ncy50cmFja0ZvbGRlclJlbmFtZXMudG9Mb3dlckNhc2UoKTtcbiAgICAgIFxuICAgICAgaWYgKCFtYXRjaGVzRmlsZW5hbWUpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgXG4gICAgICBpZiAob2xkSW1tZWRpYXRlUGFyZW50TmFtZSA9PT0gJycgfHwgbmV3SW1tZWRpYXRlUGFyZW50TmFtZSA9PT0gJycpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgaWYgKHJlZ2V4ZXMuc29tZShyZSA9PiByZS50ZXN0KG9sZEltbWVkaWF0ZVBhcmVudE5hbWUpIHx8IHJlLnRlc3QobmV3SW1tZWRpYXRlUGFyZW50TmFtZSkpKSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIHRvUXVldWUgPSBvbGRJbW1lZGlhdGVQYXJlbnROYW1lO1xuICAgIH1cblxuICAgIGlmICghdG9RdWV1ZSkgcmV0dXJuO1xuXG4gICAgLy8gQ2hlY2sgaWYgdGhlcmUncyBhbHJlYWR5IGEgcGVuZGluZyB0aW1lb3V0IGZvciB0aGlzIGZpbGVcbiAgICAvLyBXZSBuZWVkIHRvIGNoZWNrIGJvdGggdGhlIG5ldyBwYXRoIGFuZCB0aGUgb2xkIHBhdGggc2luY2UgdGhlIGZpbGUgd2FzIGp1c3QgcmVuYW1lZFxuICAgIGxldCBleGlzdGluZ0VudHJ5ID0gdGhpcy5kZWJvdW5jZU1hcC5nZXQobmV3RmlsZS5wYXRoKTtcbiAgICBpZiAoIWV4aXN0aW5nRW50cnkpIHtcbiAgICAgIC8vIENoZWNrIGlmIHRoZXJlJ3MgYSB0aW1lb3V0IGZvciB0aGUgb2xkIHBhdGggKHRoZSBmaWxlIHdhcyBqdXN0IHJlbmFtZWQgZnJvbSB0aGVyZSlcbiAgICAgIGV4aXN0aW5nRW50cnkgPSB0aGlzLmRlYm91bmNlTWFwLmdldChvbGRQYXRoKTtcbiAgICAgIGlmIChleGlzdGluZ0VudHJ5KSB7XG4gICAgICAgIC8vIFJlbW92ZSB0aGUgb2xkIGVudHJ5IHNpbmNlIHdlJ3JlIHVwZGF0aW5nIGl0IHdpdGggdGhlIG5ldyBwYXRoXG4gICAgICAgIHRoaXMuZGVib3VuY2VNYXAuZGVsZXRlKG9sZFBhdGgpO1xuICAgICAgfVxuICAgIH1cbiAgICBcbiAgICBpZiAoZXhpc3RpbmdFbnRyeSkge1xuICAgICAgLy8gRmlsZSB3YXMgcmVuYW1lZCBhZ2FpbiBiZWZvcmUgdGltZW91dCBleHBpcmVkIC0gY2FuY2VsIHRoZSBwcmV2aW91cyB0aW1lb3V0XG4gICAgICBpZiAoZXhpc3RpbmdFbnRyeS50aW1lb3V0SWQgIT09IDApIHtcbiAgICAgICAgd2luZG93LmNsZWFyVGltZW91dChleGlzdGluZ0VudHJ5LnRpbWVvdXRJZCk7XG4gICAgICB9XG4gICAgICBcbiAgICAgIC8vIFVzZSB0aGUgb3JpZ2luYWwgc3RhYmxlIG5hbWUgZnJvbSB0aGUgcHJldmlvdXMgdGltZW91dCwgbm90IHRoZSB0ZW1wb3JhcnkgbmFtZVxuICAgICAgdG9RdWV1ZSA9IEFycmF5LmZyb20oZXhpc3RpbmdFbnRyeS5xdWV1ZSlbMF07IC8vIFVzZSB0aGUgb3JpZ2luYWwgc3RhYmxlIG5hbWVcbiAgICB9XG5cbiAgICAvLyBDcmVhdGUgZW50cnkgdG8gdHJhY2sgdGhlIHRpbWVvdXRcbiAgICBjb25zdCBlbnRyeSA9IHsgXG4gICAgICBxdWV1ZTogbmV3IFNldDxzdHJpbmc+KFt0b1F1ZXVlXSksIFxuICAgICAgdGltZW91dElkOiAwLCBcbiAgICAgIGN1cnJlbnRQYXRoOiBuZXdGaWxlLnBhdGggXG4gICAgfTtcblxuICAgIC8vIFNldCB0aW1lb3V0IHRvIGFjdHVhbGx5IHN0b3JlIHRoZSBhbGlhcyBhZnRlciB0aGUgZGVib3VuY2UgcGVyaW9kXG4gICAgZW50cnkudGltZW91dElkID0gd2luZG93LnNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgdm9pZCAoYXN5bmMgKCkgPT4ge1xuICAgICAgICB0cnkge1xuICAgICAgICAgIGF3YWl0IHRoaXMuYWxpYXNQcm9jZXNzb3IucHJvY2Vzc0FsaWFzZXMoZW50cnkuY3VycmVudFBhdGgsIGVudHJ5LnF1ZXVlKTtcbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBwcm9jZXNzaW5nIGFsaWFzZXM6JywgZXJyb3IpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuZGVib3VuY2VNYXAuZGVsZXRlKGVudHJ5LmN1cnJlbnRQYXRoKTtcbiAgICAgIH0pKCk7XG4gICAgfSwgdGhpcy5zZXR0aW5ncy50aW1lb3V0U2Vjb25kcyAqIDEwMDApO1xuXG4gICAgdGhpcy5kZWJvdW5jZU1hcC5zZXQobmV3RmlsZS5wYXRoLCBlbnRyeSk7XG4gIH1cbn1cbiIsICJleHBvcnQgaW50ZXJmYWNlIEFsaWFzRmlsZW5hbWVIaXN0b3J5U2V0dGluZ3Mge1xyXG4gIGlnbm9yZVJlZ2V4ZXM6IHN0cmluZ1tdO1xyXG4gIHRpbWVvdXRTZWNvbmRzOiBudW1iZXI7XHJcbiAgY2FzZVNlbnNpdGl2ZTogYm9vbGVhbjtcclxuICBhdXRvQ3JlYXRlRnJvbnRtYXR0ZXI6IGJvb2xlYW47XHJcbiAgaW5jbHVkZUZvbGRlcnM6IHN0cmluZ1tdO1xyXG4gIGV4Y2x1ZGVGb2xkZXJzOiBzdHJpbmdbXTtcclxuICBmaWxlRXh0ZW5zaW9uczogc3RyaW5nW107XHJcbiAgdHJhY2tGb2xkZXJSZW5hbWVzOiBzdHJpbmc7XHJcbiAgZXhjbHVkZVByb3BlcnR5TmFtZTogc3RyaW5nO1xyXG59XHJcblxyXG5leHBvcnQgY29uc3QgREVGQVVMVF9TRVRUSU5HUzogQWxpYXNGaWxlbmFtZUhpc3RvcnlTZXR0aW5ncyA9IHtcclxuICBpZ25vcmVSZWdleGVzOiBbJ15fJywgJ15VbnRpdGxlZCQnLCAnXlVudGl0bGVkIFxcXFxkKyQnXSxcclxuICB0aW1lb3V0U2Vjb25kczogNSxcclxuICBjYXNlU2Vuc2l0aXZlOiBmYWxzZSxcclxuICBhdXRvQ3JlYXRlRnJvbnRtYXR0ZXI6IHRydWUsXHJcbiAgaW5jbHVkZUZvbGRlcnM6IFtdLFxyXG4gIGV4Y2x1ZGVGb2xkZXJzOiBbXSxcclxuICBmaWxlRXh0ZW5zaW9uczogWydtZCddLFxyXG4gIHRyYWNrRm9sZGVyUmVuYW1lczogJycsXHJcbiAgZXhjbHVkZVByb3BlcnR5TmFtZTogJycsXHJcbn07IiwgImltcG9ydCB7IEFwcCwgUGx1Z2luLCBQbHVnaW5TZXR0aW5nVGFiIH0gZnJvbSAnb2JzaWRpYW4nO1xyXG5pbXBvcnQgeyBBbGlhc0ZpbGVuYW1lSGlzdG9yeVNldHRpbmdzIH0gZnJvbSAnLi4vc2V0dGluZ3MnO1xyXG5pbXBvcnQgeyBjcmVhdGVTZXR0aW5nc0dyb3VwIH0gZnJvbSAnLi4vdXRpbHMvc2V0dGluZ3MtY29tcGF0JztcclxuXHJcbmludGVyZmFjZSBBbGlhc0ZpbGVuYW1lSGlzdG9yeVBsdWdpbiBleHRlbmRzIFBsdWdpbiB7XHJcbiAgc2V0dGluZ3M6IEFsaWFzRmlsZW5hbWVIaXN0b3J5U2V0dGluZ3M7XHJcbiAgc2F2ZVNldHRpbmdzKCk6IFByb21pc2U8dm9pZD47XHJcbn1cclxuXHJcbmV4cG9ydCBjbGFzcyBBbGlhc0ZpbGVuYW1lSGlzdG9yeVNldHRpbmdUYWIgZXh0ZW5kcyBQbHVnaW5TZXR0aW5nVGFiIHtcclxuICBwbHVnaW46IEFsaWFzRmlsZW5hbWVIaXN0b3J5UGx1Z2luO1xyXG5cclxuICBjb25zdHJ1Y3RvcihhcHA6IEFwcCwgcGx1Z2luOiBBbGlhc0ZpbGVuYW1lSGlzdG9yeVBsdWdpbikge1xyXG4gICAgc3VwZXIoYXBwLCBwbHVnaW4pO1xyXG4gICAgdGhpcy5wbHVnaW4gPSBwbHVnaW47XHJcbiAgfVxyXG5cclxuICBkaXNwbGF5KCk6IHZvaWQge1xyXG4gICAgY29uc3QgeyBjb250YWluZXJFbCB9ID0gdGhpcztcclxuICAgIGNvbnRhaW5lckVsLmVtcHR5KCk7XHJcblxyXG4gICAgLy8gSGVscGVyIHRvIHNhdmUgc2V0dGluZ3Mgd2l0aG91dCByZXR1cm5pbmcgYSBwcm9taXNlXHJcbiAgICBjb25zdCBzYXZlU2V0dGluZ3MgPSAoKTogdm9pZCA9PiB7XHJcbiAgICAgIHZvaWQgdGhpcy5wbHVnaW4uc2F2ZVNldHRpbmdzKCk7XHJcbiAgICB9O1xyXG5cclxuICAgIGNvbnN0IGdlbmVyYWxHcm91cCA9IGNyZWF0ZVNldHRpbmdzR3JvdXAoY29udGFpbmVyRWwsIHVuZGVmaW5lZCwgJ2FsaWFzLWZpbGUtbmFtZS1oaXN0b3J5Jyk7XHJcblxyXG4gICAgLy8gR2VuZXJhbCBiZWhhdmlvciBzZXR0aW5ncyAoZ3JvdXBlZCwgbm8gaGVhZGluZylcclxuICAgIGdlbmVyYWxHcm91cC5hZGRTZXR0aW5nKChzZXR0aW5nKSA9PiB7XHJcbiAgICAgIHNldHRpbmdcclxuICAgICAgICAuc2V0TmFtZSgnVGltZW91dCBzZWNvbmRzJylcclxuICAgICAgICAuc2V0RGVzYygnVGltZSBpbiBzZWNvbmRzIHRoZSBuYW1lIG11c3QgYmUgc3RhYmxlIGJlZm9yZSBhZGRpbmcgYWxpYXNlcy4nKVxyXG4gICAgICAgIC5hZGRTbGlkZXIoKHNsaWRlcikgPT5cclxuICAgICAgICAgIHNsaWRlclxyXG4gICAgICAgICAgICAuc2V0TGltaXRzKDEsIDIwLCAxKVxyXG4gICAgICAgICAgICAuc2V0VmFsdWUodGhpcy5wbHVnaW4uc2V0dGluZ3MudGltZW91dFNlY29uZHMpXHJcbiAgICAgICAgICAgIC5zZXREeW5hbWljVG9vbHRpcCgpXHJcbiAgICAgICAgICAgIC5vbkNoYW5nZSgodmFsdWUpID0+IHtcclxuICAgICAgICAgICAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy50aW1lb3V0U2Vjb25kcyA9IHZhbHVlO1xyXG4gICAgICAgICAgICAgIHNhdmVTZXR0aW5ncygpO1xyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBnZW5lcmFsR3JvdXAuYWRkU2V0dGluZygoc2V0dGluZykgPT4ge1xyXG4gICAgICBzZXR0aW5nXHJcbiAgICAgICAgLnNldE5hbWUoJ0Nhc2Utc2Vuc2l0aXZlIHVuaXF1ZW5lc3MnKVxyXG4gICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBvYnNpZGlhbm1kL3VpL3NlbnRlbmNlLWNhc2VcclxuICAgICAgICAuc2V0RGVzYygnSWYgZW5hYmxlZCwgdHJlYXQgbm90ZSBhbmQgTm90ZSBhcyBkaWZmZXJlbnQgYWxpYXNlcy4nKVxyXG4gICAgICAgIC5hZGRUb2dnbGUoKHRvZ2dsZSkgPT5cclxuICAgICAgICAgIHRvZ2dsZVxyXG4gICAgICAgICAgICAuc2V0VmFsdWUodGhpcy5wbHVnaW4uc2V0dGluZ3MuY2FzZVNlbnNpdGl2ZSlcclxuICAgICAgICAgICAgLm9uQ2hhbmdlKCh2YWx1ZSkgPT4ge1xyXG4gICAgICAgICAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLmNhc2VTZW5zaXRpdmUgPSB2YWx1ZTtcclxuICAgICAgICAgICAgICBzYXZlU2V0dGluZ3MoKTtcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICApO1xyXG4gICAgfSk7XHJcblxyXG4gICAgZ2VuZXJhbEdyb3VwLmFkZFNldHRpbmcoKHNldHRpbmcpID0+IHtcclxuICAgICAgc2V0dGluZ1xyXG4gICAgICAgIC5zZXROYW1lKCdBdXRvLWNyZWF0ZSBwcm9wZXJ0aWVzJylcclxuICAgICAgICAuc2V0RGVzYygnQXV0b21hdGljYWxseSBjcmVhdGUgcHJvcGVydGllcyB3aXRoIGFsaWFzZXMgaWYgbWlzc2luZy4nKVxyXG4gICAgICAgIC5hZGRUb2dnbGUoKHRvZ2dsZSkgPT5cclxuICAgICAgICAgIHRvZ2dsZVxyXG4gICAgICAgICAgICAuc2V0VmFsdWUodGhpcy5wbHVnaW4uc2V0dGluZ3MuYXV0b0NyZWF0ZUZyb250bWF0dGVyKVxyXG4gICAgICAgICAgICAub25DaGFuZ2UoKHZhbHVlKSA9PiB7XHJcbiAgICAgICAgICAgICAgdGhpcy5wbHVnaW4uc2V0dGluZ3MuYXV0b0NyZWF0ZUZyb250bWF0dGVyID0gdmFsdWU7XHJcbiAgICAgICAgICAgICAgc2F2ZVNldHRpbmdzKCk7XHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGdlbmVyYWxHcm91cC5hZGRTZXR0aW5nKChzZXR0aW5nKSA9PiB7XHJcbiAgICAgIHNldHRpbmdcclxuICAgICAgICAuc2V0TmFtZSgnRmlsZSBleHRlbnNpb25zJylcclxuICAgICAgICAuc2V0RGVzYygnQ29tbWEtc2VwYXJhdGVkIGxpc3Qgb2YgZmlsZSBleHRlbnNpb25zIHRvIHRyYWNrLicpXHJcbiAgICAgICAgLmFkZFRleHQoKHRleHQpID0+XHJcbiAgICAgICAgICB0ZXh0XHJcbiAgICAgICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBvYnNpZGlhbm1kL3VpL3NlbnRlbmNlLWNhc2VcclxuICAgICAgICAgICAgLnNldFBsYWNlaG9sZGVyKCdtZCwgdHh0JylcclxuICAgICAgICAgICAgLnNldFZhbHVlKHRoaXMucGx1Z2luLnNldHRpbmdzLmZpbGVFeHRlbnNpb25zLmpvaW4oJywnKSlcclxuICAgICAgICAgICAgLm9uQ2hhbmdlKCh2YWx1ZSkgPT4ge1xyXG4gICAgICAgICAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLmZpbGVFeHRlbnNpb25zID0gdmFsdWVcclxuICAgICAgICAgICAgICAgIC5zcGxpdCgnLCcpXHJcbiAgICAgICAgICAgICAgICAubWFwKChzKSA9PiBzLnRyaW0oKSlcclxuICAgICAgICAgICAgICAgIC5maWx0ZXIoKHMpID0+IHMpO1xyXG4gICAgICAgICAgICAgIHNhdmVTZXR0aW5ncygpO1xyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBjb25zdCBmaWx0ZXJpbmdHcm91cCA9IGNyZWF0ZVNldHRpbmdzR3JvdXAoY29udGFpbmVyRWwsICdGaWx0ZXJpbmcnLCAnYWxpYXMtZmlsZS1uYW1lLWhpc3RvcnknKTtcclxuICAgIGNvbnN0IGZvbGRlcnNHcm91cCA9IGNyZWF0ZVNldHRpbmdzR3JvdXAoY29udGFpbmVyRWwsICdGb2xkZXJzJywgJ2FsaWFzLWZpbGUtbmFtZS1oaXN0b3J5Jyk7XHJcbiAgICBjb25zdCBhZHZhbmNlZEdyb3VwID0gY3JlYXRlU2V0dGluZ3NHcm91cChjb250YWluZXJFbCwgJ0FkdmFuY2VkJywgJ2FsaWFzLWZpbGUtbmFtZS1oaXN0b3J5Jyk7XHJcblxyXG4gICAgLy8gRmlsdGVyaW5nIHNldHRpbmdzXHJcbiAgICBmaWx0ZXJpbmdHcm91cC5hZGRTZXR0aW5nKChzZXR0aW5nKSA9PiB7XHJcbiAgICAgIHNldHRpbmdcclxuICAgICAgICAuc2V0TmFtZSgnSWdub3JlIHJlZ2V4IHBhdHRlcm5zJylcclxuICAgICAgICAuc2V0RGVzYyhcclxuICAgICAgICAgICdDb21tYS1zZXBhcmF0ZWQgcmVnZXggcGF0dGVybnMgZm9yIGZpbGUgbmFtZXMgb3IgaW1tZWRpYXRlIHBhcmVudCBmb2xkZXIgbmFtZXMgdG8gaWdub3JlIChlLmcuLCBeXyBmb3IgdW5kZXJzY29yZSBwcmVmaXhlcywgXnVudGl0bGVkJCBmb3IgdW50aXRsZWQpLiBMZWF2ZSBlbXB0eSB0byBkaXNhYmxlLidcclxuICAgICAgICApXHJcbiAgICAgICAgLmFkZFRleHQoKHRleHQpID0+XHJcbiAgICAgICAgICB0ZXh0XHJcbiAgICAgICAgICAgIC5zZXRQbGFjZWhvbGRlcignXl8sIF51bnRpdGxlZCQsIF51bnRpdGxlZCBcXFxcZCskJylcclxuICAgICAgICAgICAgLnNldFZhbHVlKHRoaXMucGx1Z2luLnNldHRpbmdzLmlnbm9yZVJlZ2V4ZXMuam9pbignLCcpKVxyXG4gICAgICAgICAgICAub25DaGFuZ2UoKHZhbHVlKSA9PiB7XHJcbiAgICAgICAgICAgICAgdGhpcy5wbHVnaW4uc2V0dGluZ3MuaWdub3JlUmVnZXhlcyA9IHZhbHVlXHJcbiAgICAgICAgICAgICAgICAuc3BsaXQoJywnKVxyXG4gICAgICAgICAgICAgICAgLm1hcCgocykgPT4gcy50cmltKCkpXHJcbiAgICAgICAgICAgICAgICAuZmlsdGVyKChzKSA9PiBzKTtcclxuICAgICAgICAgICAgICBzYXZlU2V0dGluZ3MoKTtcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICApO1xyXG4gICAgfSk7XHJcblxyXG4gICAgZmlsdGVyaW5nR3JvdXAuYWRkU2V0dGluZygoc2V0dGluZykgPT4ge1xyXG4gICAgICBzZXR0aW5nXHJcbiAgICAgICAgLnNldE5hbWUoJ0V4Y2x1ZGUgcHJvcGVydHkgbmFtZScpXHJcbiAgICAgICAgLnNldERlc2MoXHJcbiAgICAgICAgICAnTmFtZSBvZiBhIGJvb2xlYW4gcHJvcGVydHkgdG8gY2hlY2sgaW4gZmlsZXMuIEZpbGVzIHdpdGggdGhpcyBwcm9wZXJ0eSBzZXQgdG8gdHJ1ZSB3aWxsIGJlIGV4Y2x1ZGVkIGZyb20gdHJhY2tpbmcuIFRha2VzIHByaW9yaXR5IG92ZXIgZm9sZGVyIGZpbHRlcmluZy4nXHJcbiAgICAgICAgKVxyXG4gICAgICAgIC5hZGRUZXh0KCh0ZXh0KSA9PlxyXG4gICAgICAgICAgdGV4dFxyXG4gICAgICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgb2JzaWRpYW5tZC91aS9zZW50ZW5jZS1jYXNlXHJcbiAgICAgICAgICAgIC5zZXRQbGFjZWhvbGRlcignc2tpcC1yZW5hbWUtdHJhY2tpbmcnKVxyXG4gICAgICAgICAgICAuc2V0VmFsdWUodGhpcy5wbHVnaW4uc2V0dGluZ3MuZXhjbHVkZVByb3BlcnR5TmFtZSlcclxuICAgICAgICAgICAgLm9uQ2hhbmdlKCh2YWx1ZSkgPT4ge1xyXG4gICAgICAgICAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLmV4Y2x1ZGVQcm9wZXJ0eU5hbWUgPSB2YWx1ZTtcclxuICAgICAgICAgICAgICBzYXZlU2V0dGluZ3MoKTtcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICApO1xyXG4gICAgfSk7XHJcblxyXG4gICAgLy8gRm9sZGVyIGluY2x1ZGUvZXhjbHVkZSBzZXR0aW5nc1xyXG4gICAgZm9sZGVyc0dyb3VwLmFkZFNldHRpbmcoKHNldHRpbmcpID0+IHtcclxuICAgICAgc2V0dGluZ1xyXG4gICAgICAgIC5zZXROYW1lKCdJbmNsdWRlIGZvbGRlcnMnKVxyXG4gICAgICAgIC5zZXREZXNjKFxyXG4gICAgICAgICAgJ0NvbW1hLXNlcGFyYXRlZCBsaXN0IG9mIGZvbGRlciBwYXRocyB0byBpbmNsdWRlLiBJZiBlbXB0eSwgYWxsIGZvbGRlcnMgYXJlIGluY2x1ZGVkLiBVc2Uge3ZhdWx0fSBvciB7cm9vdH0gdG8gaW5jbHVkZSBvbmx5IGZpbGVzIGRpcmVjdGx5IGluIHRoZSB2YXVsdCByb290IChubyBzdWJmb2xkZXJzKS4nXHJcbiAgICAgICAgKVxyXG4gICAgICAgIC5hZGRUZXh0KCh0ZXh0KSA9PlxyXG4gICAgICAgICAgdGV4dFxyXG4gICAgICAgICAgICAuc2V0VmFsdWUodGhpcy5wbHVnaW4uc2V0dGluZ3MuaW5jbHVkZUZvbGRlcnMuam9pbignLCcpKVxyXG4gICAgICAgICAgICAub25DaGFuZ2UoKHZhbHVlKSA9PiB7XHJcbiAgICAgICAgICAgICAgdGhpcy5wbHVnaW4uc2V0dGluZ3MuaW5jbHVkZUZvbGRlcnMgPSB2YWx1ZVxyXG4gICAgICAgICAgICAgICAgLnNwbGl0KCcsJylcclxuICAgICAgICAgICAgICAgIC5tYXAoKHMpID0+IHMudHJpbSgpKVxyXG4gICAgICAgICAgICAgICAgLmZpbHRlcigocykgPT4gcyk7XHJcbiAgICAgICAgICAgICAgc2F2ZVNldHRpbmdzKCk7XHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGZvbGRlcnNHcm91cC5hZGRTZXR0aW5nKChzZXR0aW5nKSA9PiB7XHJcbiAgICAgIHNldHRpbmdcclxuICAgICAgICAuc2V0TmFtZSgnRXhjbHVkZSBmb2xkZXJzJylcclxuICAgICAgICAuc2V0RGVzYyhcclxuICAgICAgICAgICdDb21tYS1zZXBhcmF0ZWQgbGlzdCBvZiBmb2xkZXIgcGF0aHMgdG8gZXhjbHVkZS4gU3VwcG9ydHMgd2lsZGNhcmRzOiB1c2UgXCJmb2xkZXIvKlwiIHRvIGV4Y2x1ZGUgZGlyZWN0IGNoaWxkcmVuLCBcImZvbGRlci8qKlwiIHRvIGV4Y2x1ZGUgYWxsIGRlc2NlbmRhbnRzLiBVc2Uge3ZhdWx0fSBvciB7cm9vdH0gdG8gZXhjbHVkZSBmaWxlcyBkaXJlY3RseSBpbiB0aGUgdmF1bHQgcm9vdC4nXHJcbiAgICAgICAgKVxyXG4gICAgICAgIC5hZGRUZXh0KCh0ZXh0KSA9PlxyXG4gICAgICAgICAgdGV4dFxyXG4gICAgICAgICAgICAuc2V0VmFsdWUodGhpcy5wbHVnaW4uc2V0dGluZ3MuZXhjbHVkZUZvbGRlcnMuam9pbignLCcpKVxyXG4gICAgICAgICAgICAub25DaGFuZ2UoKHZhbHVlKSA9PiB7XHJcbiAgICAgICAgICAgICAgdGhpcy5wbHVnaW4uc2V0dGluZ3MuZXhjbHVkZUZvbGRlcnMgPSB2YWx1ZVxyXG4gICAgICAgICAgICAgICAgLnNwbGl0KCcsJylcclxuICAgICAgICAgICAgICAgIC5tYXAoKHMpID0+IHMudHJpbSgpKVxyXG4gICAgICAgICAgICAgICAgLmZpbHRlcigocykgPT4gcyk7XHJcbiAgICAgICAgICAgICAgc2F2ZVNldHRpbmdzKCk7XHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgKTtcclxuICAgIH0pO1xyXG5cclxuICAgIC8vIEFkdmFuY2VkIC8gbmljaGUgb3B0aW9uc1xyXG4gICAgYWR2YW5jZWRHcm91cC5hZGRTZXR0aW5nKChzZXR0aW5nKSA9PiB7XHJcbiAgICAgIHNldHRpbmdcclxuICAgICAgICAuc2V0TmFtZSgnVHJhY2sgZm9sZGVyIHJlbmFtZXMgZm9yIHNwZWNpZmljIGZpbGUgbmFtZScpXHJcbiAgICAgICAgLnNldERlc2MoXHJcbiAgICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgb2JzaWRpYW5tZC91aS9zZW50ZW5jZS1jYXNlXHJcbiAgICAgICAgICAnSWYgYSBtYXJrZG93biBmaWxlIG1hdGNoZXMgdGhpcyBmaWxlIG5hbWUsIHN0b3JlIG9sZCBpbW1lZGlhdGUgcGFyZW50IGZvbGRlciBuYW1lcyBhcyBhbGlhc2VzIHdoZW4gcGFyZW50IGZvbGRlcnMgYXJlIHJlbmFtZWQuJ1xyXG4gICAgICAgIClcclxuICAgICAgICAuYWRkVGV4dCgodGV4dCkgPT5cclxuICAgICAgICAgIHRleHRcclxuICAgICAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG9ic2lkaWFubWQvdWkvc2VudGVuY2UtY2FzZVxyXG4gICAgICAgICAgICAuc2V0UGxhY2Vob2xkZXIoJ2luZGV4JylcclxuICAgICAgICAgICAgLnNldFZhbHVlKHRoaXMucGx1Z2luLnNldHRpbmdzLnRyYWNrRm9sZGVyUmVuYW1lcylcclxuICAgICAgICAgICAgLm9uQ2hhbmdlKCh2YWx1ZSkgPT4ge1xyXG4gICAgICAgICAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLnRyYWNrRm9sZGVyUmVuYW1lcyA9IHZhbHVlO1xyXG4gICAgICAgICAgICAgIHNhdmVTZXR0aW5ncygpO1xyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICk7XHJcbiAgICB9KTtcclxuXHJcbiAgfVxyXG59XHJcbiIsICIvKipcclxuICogQ29tcGF0aWJpbGl0eSB1dGlsaXRpZXMgZm9yIHNldHRpbmdzXHJcbiAqIFByb3ZpZGVzIGJhY2t3YXJkIGNvbXBhdGliaWxpdHkgZm9yIFNldHRpbmdHcm91cCAocmVxdWlyZXMgQVBJIDEuMTEuMCspXHJcbiAqL1xyXG5pbXBvcnQgeyBTZXR0aW5nLCByZXF1aXJlQXBpVmVyc2lvbiB9IGZyb20gJ29ic2lkaWFuJztcclxuaW1wb3J0ICogYXMgT2JzaWRpYW4gZnJvbSAnb2JzaWRpYW4nO1xyXG5cclxuaW50ZXJmYWNlIFNldHRpbmdHcm91cEluc3RhbmNlIHtcclxuICBzZXRIZWFkaW5nKGhlYWRpbmc6IHN0cmluZyk6IHZvaWQ7XHJcbiAgYWRkU2V0dGluZyhjYjogKHNldHRpbmc6IFNldHRpbmcpID0+IHZvaWQpOiB2b2lkO1xyXG59XHJcblxyXG4vKipcclxuICogSW50ZXJmYWNlIHRoYXQgd29ya3Mgd2l0aCBib3RoIFNldHRpbmdHcm91cCBhbmQgZmFsbGJhY2sgY29udGFpbmVyXHJcbiAqL1xyXG5leHBvcnQgaW50ZXJmYWNlIFNldHRpbmdzQ29udGFpbmVyIHtcclxuICBhZGRTZXR0aW5nKGNiOiAoc2V0dGluZzogU2V0dGluZykgPT4gdm9pZCk6IHZvaWQ7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBDcmVhdGVzIGEgc2V0dGluZ3MgY29udGFpbmVyIHRoYXQgdXNlcyBTZXR0aW5nR3JvdXAgaWYgYXZhaWxhYmxlIChBUEkgMS4xMS4wKyksXHJcbiAqIG90aGVyd2lzZSBmYWxscyBiYWNrIHRvIGNyZWF0aW5nIGEgaGVhZGluZyBhbmQgdXNpbmcgdGhlIGNvbnRhaW5lciBkaXJlY3RseS5cclxuICpcclxuICogVXNlcyByZXF1aXJlQXBpVmVyc2lvbignMS4xMS4wJykgdG8gY2hlY2sgaWYgU2V0dGluZ0dyb3VwIGlzIGF2YWlsYWJsZS5cclxuICogVGhpcyBpcyB0aGUgb2ZmaWNpYWwgT2JzaWRpYW4gQVBJIG1ldGhvZCBmb3IgdmVyc2lvbiBjaGVja2luZy5cclxuICpcclxuICogQHBhcmFtIGNvbnRhaW5lckVsIC0gVGhlIGNvbnRhaW5lciBlbGVtZW50IGZvciBzZXR0aW5nc1xyXG4gKiBAcGFyYW0gaGVhZGluZyAtIFRoZSBoZWFkaW5nIHRleHQgZm9yIHRoZSBzZXR0aW5ncyBncm91cFxyXG4gKiBAcGFyYW0gbWFuaWZlc3RJZCAtIFRoZSBwbHVnaW4ncyBtYW5pZmVzdCBJRCBmb3IgQ1NTIHNjb3BpbmcgKHJlcXVpcmVkIGZvciBmYWxsYmFjayBtb2RlKVxyXG4gKiBAcmV0dXJucyBBIGNvbnRhaW5lciB0aGF0IGNhbiBiZSB1c2VkIHRvIGFkZCBzZXR0aW5nc1xyXG4gKi9cclxuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZVNldHRpbmdzR3JvdXAoXHJcbiAgY29udGFpbmVyRWw6IEhUTUxFbGVtZW50LFxyXG4gIGhlYWRpbmc/OiBzdHJpbmcsXHJcbiAgbWFuaWZlc3RJZD86IHN0cmluZ1xyXG4pOiBTZXR0aW5nc0NvbnRhaW5lciB7XHJcbiAgLy8gQ2hlY2sgaWYgU2V0dGluZ0dyb3VwIGlzIGF2YWlsYWJsZSAoQVBJIDEuMTEuMCspXHJcbiAgLy8gcmVxdWlyZUFwaVZlcnNpb24gaXMgdGhlIG9mZmljaWFsIE9ic2lkaWFuIEFQSSBtZXRob2QgZm9yIHZlcnNpb24gY2hlY2tpbmdcclxuICBpZiAocmVxdWlyZUFwaVZlcnNpb24oJzEuMTEuMCcpKSB7XHJcbiAgICAvLyBVc2UgU2V0dGluZ0dyb3VwIC0gaXQncyBndWFyYW50ZWVkIHRvIGV4aXN0IGF0IHJ1bnRpbWUgaWYgcmVxdWlyZUFwaVZlcnNpb24gcmV0dXJucyB0cnVlLlxyXG4gICAgLy8gV2UgYWNjZXNzIGl0IHZpYSB0aGUgbmFtZXNwYWNlIGltcG9ydCB0byBhdm9pZCByZXF1aXJpbmcgdGhlIHR5cGUgaW4gb2xkZXIgQVBJIGQudHMgZmlsZXMuXHJcbiAgICB0eXBlIE9ic2lkaWFuV2l0aFNldHRpbmdHcm91cCA9IHR5cGVvZiBPYnNpZGlhbiAmIHtcclxuICAgICAgU2V0dGluZ0dyb3VwOiBuZXcgKGNvbnRhaW5lckVsOiBIVE1MRWxlbWVudCkgPT4gU2V0dGluZ0dyb3VwSW5zdGFuY2U7XHJcbiAgICB9O1xyXG4gICAgY29uc3QgT2JzaWRpYW5UeXBlZCA9IE9ic2lkaWFuIGFzIHVua25vd24gYXMgT2JzaWRpYW5XaXRoU2V0dGluZ0dyb3VwO1xyXG4gICAgY29uc3QgU2V0dGluZ0dyb3VwQ3RvciA9IE9ic2lkaWFuVHlwZWQuU2V0dGluZ0dyb3VwO1xyXG4gICAgY29uc3QgZ3JvdXAgPSBuZXcgU2V0dGluZ0dyb3VwQ3Rvcihjb250YWluZXJFbCk7XHJcbiAgICBpZiAoaGVhZGluZykge1xyXG4gICAgICBncm91cC5zZXRIZWFkaW5nKGhlYWRpbmcpO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIHtcclxuICAgICAgYWRkU2V0dGluZyhjYjogKHNldHRpbmc6IFNldHRpbmcpID0+IHZvaWQpIHtcclxuICAgICAgICBncm91cC5hZGRTZXR0aW5nKGNiKTtcclxuICAgICAgfSxcclxuICAgIH07XHJcbiAgfSBlbHNlIHtcclxuICAgIC8vIEZhbGxiYWNrIHBhdGggKGVpdGhlciBBUEkgPCAxLjExLjAgb3IgU2V0dGluZ0dyb3VwIG5vdCBmb3VuZClcclxuICAgIC8vIEFkZCBzY29waW5nIGNsYXNzIHRvIGNvbnRhaW5lckVsIHRvIHNjb3BlIENTUyB0byBvbmx5IHRoaXMgcGx1Z2luJ3Mgc2V0dGluZ3NcclxuICAgIGlmIChtYW5pZmVzdElkKSB7XHJcbiAgICAgIGNvbnRhaW5lckVsLmFkZENsYXNzKGAke21hbmlmZXN0SWR9LXNldHRpbmdzLWNvbXBhdGApO1xyXG4gICAgfVxyXG4gICAgXHJcbiAgICAvLyBGYWxsYmFjazogY3JlYXRlIGEgZGVkaWNhdGVkIGNvbnRhaW5lciB0byBrZWVwIGhlYWRpbmcgKyBzZXR0aW5ncyB0b2dldGhlclxyXG4gICAgY29uc3QgZ3JvdXBFbCA9IGNvbnRhaW5lckVsLmNyZWF0ZURpdignc2V0dGluZy1ncm91cCcpO1xyXG4gICAgaWYgKGhlYWRpbmcpIHtcclxuICAgICAgY29uc3QgaGVhZGluZ0VsID0gZ3JvdXBFbC5jcmVhdGVEaXYoJ3NldHRpbmctZ3JvdXAtaGVhZGluZycpO1xyXG4gICAgICBoZWFkaW5nRWwuY3JlYXRlRWwoJ2gzJywgeyB0ZXh0OiBoZWFkaW5nIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiB7XHJcbiAgICAgIGFkZFNldHRpbmcoY2I6IChzZXR0aW5nOiBTZXR0aW5nKSA9PiB2b2lkKSB7XHJcbiAgICAgICAgY29uc3Qgc2V0dGluZyA9IG5ldyBTZXR0aW5nKGdyb3VwRWwpO1xyXG4gICAgICAgIGNiKHNldHRpbmcpO1xyXG4gICAgICB9LFxyXG4gICAgfTtcclxuICB9XHJcbn1cclxuXHJcblxyXG4iLCAiaW1wb3J0IHsgQXBwLCBzdHJpbmdpZnlZYW1sLCBwYXJzZVlhbWwgfSBmcm9tICdvYnNpZGlhbic7XHJcbmltcG9ydCB7IEFsaWFzRmlsZW5hbWVIaXN0b3J5U2V0dGluZ3MgfSBmcm9tICcuLi9zZXR0aW5ncyc7XHJcblxyXG5leHBvcnQgY2xhc3MgQWxpYXNQcm9jZXNzb3Ige1xyXG4gIGNvbnN0cnVjdG9yKFxyXG4gICAgcHJpdmF0ZSBhcHA6IEFwcCxcclxuICAgIHByaXZhdGUgc2V0dGluZ3M6IEFsaWFzRmlsZW5hbWVIaXN0b3J5U2V0dGluZ3NcclxuICApIHt9XHJcblxyXG4gIHByaXZhdGUgYXN5bmMgcHJvY2Vzc0FsaWFzZXNNYW51YWxseShwYXRoOiBzdHJpbmcsIHF1ZXVlOiBTZXQ8c3RyaW5nPik6IFByb21pc2U8dm9pZD4ge1xyXG4gICAgY29uc3QgZmlsZSA9IHRoaXMuYXBwLnZhdWx0LmdldEZpbGVCeVBhdGgocGF0aCk7XHJcbiAgICBpZiAoIWZpbGUpIHtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IHJlZ2V4ZXM6IFJlZ0V4cFtdID0gW107XHJcbiAgICBmb3IgKGNvbnN0IHJlZ2V4U3RyIG9mIHRoaXMuc2V0dGluZ3MuaWdub3JlUmVnZXhlcykge1xyXG4gICAgICB0cnkge1xyXG4gICAgICAgIHJlZ2V4ZXMucHVzaChuZXcgUmVnRXhwKHJlZ2V4U3RyKSk7XHJcbiAgICAgIH0gY2F0Y2ggKGUpIHtcclxuICAgICAgICBjb25zb2xlLmVycm9yKGBJbnZhbGlkIGlnbm9yZSByZWdleDogJHtyZWdleFN0cn1gLCBlKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IHRvQWRkOiBzdHJpbmdbXSA9IFtdO1xyXG4gICAgY29uc3QgY3VycmVudEJhc2VuYW1lID0gZmlsZS5iYXNlbmFtZTtcclxuICAgIGNvbnN0IGN1cnJlbnRCYXNlbmFtZUxvd2VyID0gY3VycmVudEJhc2VuYW1lLnRvTG93ZXJDYXNlKCk7XHJcblxyXG4gICAgZm9yIChjb25zdCBuYW1lIG9mIHF1ZXVlKSB7XHJcbiAgICAgIGlmIChyZWdleGVzLnNvbWUocmUgPT4gcmUudGVzdChuYW1lKSkpIHtcclxuICAgICAgICBjb250aW51ZTtcclxuICAgICAgfVxyXG4gICAgICBjb25zdCBuYW1lTG93ZXIgPSBuYW1lLnRvTG93ZXJDYXNlKCk7XHJcbiAgICAgIGlmIChcclxuICAgICAgICAodGhpcy5zZXR0aW5ncy5jYXNlU2Vuc2l0aXZlICYmIG5hbWUgPT09IGN1cnJlbnRCYXNlbmFtZSkgfHxcclxuICAgICAgICAoIXRoaXMuc2V0dGluZ3MuY2FzZVNlbnNpdGl2ZSAmJiBuYW1lTG93ZXIgPT09IGN1cnJlbnRCYXNlbmFtZUxvd2VyKVxyXG4gICAgICApIHtcclxuICAgICAgICBjb250aW51ZTtcclxuICAgICAgfVxyXG4gICAgICB0b0FkZC5wdXNoKG5hbWUpO1xyXG4gICAgfVxyXG5cclxuICAgIGlmICh0b0FkZC5sZW5ndGggPT09IDApIHtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIFJlYWQgZmlsZSBjb250ZW50XHJcbiAgICBsZXQgY29udGVudCA9IGF3YWl0IHRoaXMuYXBwLnZhdWx0LnJlYWQoZmlsZSk7XHJcblxyXG4gICAgLy8gUGFyc2UgZnJvbnRtYXR0ZXJcclxuICAgIGNvbnN0IGZyb250bWF0dGVyUmVnZXggPSAvXi0tLVxcbihbXFxzXFxTXSo/KVxcbi0tLVxcbi87XHJcbiAgICBjb25zdCBtYXRjaCA9IGNvbnRlbnQubWF0Y2goZnJvbnRtYXR0ZXJSZWdleCk7XHJcblxyXG4gICAgbGV0IGZyb250bWF0dGVyOiBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPiA9IHt9O1xyXG4gICAgbGV0IGZyb250bWF0dGVyVGV4dCA9ICcnO1xyXG4gICAgbGV0IGJvZHlDb250ZW50ID0gY29udGVudDtcclxuXHJcbiAgICBpZiAobWF0Y2gpIHtcclxuICAgICAgZnJvbnRtYXR0ZXJUZXh0ID0gbWF0Y2hbMV07XHJcbiAgICAgIGJvZHlDb250ZW50ID0gY29udGVudC5zbGljZShtYXRjaFswXS5sZW5ndGgpO1xyXG4gICAgICB0cnkge1xyXG4gICAgICAgIGNvbnN0IHBhcnNlZCA9IHBhcnNlWWFtbChmcm9udG1hdHRlclRleHQpIGFzIFJlY29yZDxzdHJpbmcsIHVua25vd24+IHwgbnVsbCB8IHVuZGVmaW5lZDtcclxuICAgICAgICBmcm9udG1hdHRlciA9IHBhcnNlZCAmJiB0eXBlb2YgcGFyc2VkID09PSAnb2JqZWN0JyA/IHBhcnNlZCA6IHt9O1xyXG4gICAgICB9IGNhdGNoIChlKSB7XHJcbiAgICAgICAgY29uc29sZS5lcnJvcihgRXJyb3IgcGFyc2luZyBmcm9udG1hdHRlcjpgLCBlKTtcclxuICAgICAgICBmcm9udG1hdHRlciA9IHt9O1xyXG4gICAgICB9XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBib2R5Q29udGVudCA9IGNvbnRlbnQ7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gR2V0IG9yIGNyZWF0ZSBhbGlhc2VzIGFycmF5XHJcbiAgICBsZXQgYWxpYXNlcyA9IGZyb250bWF0dGVyLmFsaWFzZXM7XHJcbiAgICBpZiAoIUFycmF5LmlzQXJyYXkoYWxpYXNlcykpIHtcclxuICAgICAgY29uc3QgaGFzRnJvbnRtYXR0ZXIgPSBPYmplY3Qua2V5cyhmcm9udG1hdHRlcikubGVuZ3RoID4gMDtcclxuICAgICAgaWYgKGhhc0Zyb250bWF0dGVyICYmICF0aGlzLnNldHRpbmdzLmF1dG9DcmVhdGVGcm9udG1hdHRlcikge1xyXG4gICAgICAgIHJldHVybjtcclxuICAgICAgfVxyXG4gICAgICBhbGlhc2VzID0gW107XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgYWxpYXNlc0FycmF5ID0gYWxpYXNlcyBhcyBzdHJpbmdbXTtcclxuICAgIGNvbnN0IGV4aXN0aW5nID0gbmV3IFNldDxzdHJpbmc+KFxyXG4gICAgICB0aGlzLnNldHRpbmdzLmNhc2VTZW5zaXRpdmUgPyBhbGlhc2VzQXJyYXkgOiBhbGlhc2VzQXJyYXkubWFwKChhOiBzdHJpbmcpID0+IGEudG9Mb3dlckNhc2UoKSlcclxuICAgICk7XHJcblxyXG4gICAgbGV0IGFkZGVkID0gZmFsc2U7XHJcbiAgICBmb3IgKGNvbnN0IG5hbWUgb2YgdG9BZGQpIHtcclxuICAgICAgY29uc3QgY2hlY2tOYW1lID0gdGhpcy5zZXR0aW5ncy5jYXNlU2Vuc2l0aXZlID8gbmFtZSA6IG5hbWUudG9Mb3dlckNhc2UoKTtcclxuICAgICAgaWYgKCFleGlzdGluZy5oYXMoY2hlY2tOYW1lKSkge1xyXG4gICAgICAgIGFsaWFzZXNBcnJheS5wdXNoKG5hbWUpO1xyXG4gICAgICAgIGV4aXN0aW5nLmFkZChjaGVja05hbWUpO1xyXG4gICAgICAgIGFkZGVkID0gdHJ1ZTtcclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGlmICghYWRkZWQpIHtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIFVwZGF0ZSBmcm9udG1hdHRlclxyXG4gICAgZnJvbnRtYXR0ZXIuYWxpYXNlcyA9IGFsaWFzZXNBcnJheTtcclxuXHJcbiAgICAvLyBTdHJpbmdpZnkgZnJvbnRtYXR0ZXJcclxuICAgIGNvbnN0IG5ld0Zyb250bWF0dGVyVGV4dCA9IHN0cmluZ2lmeVlhbWwoZnJvbnRtYXR0ZXIpLnRyaW0oKTtcclxuXHJcbiAgICAvLyBSZWNvbnN0cnVjdCBmaWxlIGNvbnRlbnRcclxuICAgIGNvbnN0IG5ld0NvbnRlbnQgPSBgLS0tXFxuJHtuZXdGcm9udG1hdHRlclRleHR9XFxuLS0tXFxuJHtib2R5Q29udGVudH1gO1xyXG5cclxuICAgIC8vIFdyaXRlIGJhY2sgdG8gZmlsZVxyXG4gICAgYXdhaXQgdGhpcy5hcHAudmF1bHQubW9kaWZ5KGZpbGUsIG5ld0NvbnRlbnQpO1xyXG4gIH1cclxuXHJcbiAgYXN5bmMgcHJvY2Vzc0FsaWFzZXMocGF0aDogc3RyaW5nLCBxdWV1ZTogU2V0PHN0cmluZz4pOiBQcm9taXNlPHZvaWQ+IHtcclxuICAgIGNvbnN0IGZpbGUgPSB0aGlzLmFwcC52YXVsdC5nZXRGaWxlQnlQYXRoKHBhdGgpO1xyXG4gICAgaWYgKCFmaWxlKSByZXR1cm47XHJcblxyXG4gICAgY29uc3QgcmVnZXhlczogUmVnRXhwW10gPSBbXTtcclxuICAgIGZvciAoY29uc3QgcmVnZXhTdHIgb2YgdGhpcy5zZXR0aW5ncy5pZ25vcmVSZWdleGVzKSB7XHJcbiAgICAgIHRyeSB7XHJcbiAgICAgICAgcmVnZXhlcy5wdXNoKG5ldyBSZWdFeHAocmVnZXhTdHIpKTtcclxuICAgICAgfSBjYXRjaCAoZSkge1xyXG4gICAgICAgIGNvbnNvbGUuZXJyb3IoYEludmFsaWQgaWdub3JlIHJlZ2V4OiAke3JlZ2V4U3RyfWAsIGUpO1xyXG4gICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgdG9BZGQ6IHN0cmluZ1tdID0gW107XHJcbiAgICBjb25zdCBjdXJyZW50QmFzZW5hbWUgPSBmaWxlLmJhc2VuYW1lO1xyXG4gICAgY29uc3QgY3VycmVudEJhc2VuYW1lTG93ZXIgPSBjdXJyZW50QmFzZW5hbWUudG9Mb3dlckNhc2UoKTtcclxuXHJcbiAgICBmb3IgKGNvbnN0IG5hbWUgb2YgcXVldWUpIHtcclxuICAgICAgaWYgKHJlZ2V4ZXMuc29tZShyZSA9PiByZS50ZXN0KG5hbWUpKSkge1xyXG4gICAgICAgIGNvbnRpbnVlO1xyXG4gICAgICB9XHJcbiAgICAgIGNvbnN0IG5hbWVMb3dlciA9IG5hbWUudG9Mb3dlckNhc2UoKTtcclxuICAgICAgaWYgKFxyXG4gICAgICAgICh0aGlzLnNldHRpbmdzLmNhc2VTZW5zaXRpdmUgJiYgbmFtZSA9PT0gY3VycmVudEJhc2VuYW1lKSB8fFxyXG4gICAgICAgICghdGhpcy5zZXR0aW5ncy5jYXNlU2Vuc2l0aXZlICYmIG5hbWVMb3dlciA9PT0gY3VycmVudEJhc2VuYW1lTG93ZXIpXHJcbiAgICAgICkge1xyXG4gICAgICAgIGNvbnRpbnVlO1xyXG4gICAgICB9XHJcbiAgICAgIHRvQWRkLnB1c2gobmFtZSk7XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKHRvQWRkLmxlbmd0aCA9PT0gMCkge1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcblxyXG4gICAgLy8gVXNlIG1hbnVhbCBwcm9jZXNzaW5nIGZvciBub24tbWQgZmlsZXMsIG9yIGFzIGZhbGxiYWNrXHJcbiAgICBpZiAoZmlsZS5leHRlbnNpb24gIT09ICdtZCcpIHtcclxuICAgICAgYXdhaXQgdGhpcy5wcm9jZXNzQWxpYXNlc01hbnVhbGx5KHBhdGgsIHF1ZXVlKTtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG5cclxuICAgIGF3YWl0IHRoaXMuYXBwLmZpbGVNYW5hZ2VyLnByb2Nlc3NGcm9udE1hdHRlcihmaWxlLCAoZm06IFJlY29yZDxzdHJpbmcsIHVua25vd24+KSA9PiB7XHJcbiAgICAgIGxldCBhbGlhc2VzID0gZm0uYWxpYXNlcztcclxuICAgICAgaWYgKCFBcnJheS5pc0FycmF5KGFsaWFzZXMpKSB7XHJcbiAgICAgICAgLy8gSWYgdGhlcmUncyBubyBmcm9udG1hdHRlciBhdCBhbGwsIHdlIG5lZWQgdG8gY3JlYXRlIGl0IHRvIGFkZCBhbGlhc2VzXHJcbiAgICAgICAgLy8gSWYgdGhlcmUncyBmcm9udG1hdHRlciBidXQgbm8gYWxpYXNlcyBwcm9wZXJ0eSwgcmVzcGVjdCB0aGUgYXV0b0NyZWF0ZUZyb250bWF0dGVyIHNldHRpbmdcclxuICAgICAgICBjb25zdCBoYXNGcm9udG1hdHRlciA9IE9iamVjdC5rZXlzKGZtKS5sZW5ndGggPiAwO1xyXG4gICAgICAgIGlmIChoYXNGcm9udG1hdHRlciAmJiAhdGhpcy5zZXR0aW5ncy5hdXRvQ3JlYXRlRnJvbnRtYXR0ZXIpIHtcclxuICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgYWxpYXNlcyA9IFtdO1xyXG4gICAgICAgIGZtLmFsaWFzZXMgPSBhbGlhc2VzO1xyXG4gICAgICB9XHJcblxyXG4gICAgICBjb25zdCBhbGlhc2VzQXJyYXkgPSBhbGlhc2VzIGFzIHN0cmluZ1tdO1xyXG4gICAgICBjb25zdCBleGlzdGluZyA9IG5ldyBTZXQ8c3RyaW5nPihcclxuICAgICAgICB0aGlzLnNldHRpbmdzLmNhc2VTZW5zaXRpdmUgPyBhbGlhc2VzQXJyYXkgOiBhbGlhc2VzQXJyYXkubWFwKChhOiBzdHJpbmcpID0+IGEudG9Mb3dlckNhc2UoKSlcclxuICAgICAgKTtcclxuXHJcbiAgICAgIGZvciAoY29uc3QgbmFtZSBvZiB0b0FkZCkge1xyXG4gICAgICAgIGNvbnN0IGNoZWNrTmFtZSA9IHRoaXMuc2V0dGluZ3MuY2FzZVNlbnNpdGl2ZSA/IG5hbWUgOiBuYW1lLnRvTG93ZXJDYXNlKCk7XHJcbiAgICAgICAgaWYgKCFleGlzdGluZy5oYXMoY2hlY2tOYW1lKSkge1xyXG4gICAgICAgICAgYWxpYXNlc0FycmF5LnB1c2gobmFtZSk7XHJcbiAgICAgICAgICBleGlzdGluZy5hZGQoY2hlY2tOYW1lKTtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH1cclxufVxyXG4iLCAiZXhwb3J0IGZ1bmN0aW9uIGdldEJhc2VuYW1lKHBhdGg6IHN0cmluZyk6IHN0cmluZyB7XHJcbiAgY29uc3QgbmFtZSA9IHBhdGguc3BsaXQoJy8nKS5wb3AoKSB8fCAnJztcclxuICByZXR1cm4gbmFtZS5yZXBsYWNlKC9cXC5bXi8uXSskLywgJycpO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gZ2V0SW1tZWRpYXRlUGFyZW50TmFtZShwYXRoOiBzdHJpbmcpOiBzdHJpbmcge1xyXG4gIGNvbnN0IHBhcnRzID0gcGF0aC5zcGxpdCgnLycpO1xyXG4gIHBhcnRzLnBvcCgpOyAvLyBSZW1vdmUgZmlsZSBuYW1lXHJcbiAgcmV0dXJuIHBhcnRzLnBvcCgpIHx8ICcnOyAvLyBHZXQgaW1tZWRpYXRlIHBhcmVudCBmb2xkZXIgbmFtZSBvciAnJyBpZiByb290XHJcbn1cclxuIl0sCiAgIm1hcHBpbmdzIjogIjs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQSxJQUFBQSxtQkFBNkM7OztBQ1l0QyxJQUFNLG1CQUFpRDtBQUFBLEVBQzVELGVBQWUsQ0FBQyxNQUFNLGNBQWMsaUJBQWlCO0FBQUEsRUFDckQsZ0JBQWdCO0FBQUEsRUFDaEIsZUFBZTtBQUFBLEVBQ2YsdUJBQXVCO0FBQUEsRUFDdkIsZ0JBQWdCLENBQUM7QUFBQSxFQUNqQixnQkFBZ0IsQ0FBQztBQUFBLEVBQ2pCLGdCQUFnQixDQUFDLElBQUk7QUFBQSxFQUNyQixvQkFBb0I7QUFBQSxFQUNwQixxQkFBcUI7QUFDdkI7OztBQ3RCQSxJQUFBQyxtQkFBOEM7OztBQ0k5QyxzQkFBMkM7QUFDM0MsZUFBMEI7QUEwQm5CLFNBQVMsb0JBQ2QsYUFDQSxTQUNBLFlBQ21CO0FBR25CLFVBQUksbUNBQWtCLFFBQVEsR0FBRztBQU0vQixVQUFNLGdCQUFnQjtBQUN0QixVQUFNLG1CQUFtQixjQUFjO0FBQ3ZDLFVBQU0sUUFBUSxJQUFJLGlCQUFpQixXQUFXO0FBQzlDLFFBQUksU0FBUztBQUNYLFlBQU0sV0FBVyxPQUFPO0FBQUEsSUFDMUI7QUFDQSxXQUFPO0FBQUEsTUFDTCxXQUFXLElBQWdDO0FBQ3pDLGNBQU0sV0FBVyxFQUFFO0FBQUEsTUFDckI7QUFBQSxJQUNGO0FBQUEsRUFDRixPQUFPO0FBR0wsUUFBSSxZQUFZO0FBQ2Qsa0JBQVksU0FBUyxHQUFHLFVBQVUsa0JBQWtCO0FBQUEsSUFDdEQ7QUFHQSxVQUFNLFVBQVUsWUFBWSxVQUFVLGVBQWU7QUFDckQsUUFBSSxTQUFTO0FBQ1gsWUFBTSxZQUFZ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S0FBSyxzQkFBc0IsQ0FBQyxHQUFHO0FBQzFGO0FBQUEsTUFDRjtBQUNBLGdCQUFVO0FBQUEsSUFDWjtBQUVBLFFBQUksQ0FBQyxRQUFTO0FBSWQsUUFBSSxnQkFBZ0IsS0FBSyxZQUFZLElBQUksUUFBUSxJQUFJO0FBQ3JELFFBQUksQ0FBQyxlQUFlO0FBRWxCLHNCQUFnQixLQUFLLFlBQVksSUFBSSxPQUFPO0FBQzVDLFVBQUksZUFBZTtBQUVqQixhQUFLLFlBQVksT0FBTyxPQUFPO0FBQUEsTUFDakM7QUFBQSxJQUNGO0FBRUEsUUFBSSxlQUFlO0FBRWpCLFVBQUksY0FBYyxjQUFjLEdBQUc7QUFDakMsZUFBTyxhQUFhLGNBQWMsU0FBUztBQUFBLE1BQzdDO0FBR0EsZ0JBQVUsTUFBTSxLQUFLLGNBQWMsS0FBSyxFQUFFLENBQUM7QUFBQSxJQUM3QztBQUdBLFVBQU0sUUFBUTtBQUFBLE1BQ1osT0FBTyxvQkFBSSxJQUFZLENBQUMsT0FBTyxDQUFDO0FBQUEsTUFDaEMsV0FBVztBQUFBLE1BQ1gsYUFBYSxRQUFRO0FBQUEsSUFDdkI7QUFHQSxVQUFNLFlBQVksT0FBTyxXQUFXLE1BQU07QUFDeEMsWUFBTSxZQUFZO0FBQ2hCLFlBQUk7QUFDRixnQkFBTSxLQUFLLGVBQWUsZUFBZSxNQUFNLGFBQWEsTUFBTSxLQUFLO0FBQUEsUUFDekUsU0FBUyxPQUFPO0FBQ2Qsa0JBQVEsTUFBTSw2QkFBNkIsS0FBSztBQUFBLFFBQ2xEO0FBQ0EsYUFBSyxZQUFZLE9BQU8sTUFBTSxXQUFXO0FBQUEsTUFDM0MsR0FBRztBQUFBLElBQ0wsR0FBRyxLQUFLLFNBQVMsaUJBQWlCLEdBQUk7QUFFdEMsU0FBSyxZQUFZLElBQUksUUFBUSxNQUFNLEtBQUs7QUFBQSxFQUMxQztBQUNGOyIsCiAgIm5hbWVzIjogWyJpbXBvcnRfb2JzaWRpYW4iLCAiaW1wb3J0X29ic2lkaWFuIiwgImltcG9ydF9vYnNpZGlhbiJdCn0K
